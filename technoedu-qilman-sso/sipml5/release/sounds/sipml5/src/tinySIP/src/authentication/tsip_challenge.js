function tsip_challenge(c,h,g,b,e,d,a,f){this.o_stack=c;this.b_isproxy=h;this.s_scheme=g;this.s_realm=b;this.s_nonce=e;this.s_opaque=d;this.s_algorithm=a;this.s_cnonce=null;this.i_nc=0;if(f){this.s_qop=tsk_string_contains(f,f.length,"auth-int")?"auth-int":(tsk_string_contains(f,f.length,"auth")?"auth":null);this.reset_cnonce()}}tsip_challenge.prototype.get_username=function(){return this.o_stack.identity.s_impi};tsip_challenge.prototype.get_password=function(){return this.o_stack.identity.s_password};tsip_challenge.prototype.reset_cnonce=function(){if(this.s_qop){this.s_cnonce=MD5.hexdigest(tsk_string_random(21));this.i_nc=1}};tsip_challenge.prototype.get_response=function(g,c,e){if(tsk_string_iequals(this.s_scheme,"Digest")){var b="";var d=tsip_auth_digest_HA1(this.get_username(),this.s_realm,this.get_password());var a=tsip_auth_digest_HA2(g,c,e,this.s_qop);if(this.i_nc){b=tsip_challenge.prototype.Ncount2String(this.i_nc)}var f=tsip_auth_digest_response(d,this.s_nonce,b,this.s_cnonce,this.s_qop,a);if(this.s_qop){++this.i_nc}return f}return null};tsip_challenge.prototype.update=function(g,c,e,d,b,f){var a=!tsk_string_iequals(this.s_nonce,e);this.s_scheme=g;this.s_realm=c;this.s_nonce=e;this.s_opaque=d;this.s_algorithm=b;if(f){this.s_qop=tsk_string_contains(f,f.length,"auth-int")?"auth-int":(tsk_string_contains(f,f.length,"auth")?"auth":null)}if(a&&this.s_qop){this.reset_cnonce()}return 0};tsip_challenge.prototype.create_header_authorization=function(d){var b=null;var a=null;var c=null;if(!(a=tsip_uri_tostring(d.line.request.o_uri,true,false))){tsk_utils_log_error("Failed to parse URI: "+d.line.request.o_uri);return null}if(this.i_nc){b=tsip_challenge.prototype.Ncount2String(this.i_nc)}var e=this.get_response(d.line.request.s_method,a,d.o_content);c=new tsip_header_Authorization();c.e_type=this.b_isproxy?tsip_header_type_e.Proxy_Authorization:tsip_header_type_e.Authorization;c.s_scheme=this.s_scheme;c.s_username=this.get_username();c.s_realm=this.s_realm;c.s_nonce=this.s_nonce;c.s_uri=a;c.s_response=e;c.s_algorithm=this.s_algorithm?this.s_algorithm:"MD5";c.s_cnonce=this.i_nc?this.s_cnonce:null;c.s_opaque=this.s_opaque;c.s_qop=this.s_qop;c.s_nc=b;return c};tsip_challenge.prototype.CreateEmptyHeaderAuthorization=function(d,b,a){var c=new tsip_header_Authorization();if(c){c.e_type=tsip_header_type_e.Authorization;c.s_scheme="Digest";c.s_username=d;c.s_realm=b;c.s_nonce="";c.s_response="";c.s_uri=a}return c};tsip_challenge.prototype.Ncount2String=function(c){var b=7;var a="";do{a+="0123456789abcdef"[(c>>b*4)&15]}while(b--);return a};