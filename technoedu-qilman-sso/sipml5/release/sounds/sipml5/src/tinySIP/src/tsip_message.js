tsip_response.prototype=Object.create(tsip_message.prototype);tsip_request.prototype=Object.create(tsip_message.prototype);tsip_message.prototype.__s_version_10="SIP/1.0";tsip_message.prototype.__s_version_20="SIP/2.0";tsip_message.prototype.__s_version_default=tsip_message.prototype.__s_version_20;var tsip_message_type_e={UNKNOWN:0,REQUEST:1,RESPONSE:2};var tsip_request_type_e={NONE:{i_id:-1,s_name:"NONE"},ACK:{i_id:0,s_name:"ACK"},BYE:{i_id:1,s_name:"BYE"},CANCEL:{i_id:2,s_name:"CANCEL"},INVITE:{i_id:3,s_name:"INVITE"},OPTIONS:{i_id:4,s_name:"OPTIONS"},REGISTER:{i_id:5,s_name:"REGISTER"},SUBSCRIBE:{i_id:6,s_name:"SUBSCRIBE"},NOTIFY:{i_id:7,s_name:"NOTIFY"},REFER:{i_id:8,s_name:"REFER"},INFO:{i_id:9,s_name:"INFO"},UPDATE:{i_id:10,s_name:"UPDATE"},MESSAGE:{i_id:11,s_name:"MESSAGE"},PUBLISH:{i_id:12,s_name:"PUBLISH"},PRACK:{i_id:13,s_name:"PRACK"}};function tsip_message(a){this.s_version=tsip_message.prototype.__s_version_default;this.e_type=a;this.line={request:{},response:{}};this.o_hdr_firstVia=null;this.o_hdr_From=null;this.o_hdr_To=null;this.o_hdr_Contact=null;this.o_hdr_Call_ID=null;this.o_hdr_CSeq=null;this.o_hdr_Expires=null;this.o_hdr_Content_Type=null;this.o_hdr_Content_Length=null;this.o_content=null;this.ao_headers=new Array();this.s_sigcomp_id=null;this.o_socket=null;this.o_remote_addr=null;this.b_update=false}function tsip_response(b,d,c){if(!d||!c){tsk_utils_log_error("Invalid argument");return null}tsip_message.call(this,tsip_message_type_e.RESPONSE);this.line.response.i_status_code=b;this.line.response.s_reason_phrase=d;this.o_socket=c.o_socket;this.o_remote_addr=c.o_remote_addr;this.o_hdr_From=c.o_hdr_From;this.o_hdr_Call_ID=c.o_hdr_Call_ID;this.o_hdr_CSeq=c.o_hdr_CSeq;this.o_hdr_firstVia=c.o_hdr_firstVia;if(this.o_hdr_firstVia){var f=1;var a;while((a=c.get_header_at(tsip_header_type_e.Via,f++))){this.add_header(a)}}var f=0;var e;while((e=c.get_header_at(tsip_header_type_e.Record_Route,f++))){this.add_header(e)}this.o_hdr_To=c.o_hdr_To;this.add_header(new tsip_header_Content_Length(0))}function tsip_request(e,c,b,a,d,f){if(!e||!c||!d){tsk_utils_log_error("Invalid argument");return null}tsip_message.call(this,tsip_message_type_e.REQUEST);this.line.request.s_method=e;this.line.request.o_uri=c;this.line.request.e_type=tsip_message.prototype.GetRequestType(e);this.add_headers(new tsip_header_CSeq(f,e),new tsip_header_Call_ID(d),new tsip_header_Max_Forwards(TSIP_HEADER_MAX_FORWARDS_DEFAULT),new tsip_header_Content_Length(0));if(a){this.add_headers(new tsip_header_To(a,null))}if(b){this.add_headers(new tsip_header_From(b,null))}}tsip_message.prototype.add_header=function(b,a){if(!b){tsk_utils_log_error("Invalid argument");return -1}switch(b.e_type){case tsip_header_type_e.Via:if(!this.o_hdr_firstVia){this.o_hdr_firstVia=b;return 0}break;case tsip_header_type_e.From:if(!this.o_hdr_From){this.o_hdr_From=b;return 0}break;case tsip_header_type_e.To:if(!this.o_hdr_To){this.o_hdr_To=b;return 0}break;case tsip_header_type_e.Contact:if(!this.o_hdr_Contact){this.o_hdr_Contact=b;return 0}break;case tsip_header_type_e.Call_ID:if(!this.o_hdr_Call_ID){this.o_hdr_Call_ID=b;return 0}break;case tsip_header_type_e.CSeq:if(!this.o_hdr_CSeq){this.o_hdr_CSeq=b;return 0}break;case tsip_header_type_e.Expires:if(!this.o_hdr_Expires){this.o_hdr_Expires=b;return 0}break;case tsip_header_type_e.Content_Type:if(!this.o_hdr_Content_Type){this.o_hdr_Content_Type=b;return 0}break;case tsip_header_type_e.Content_Length:if(!this.o_hdr_Content_Length){this.o_hdr_Content_Length=b;return 0}break}if(a){this.ao_headers.unshift(b)}else{this.ao_headers.push(b)}return 0};tsip_message.prototype.add_headers=function(){for(var a=0;a<arguments.length;++a){if(arguments[a]){this.add_header(arguments[a])}}return 0};tsip_message.prototype.get_header_at=function(d,c){var a=0;switch(d){case tsip_header_type_e.Via:if(c==0){return this.o_hdr_firstVia}++a;break;case tsip_header_type_e.From:if(c==0){return this.o_hdr_From}++a;break;case tsip_header_type_e.To:if(c==0){return this.o_hdr_To}++a;break;case tsip_header_type_e.Contact:if(c==0){return this.o_hdr_Contact}++a;break;case tsip_header_type_e.Call_ID:if(c==0){return this.o_hdr_Call_ID}++a;break;case tsip_header_type_e.CSeq:if(c==0){return this.o_hdr_CSeq}++a;break;case tsip_header_type_e.Expires:if(c==0){return this.o_hdr_Expires}++a;break;case tsip_header_type_e.Content_Type:if(c==0){return this.o_hdr_Content_Type}++a;break;case tsip_header_type_e.Content_Length:if(c==0){return this.o_hdr_Content_Length}++a;break}for(var b=0;b<this.ao_headers.length;++b){if(this.ao_headers[b].e_type==d){if(a++>=c){return this.ao_headers[b]}}}return null};tsip_message.prototype.get_header=function(a){return this.get_header_at(a,0)};tsip_message.prototype.get_response_code=function(){return this.is_response()?this.line.response.i_status_code:0};tsip_message.prototype.get_response_phrase=function(){return this.is_response()?this.line.response.s_reason_phrase:null};tsip_message.prototype.is_allowed=function(b){if(!b){tsk_utils_log_error("Invalid argument");return false}var a;var c=0;while((a=this.get_header_at(tsip_header_type_e.Allow,c++))){if(a.has_value(b)){return true}}return false};tsip_message.prototype.is_supported=function(a){if(!a){tsk_utils_log_error("Invalid argument");return false}var b;var c=0;while((b=this.get_header_at(tsip_header_type_e.Supported,c++))){if(b.has_value(a)){return true}}return false};tsip_message.prototype.is_required=function(a){if(!a){tsk_utils_log_error("Invalid argument");return false}var b;var c=0;while((b=this.get_header_at(tsip_header_type_e.Require,c++))){if(b.has_value(a)){return true}}return false};tsip_message.prototype.get_expires=function(){if(this.o_hdr_Expires){return this.o_hdr_Expires.i_value}if(this.o_hdr_Contact){return this.o_hdr_Contact.i_expires}return -1};tsip_message.prototype.has_content=function(){return this.get_content_length()>0&&this.o_content};tsip_message.prototype.get_content_length=function(){return this.o_hdr_Content_Length?this.o_hdr_Content_Length.i_value:0};tsip_message.prototype.get_content_type=function(){return(this.o_hdr_Content_Type)?this.o_hdr_Content_Type.s_type:null};tsip_message.prototype.get_content=function(){return this.o_content};tsip_message.prototype.get_content_as_string=function(){if(this.o_content){if(this.o_content instanceof Array){return tsk_buff_u8b2utf8(this.o_content)}}return this.o_content?this.o_content.toString():null};tsip_message.prototype.add_content=function(b,c,a){if(c){this.o_hdr_Content_Type=new tsip_header_Content_Type(c)}if(b&&typeof a=="undefined"){if(b instanceof String||typeof b=="string"){a=unescape(encodeURIComponent(b)).length}else{if(b.byteLength){a=b.byteLength}else{if(b.length){a=b.length}else{tsk_utils_log_error("cannot stat content-length");a=0}}}}this.o_hdr_Content_Length=new tsip_header_Content_Length(a);this.o_content=b};tsip_message.prototype.toString=function(){var b=null;if(this.e_type==tsip_message_type_e.REQUEST){b=tsk_string_format("{0} {1} {2}\r\n",this.line.request.s_method,tsip_uri_tostring(this.line.request.o_uri,true,false),this.s_version)}else{b=tsk_string_format("{0} {1} {2}\r\n",this.s_version,this.line.response.i_status_code,this.line.response.s_reason_phrase)}if(this.o_hdr_firstVia){b+=this.o_hdr_firstVia.tostring_full()}if(this.o_hdr_From){b+=this.o_hdr_From.tostring_full()}if(this.o_hdr_To){b+=this.o_hdr_To.tostring_full()}if(this.o_hdr_Contact){b+=this.o_hdr_Contact.tostring_full()}if(this.o_hdr_Call_ID){b+=this.o_hdr_Call_ID.tostring_full()}if(this.o_hdr_CSeq){b+=this.o_hdr_CSeq.tostring_full()}if(this.o_hdr_Expires){b+=this.o_hdr_Expires.tostring_full()}if(this.o_hdr_Content_Type){b+=this.o_hdr_Content_Type.tostring_full()}if(this.o_hdr_Content_Length){b+=this.o_hdr_Content_Length.tostring_full()}for(var a=0;a<this.ao_headers.length;++a){b+=this.ao_headers[a].tostring_full()}b+="\r\n";if(this.has_content()){b+=this.get_content_as_string()}return b};tsip_message.prototype.is_request=function(){return this.e_type==tsip_message_type_e.REQUEST};tsip_message.prototype.is_response=function(){return this.e_type==tsip_message_type_e.RESPONSE};tsip_message.prototype.is_req_type=function(a){return this.is_request()&&this.line.request.e_type==a};tsip_message.prototype.is_ack=function(){return this.is_req_type(tsip_request_type_e.ACK)};tsip_message.prototype.is_bye=function(){return this.is_req_type(tsip_request_type_e.BYE)};tsip_message.prototype.is_cancel=function(){return this.is_req_type(tsip_request_type_e.CANCEL)};tsip_message.prototype.is_invite=function(){return this.is_req_type(tsip_request_type_e.INVITE)};tsip_message.prototype.is_options=function(){return this.is_req_type(tsip_request_type_e.OPTIONS)};tsip_message.prototype.is_register=function(){return this.is_req_type(tsip_request_type_e.REGISTER)};tsip_message.prototype.is_subscribe=function(){return this.is_req_type(tsip_request_type_e.SUBSCRIBE)};tsip_message.prototype.is_notify=function(){return this.is_req_type(tsip_request_type_e.NOTIFY)};tsip_message.prototype.is_update=function(){return this.is_req_type(tsip_request_type_e.UPDATE)};tsip_message.prototype.is_message=function(){return this.is_req_type(tsip_request_type_e.MESSAGE)};tsip_message.prototype.is_publish=function(){return this.is_req_type(tsip_request_type_e.PUBLISH)};tsip_message.prototype.is_prack=function(){return this.is_req_type(tsip_request_type_e.PRACK)};tsip_message.prototype.is_refer=function(){return this.is_req_type(tsip_request_type_e.REFER)};tsip_message.prototype.is_info=function(){return this.is_req_type(tsip_request_type_e.INFO)};tsip_message.prototype.is_response_to=function(a){return this.is_response()&&this.o_hdr_CSeq&&this.o_hdr_CSeq.e_req_type==a};tsip_message.prototype.is_response_to_ack=function(){return this.is_response_to(tsip_request_type_e.ACK)};tsip_message.prototype.is_response_to_bye=function(){return this.is_response_to(tsip_request_type_e.BYE)};tsip_message.prototype.is_response_to_cancel=function(){return this.is_response_to(tsip_request_type_e.CANCEL)};tsip_message.prototype.is_response_to_invite=function(){return this.is_response_to(tsip_request_type_e.INVITE)};tsip_message.prototype.is_response_to_options=function(){return this.is_response_to(tsip_request_type_e.OPTIONS)};tsip_message.prototype.is_response_to_register=function(){return this.is_response_to(tsip_request_type_e.REGISTER)};tsip_message.prototype.is_response_to_subscribe=function(){return this.is_response_to(tsip_request_type_e.SUBSCRIBE)};tsip_message.prototype.is_response_to_notify=function(){return this.is_response_to(tsip_request_type_e.NOTIFY)};tsip_message.prototype.is_response_to_update=function(){return this.is_response_to(tsip_request_type_e.UPDATE)};tsip_message.prototype.is_response_to_message=function(){return this.is_response_to(tsip_request_type_e.MESSAGE)};tsip_message.prototype.is_response_to_publish=function(){return this.is_response_to(tsip_request_type_e.PUBLISH)};tsip_message.prototype.is_response_to_prack=function(){return this.is_response_to(tsip_request_type_e.PRACK)};tsip_message.prototype.is_response_to_refer=function(){return this.is_response_to(tsip_request_type_e.REFER)};tsip_message.prototype.is_response_to_info=function(){return this.is_response_to(tsip_request_type_e.INFO)};tsip_message.prototype.is_response_nxx=function(a){return this.is_response()&&((a*100)<=this.get_response_code()&&this.get_response_code()<=((a*100)+99))};tsip_message.prototype.is_response_xxx=function(a){return this.is_response()&&(this.get_response_code()==a)};tsip_message.prototype.is_1xx=function(){return this.is_response_nxx(1)};tsip_message.prototype.is_2xx=function(){return this.is_response_nxx(2)};tsip_message.prototype.is_3xx=function(){return this.is_response_nxx(3)};tsip_message.prototype.is_4xx=function(){return this.is_response_nxx(4)};tsip_message.prototype.is_5xx=function(){return this.is_response_nxx(5)};tsip_message.prototype.is_6xx=function(){return this.is_response_nxx(6)};tsip_message.prototype.is_23456=function(){return this.is_response()&&(200<=this.get_response_code()&&this.get_response_code()<=699)};tsip_message.prototype.is_3456=function(){return this.is_response()&&(300<=this.get_response_code()&&this.get_response_code()<=699)};tsip_message.prototype.GetRequestType=function(b){if(b){var a=b.toUpperCase();if((a==tsip_request_type_e.ACK.s_name)){return tsip_request_type_e.ACK}else{if((a==tsip_request_type_e.BYE.s_name)){return tsip_request_type_e.BYE}else{if((a==tsip_request_type_e.CANCEL.s_name)){return tsip_request_type_e.CANCEL}else{if((a==tsip_request_type_e.INVITE.s_name)){return tsip_request_type_e.INVITE}else{if((a==tsip_request_type_e.OPTIONS.s_name)){return tsip_request_type_e.OPTIONS}else{if((a==tsip_request_type_e.REGISTER.s_name)){return tsip_request_type_e.REGISTER}else{if((a==tsip_request_type_e.SUBSCRIBE.s_name)){return tsip_request_type_e.SUBSCRIBE}else{if((a==tsip_request_type_e.NOTIFY.s_name)){return tsip_request_type_e.NOTIFY}else{if((a==tsip_request_type_e.REFER.s_name)){return tsip_request_type_e.REFER}else{if((a==tsip_request_type_e.INFO.s_name)){return tsip_request_type_e.INFO}else{if((a==tsip_request_type_e.UPDATE.s_name)){return tsip_request_type_e.UPDATE}else{if((a==tsip_request_type_e.MESSAGE.s_name)){return tsip_request_type_e.MESSAGE}else{if((a==tsip_request_type_e.PUBLISH.s_name)){return tsip_request_type_e.PUBLISH}else{if((a==tsip_request_type_e.PRACK.s_name)){return tsip_request_type_e.PRACK}}}}}}}}}}}}}}}return tsip_request_type_e.NONE};if(!window.__b_release_mode){tsip_api_add_js_scripts("head","src/tinySIP/src/parsers/tsip_parser_message.js")};