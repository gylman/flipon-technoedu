function tsip_transac_layer(a){if(!a){tsk_utils_log_error("Invalid argument");return null}this.o_stack=a;this.ao_transacs=new Array()}tsip_transac_layer.prototype.transac_new=function(c,d,e){if(!d||!d.o_hdr_CSeq||!d.o_hdr_Call_ID){tsk_utils_log_error("Invalid argument");return null}var a=null;while(this.b_locked){}this.b_locked=true;var b=true;if(this.o_stack.o_layer_transport.ao_transports.length>0){b=this.o_stack.o_layer_transport.ao_transports[0].is_reliable()}if(d){if(d.is_request()){if(c){if(d.is_invite()){a=new tsip_transac_ict(b,d.o_hdr_CSeq.i_seq,d.o_hdr_Call_ID.s_value,e)}else{a=new tsip_transac_nict(b,d.o_hdr_CSeq.i_seq,d.o_hdr_CSeq.s_method,d.o_hdr_Call_ID.s_value,e)}}else{if(d.is_invite()){a=new tsip_transac_ist(b,d.o_hdr_CSeq.i_seq,d.o_hdr_Call_ID.s_value,e)}else{a=new tsip_transac_nist(b,d.o_hdr_CSeq.i_seq,d.o_hdr_CSeq.s_method,d.o_hdr_Call_ID.s_value,e)}if(a){a.s_branch=d.o_hdr_firstVia.s_branch}}if(a){this.ao_transacs.push(a)}}}this.b_locked=false;return a};tsip_transac_layer.prototype.indexof=function(a){var c=-1;if(a){while(this.b_locked){}this.b_locked=true;for(var b=0;b<this.ao_transacs.length;++b){if(a==this.ao_transacs[b]){c=b;break}}this.b_locked=false}return c};tsip_transac_layer.prototype.remove=function(a){if(a){while(this.b_locked){}this.b_locked=true;for(var b=0;b<this.ao_transacs.length;++b){if(a==this.ao_transacs[b]){this.ao_transacs.splice(b,1);break}}this.b_locked=false}};tsip_transac_layer.prototype.cancel_by_dialog=function(c){if(!c){tsk_utils_log_error("Invalid argument");return -1}var a=null;while(this.b_locked){}this.b_locked=true;for(var b=0;b<this.ao_transacs.length;++b){a=this.ao_transacs[b];if(c.compare(a.get_dialog())==0){setTimeout(function(){a.fsm_act(tsip_action_type_e.CANCEL,null)},1)}}this.b_locked=false;return 0};tsip_transac_layer.prototype.find_client=function(c){if(!c){tsk_utils_log_error("Invalid argument");return null}var d=null;var a;if(!c.o_hdr_firstVia||!c.o_hdr_CSeq){return null}while(this.b_locked){}this.b_locked=true;for(var b=0;b<this.ao_transacs.length;++b){a=this.ao_transacs[b];if((a.s_branch==c.o_hdr_firstVia.s_branch)&&(a.s_cseq_method==c.o_hdr_CSeq.s_method)){d=a;break}}this.b_locked=false;return d};tsip_transac_layer.prototype.find_server=function(c){var d=null;var a;if(!c.o_hdr_firstVia||!c.o_hdr_CSeq||!c.o_hdr_Call_ID){return null}while(this.b_locked){}this.b_locked=true;for(var b=0;b<this.ao_transacs.length;++b){a=this.ao_transacs[b];if(c.is_ack()&&(a.s_callid==c.o_hdr_Call_ID.s_value)){if(tsk_string_iequals(a.s_cseq_method,"INVITE")&&c.o_hdr_CSeq.i_seq==a.i_cseq_value){d=a;break}}else{if(tsk_string_equals(a.s_branch,c.o_hdr_firstVia.s_branch)&&(1==1)){if(tsk_string_equals(a.s_cseq_method,c.o_hdr_CSeq.s_method)){d=a;break}else{if(c.is_cancel()||c.is_response_to_cancel()){d=a;break}}}}}this.b_locked=false;return d};tsip_transac_layer.prototype.handle_incoming_message=function(b){if(!b){tsk_utils_log_error("Invalid argument");return -1}var c=-1;var a=null;if(b.is_request()){a=this.find_server(b)}else{a=this.find_client(b)}if(a){c=a.callback(tsip_transac_event_type_e.INCOMING_MSG,b)}return c};