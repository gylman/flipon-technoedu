tsip_transac_nict.prototype=Object.create(tsip_transac.prototype);tsip_transac_nict.prototype.__b_debug_state_machine=false;var tsip_transac_nict_actions_e={CANCEL:tsip_action_type_e.CANCEL,SEND:10001,TIMER_E:10002,TIMER_F:10003,TIMER_K:10004,I_1xx:10005,I_200_to_699:10006,TRANSPORT_ERROR:10007,ERROR:10008};var tsip_transac_nict_states_e={STARTED:0,TRYING:1,PROCEEDING:2,COMPLETED:3,TERMINATED:4};function tsip_transac_nict(b,f,d,c,e){var a;if(!e||!(a=e.get_stack())){tsk_utils_log_error("Invalid argument");return null}tsip_transac.call(this);this.o_request=null;this.init(tsip_transac_type_e.NICT,b,f,d,c,e,tsip_transac_nict_states_e.STARTED,tsip_transac_nict_states_e.TERMINATED);this.set_callback(__tsip_transac_nict_event_callback);this.o_fsm.set_debug_enabled(tsip_transac_nict.prototype.__b_debug_state_machine);this.o_fsm.set_onterm_callback(__tsip_transac_nict_onterm,this);this.o_timerE=null;this.o_timerF=null;this.o_timerK=null;this.i_timerE=a.o_timers.getE();this.i_timerF=a.o_timers.getF();this.i_timerK=b?0:a.o_timers.getK();this.o_fsm.set(tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.STARTED,tsip_transac_nict_actions_e.SEND,tsip_transac_nict_states_e.TRYING,__tsip_transac_nict_Started_2_Trying_X_send,"__tsip_transac_nict_Started_2_Trying_X_send"),tsk_fsm_entry.prototype.CreateAlwaysNothing(tsip_transac_nict_states_e.STARTED,"tsip_transac_nict_Started_2_Started_X_any"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.TRYING,tsip_transac_nict_actions_e.TIMER_E,tsip_transac_nict_states_e.TRYING,__tsip_transac_nict_Trying_2_Trying_X_timerE,"__tsip_transac_nict_Trying_2_Trying_X_timerE"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.TRYING,tsip_transac_nict_actions_e.TIMER_F,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Trying_2_Terminated_X_timerF,"__tsip_transac_nict_Trying_2_Terminated_X_timerF"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.TRYING,tsip_transac_nict_actions_e.TRANSPORT_ERROR,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Trying_2_Terminated_X_transportError,"__tsip_transac_nict_Trying_2_Terminated_X_transportError"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.TRYING,tsip_transac_nict_actions_e.I_1xx,tsip_transac_nict_states_e.PROCEEDING,__tsip_transac_nict_Trying_2_Proceedding_X_1xx,"__tsip_transac_nict_Trying_2_Proceedding_X_1xx"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.TRYING,tsip_transac_nict_actions_e.I_200_to_699,tsip_transac_nict_states_e.COMPLETED,__tsip_transac_nict_Trying_2_Completed_X_200_to_699,"__tsip_transac_nict_Trying_2_Completed_X_200_to_699"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.PROCEEDING,tsip_transac_nict_actions_e.TIMER_E,tsip_transac_nict_states_e.PROCEEDING,__tsip_transac_nict_Proceeding_2_Proceeding_X_timerE,"__tsip_transac_nict_Proceeding_2_Proceeding_X_timerE"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.PROCEEDING,tsip_transac_nict_actions_e.TIMER_F,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Proceeding_2_Terminated_X_timerF,"__tsip_transac_nict_Proceeding_2_Terminated_X_timerF"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.PROCEEDING,tsip_transac_nict_actions_e.TRANSPORT_ERROR,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Proceeding_2_Terminated_X_transportError,"__tsip_transac_nict_Proceeding_2_Terminated_X_transportError"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.PROCEEDING,tsip_transac_nict_actions_e.I_1xx,tsip_transac_nict_states_e.PROCEEDING,__tsip_transac_nict_Proceeding_2_Proceeding_X_1xx,"__tsip_transac_nict_Proceeding_2_Proceeding_X_1xx"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.PROCEEDING,tsip_transac_nict_actions_e.I_200_to_699,tsip_transac_nict_states_e.COMPLETED,__tsip_transac_nict_Proceeding_2_Completed_X_200_to_699,"__tsip_transac_nict_Proceeding_2_Completed_X_200_to_699"),tsk_fsm_entry.prototype.CreateAlways(tsip_transac_nict_states_e.COMPLETED,tsip_transac_nict_actions_e.TIMER_K,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Completed_2_Terminated_X_timerK,"__tsip_transac_nict_Completed_2_Terminated_X_timerK"),tsk_fsm_entry.prototype.CreateAlways(tsk_fsm.prototype.__i_state_any,tsip_transac_nict_actions_e.TRANSPORT_ERROR,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Any_2_Terminated_X_transportError,"__tsip_transac_nict_Any_2_Terminated_X_transportError"),tsk_fsm_entry.prototype.CreateAlways(tsk_fsm.prototype.__i_state_any,tsip_transac_nict_actions_e.ERROR,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Any_2_Terminated_X_Error,"__tsip_transac_nict_Any_2_Terminated_X_Error"),tsk_fsm_entry.prototype.CreateAlways(tsk_fsm.prototype.__i_state_any,tsip_transac_nict_actions_e.CANCEL,tsip_transac_nict_states_e.TERMINATED,__tsip_transac_nict_Any_2_Terminated_X_cancel,"__tsip_transac_nict_Any_2_Terminated_X_cancel"))}tsip_transac_nict.prototype.start=function(a){var b=-1;if(a&&!this.b_running){if(a.is_cancel()){this.s_branch=a.o_hdr_firstVia?a.o_hdr_firstVia.s_branch:"doubango"}else{this.s_branch=tsk_string_format("{0}{1}",tsip_transac.prototype.__magic_cookie,tsk_string_random(32))}this.b_running=true;this.o_request=a;b=this.fsm_act(tsip_transac_nict_actions_e.SEND,a)}return b};function __tsip_transac_nict_Started_2_Trying_X_send(a){var b=a[0];var c=a[1];b.send(b.s_branch,c);b.timer_schedule("nict","F");if(!b.b_reliable){b.timer_schedule("nict","E")}return 0}function __tsip_transac_nict_Trying_2_Trying_X_timerE(a){var b=a[0];b.send(b.s_branch,b.o_request);b.i_timerE=Math.min(b.i_timerE<<1,b.get_stack().o_timers.getT2());b.timer_schedule("nict","E");return 0}function __tsip_transac_nict_Trying_2_Terminated_X_timerF(a){var b=a[0];b.get_dialog().callback(tsip_dialog_event_type_e.TIMEDOUT,b.o_request);return 0}function __tsip_transac_nict_Trying_2_Terminated_X_transportError(a){var b=a[0];b.get_dialog().callback(tsip_dialog_event_type_e.TRANSPORT_ERROR,b.o_request);return 0}function __tsip_transac_nict_Trying_2_Proceedding_X_1xx(a){var b=a[0];var c=a[1];if(!b.b_reliable){b.timer_cancel("E")}b.timer_cancel("F");b.get_dialog().callback(tsip_dialog_event_type_e.I_MSG,c);return 0}function __tsip_transac_nict_Trying_2_Completed_X_200_to_699(a){var b=a[0];var c=a[1];if(!b.b_reliable){b.timer_cancel("E")}b.timer_cancel("F");b.get_dialog().callback(tsip_dialog_event_type_e.I_MSG,c);b.timer_schedule("nict","K");return 0}function __tsip_transac_nict_Proceeding_2_Proceeding_X_timerE(a){var b=a[0];b.send(b.s_branch,b.o_request);b.i_timerE=Math.min(b.i_timerE<<1,b.get_stack().o_timers.getT2());b.timer_schedule("nict","E");return 0}function __tsip_transac_nict_Proceeding_2_Terminated_X_timerF(a){var b=a[0];b.get_dialog().callback(tsip_dialog_event_type_e.TRANSPORT_ERROR,null);return 0}function __tsip_transac_nict_Proceeding_2_Terminated_X_transportError(a){var b=a[0];b.get_dialog().callback(tsip_dialog_event_type_e.TRANSPORT_ERROR,null);return 0}function __tsip_transac_nict_Proceeding_2_Proceeding_X_1xx(a){var b=a[0];var c=a[1];if(!b.b_reliable){b.timer_cancel("E")}b.get_dialog().callback(tsip_dialog_event_type_e.I_MSG,c);return 0}function __tsip_transac_nict_Proceeding_2_Completed_X_200_to_699(a){var b=a[0];var c=a[1];if(!b.b_reliable){b.timer_cancel("E")}b.get_dialog().callback(tsip_dialog_event_type_e.I_MSG,c);b.timer_schedule("nict","K");return 0}function __tsip_transac_nict_Completed_2_Terminated_X_timerK(a){return 0}function __tsip_transac_nict_Any_2_Terminated_X_transportError(a){var b=a[0];return b.get_dialog().callback(tsip_dialog_event_type_e.TRANSPORT_ERROR,null)}function __tsip_transac_nict_Any_2_Terminated_X_Error(a){var b=a[0];return b.get_dialog().callback(tsip_dialog_event_type_e.ERROR,null)}function __tsip_transac_nict_Any_2_Terminated_X_cancel(a){return 0}function __tsip_transac_nict_onterm(a){a.timer_cancel("E");a.timer_cancel("F");a.timer_cancel("K");return a.deinit()}function __tsip_transac_nict_event_callback(a,c,b){if(!a){tsk_utils_log_error("Invalid argument");return -1}var d=0;switch(c){case tsip_transac_event_type_e.INCOMING_MSG:if(b&&b.is_response()){if(b.is_1xx()){d=a.fsm_act(tsip_transac_nict_actions_e.I_1xx,b)}else{if(b.is_23456()){d=a.fsm_act(tsip_transac_nict_actions_e.I_200_to_699,b)}else{tsk_utils_log_warn("Not supported status code: "+b.get_response_code())}}}break;case tsip_transac_event_type_e.CANCELED:case tsip_transac_event_type_e.TERMINATED:case tsip_transac_event_type_e.TIMEDOUT:break;case tsip_transac_event_type_e.ERROR:d=a.fsm_act(tsip_transac_nict_actions_e.ERROR,b);break;case tsip_transac_event_type_e.TRANSPORT_ERROR:d=a.fsm_act(tsip_transac_nict_actions_e.TRANSPORT_ERROR,b);break}return d}function __tsip_transac_nict_timer_callback(b,a){if(b){if(a==b.o_timerE){b.fsm_act(tsip_transac_nict_actions_e.TIMER_E,null)}else{if(a==b.o_timerF){b.fsm_act(tsip_transac_nict_actions_e.TIMER_F,null)}else{if(a==b.o_timerK){b.fsm_act(tsip_transac_nict_actions_e.TIMER_K,null)}}}}};