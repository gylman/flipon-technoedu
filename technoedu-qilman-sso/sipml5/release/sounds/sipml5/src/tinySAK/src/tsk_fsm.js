tsk_fsm.prototype.__i_state_any=-65535;tsk_fsm.prototype.__i_state_default=-65520;tsk_fsm.prototype.__i_state_none=-65280;tsk_fsm.prototype.__i_state_final=-61440;tsk_fsm.prototype.__i_action_any=-65535;function tsk_fsm(c,a,d,b){this.i_state_curr=c;this.i_state_term=a;this.fn_onterm=d;this.o_usr_data=b;this.ao_entries=new Array();this.b_debug=false}tsk_fsm.prototype.is_terminated=function(){return this.i_state_curr==this.i_state_term};tsk_fsm.prototype.is_debug_enabled=function(){return this.b_debug};tsk_fsm.prototype.set_debug_enabled=function(a){this.b_debug=a};tsk_fsm.prototype.set_onterm_callback=function(b,a){this.fn_onterm=b;this.o_usr_data=a};tsk_fsm.prototype.get_usr_data=function(){return this.o_usr_data};tsk_fsm.prototype.set=function(){for(var a=0;a<arguments.length;++a){if(arguments[a]){this.ao_entries.push(arguments[a])}}this.ao_entries.sort(tsk_fsm_entry_compare);return 0};tsk_fsm.prototype.act=function(k,g,f){var a=false;var b=false;var d=0;var c;if(this.is_terminated()){tsk_utils_log_warn("The FSM is in the final state");return -2}this.b_locked=true;for(var h=0;h<this.ao_entries.length;++h){if(!(c=this.ao_entries[h])){continue}if((c.i_state_from!=tsk_fsm.prototype.__i_state_any)&&(c.i_state_from!=this.i_state_curr)){continue}if((c.i_action!=tsk_fsm.prototype.__i_action_any)&&(c.i_action!=k)){continue}if(!c.fn_condition||c.fn_condition(g,f)){if(this.is_debug_enabled()){tsk_utils_log_info("State machine: "+c.s_description)}if(c.i_state_to!=tsk_fsm.prototype.__i_state_any){this.i_state_curr=c.i_state_to}if(c.fn_execute){try{if((d=c.fn_execute(Array.prototype.slice.call(arguments,3)))){tsk_utils_log_info("State machine: Exec function failed. Moving to the termnial state")}}catch(j){tsk_utils_log_error(j);d=-3}}else{d=0}b=(d!=0||(this.i_state_curr==this.i_state_term));a=true;break}}if(b){this.i_state_curr=this.i_state_term;if(this.fn_onterm){this.fn_onterm(this.o_usr_data)}}this.b_locked=false;return d};function tsk_fsm_entry(f,d,c,b,a,e){this.i_state_from=f;this.i_action=d;this.fn_condition=c;this.i_state_to=b;this.fn_execute=a;this.s_description=e}tsk_fsm_entry.prototype.Create=function(f,d,c,b,a,e){return new tsk_fsm_entry(f,d,c,b,a,e)};tsk_fsm_entry.prototype.CreateAlways=function(e,c,b,a,d){return new tsk_fsm_entry(e,c,null,b,a,d)};tsk_fsm_entry.prototype.CreateNothing=function(d,b,a,c){return new tsk_fsm_entry(d,b,a,d,null,c)};tsk_fsm_entry.prototype.CreateAlwaysNothing=function(b,a){return new tsk_fsm_entry(b,tsk_fsm.prototype.__i_action_any,null,b,null,a)};function tsk_fsm_entry_compare(b,a){if(b&&a){if(b.i_state_from==tsk_fsm.prototype.__i_state_any){return +20}else{if(a.i_state_from==tsk_fsm.prototype.__i_state_any){return -20}}if(b.i_action==tsk_fsm.prototype.__i_action_any){return +10}else{if(a.i_action==tsk_fsm.prototype.__i_action_any){return -10}}return b.fn_condition?-1:(a.fn_condition?1:0)}return 0};