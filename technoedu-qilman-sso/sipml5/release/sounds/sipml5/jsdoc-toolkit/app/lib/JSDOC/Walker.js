if(typeof JSDOC=="undefined"){JSDOC={}}JSDOC.Walker=function(a){this.init();if(typeof a!="undefined"){this.walk(a)}};JSDOC.Walker.prototype.init=function(){this.ts=null;var a=new JSDOC.Symbol("_global_",[],"GLOBAL",new JSDOC.DocComment(""));a.isNamespace=true;a.srcFile="";a.isPrivate=false;JSDOC.Parser.addSymbol(a);this.lastDoc=null;this.token=null;this.namescope=[a];this.namescope.last=function(b){if(!b){b=0}return this[this.length-(1+b)]||""}};JSDOC.Walker.prototype.walk=function(a){this.ts=a;while(this.token=this.ts.look()){if(this.token.popNamescope){var b=this.namescope.pop();if(b.is("FUNCTION")){if(this.ts.look(1).is("LEFT_PAREN")&&b.comment.getTag("function").length==0){b.isa="OBJECT"}}}this.step();if(!this.ts.next()){break}}};JSDOC.Walker.prototype.step=function(){if(this.token.is("JSDOC")){var o=new JSDOC.DocComment(this.token.data);if(o.getTag("exports").length>0){var f=o.getTag("exports")[0];f.desc.match(/(\S+) as (\S+)/i);var m=RegExp.$1;var l=RegExp.$2;if(!m&&l){throw"@exports tag requires a value like: 'name as ns.name'"}JSDOC.Parser.rename=(JSDOC.Parser.rename||{});JSDOC.Parser.rename[m]=l}if(o.getTag("lends").length>0){var g=o.getTag("lends")[0];var b=g.desc;if(!b){throw"@lends tag requires a value."}var d=new JSDOC.Symbol(b,[],"OBJECT",o);this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}this.lastDoc=null;return true}else{if(o.getTag("name").length>0&&o.getTag("overview").length==0){var r=o.getTag("name")[0].desc;if(!r){throw"@name tag requires a value."}if(o.getTag("memberOf").length>0){r=(o.getTag("memberOf")[0]+"."+r).replace(/([#.])\./,"$1");o.deleteTag("memberOf")}var d=new JSDOC.Symbol(r,[],"VIRTUAL",o);JSDOC.Parser.addSymbol(d);this.lastDoc=null;return true}else{if(o.meta){if(o.meta=="@+"){JSDOC.DocComment.shared=o.src}else{if(o.meta=="@-"){JSDOC.DocComment.shared=""}else{if(o.meta=="nocode+"){JSDOC.Parser.conf.ignoreCode=true}else{if(o.meta=="nocode-"){JSDOC.Parser.conf.ignoreCode=JSDOC.opt.n}else{throw"Unrecognized meta comment: "+o.meta}}}}this.lastDoc=null;return true}else{if(o.getTag("overview").length>0){d=new JSDOC.Symbol("",[],"FILE",o);JSDOC.Parser.addSymbol(d);this.lastDoc=null;return true}else{this.lastDoc=o;return false}}}}}else{if(!JSDOC.Parser.conf.ignoreCode){if(this.token.is("NAME")){var d;var b=this.token.data;var o=null;if(this.lastDoc){o=this.lastDoc}var e=[];if(this.ts.look(1).is("COLON")&&this.ts.look(-1).is("LEFT_CURLY")&&!(this.ts.look(-2).is("JSDOC")||this.namescope.last().comment.getTag("lends").length||this.ts.look(-2).is("ASSIGN")||this.ts.look(-2).is("COLON"))){b="$anonymous";b=this.namescope.last().alias+"-"+b;e=[];d=new JSDOC.Symbol(b,e,"OBJECT",o);JSDOC.Parser.addSymbol(d);this.namescope.push(d);var a=this.ts.getMatchingToken(null,"RIGHT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(-1).is("FUNCTION")&&this.ts.look(1).is("LEFT_PAREN")){var q;if(this.lastDoc){o=this.lastDoc}if(o&&o.getTag("memberOf").length>0){b=(o.getTag("memberOf")[0]+"."+b).replace("#.","#");o.deleteTag("memberOf")}else{b=this.namescope.last().alias+"-"+b;if(!this.namescope.last().is("GLOBAL")){q=true}}if(!this.namescope.last().is("GLOBAL")){q=true}e=JSDOC.Walker.onParamList(this.ts.balance("LEFT_PAREN"));d=new JSDOC.Symbol(b,e,"FUNCTION",o);if(q){d.isInner=true}if(this.ts.look(1).is("JSDOC")){var c=""+this.ts.look(1).data;c=c.replace(/(^\/\*\* *| *\*\/$)/g,"");d.type=c}JSDOC.Parser.addSymbol(d);this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(1).is("ASSIGN")&&this.ts.look(2).is("FUNCTION")){var k;var n=false;if(o&&(k=o.getTag("constructs"))&&k.length){if(k[0].desc){b=k[0].desc;n=true}}var q;if(this.ts.look(-1).is("VAR")||this.isInner){if(o&&o.getTag("memberOf").length>0){b=(o.getTag("memberOf")[0]+"."+b).replace("#.","#");o.deleteTag("memberOf")}else{b=this.namescope.last().alias+"-"+b;if(!this.namescope.last().is("GLOBAL")){q=true}}if(!this.namescope.last().is("GLOBAL")){q=true}}else{if(b.indexOf("this.")==0){b=this.resolveThis(b)}}if(this.lastDoc){o=this.lastDoc}e=JSDOC.Walker.onParamList(this.ts.balance("LEFT_PAREN"));d=new JSDOC.Symbol(b,e,"FUNCTION",o);if(q){d.isInner=true}if(n){d.isa="CONSTRUCTOR"}if(this.ts.look(1).is("JSDOC")){var c=""+this.ts.look(1).data;c=c.replace(/(^\/\*\* *| *\*\/$)/g,"");d.type=c}JSDOC.Parser.addSymbol(d);this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(1).is("ASSIGN")&&(this.ts.look(2).is("NEW")||this.ts.look(2).is("LEFT_PAREN"))&&this.ts.look(3).is("FUNCTION")){var q;if(this.ts.look(-1).is("VAR")||this.isInner){b=this.namescope.last().alias+"-"+b;if(!this.namescope.last().is("GLOBAL")){q=true}}else{if(b.indexOf("this.")==0){b=this.resolveThis(b)}}this.ts.next(3);if(this.lastDoc){o=this.lastDoc}e=JSDOC.Walker.onParamList(this.ts.balance("LEFT_PAREN"));d=new JSDOC.Symbol(b,e,"OBJECT",o);if(q){d.isInner=true}if(this.ts.look(1).is("JSDOC")){var c=""+this.ts.look(1).data;c=c.replace(/(^\/\*\* *| *\*\/$)/g,"");d.type=c}JSDOC.Parser.addSymbol(d);d.scopeType="INSTANCE";this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(1).is("COLON")&&this.ts.look(2).is("FUNCTION")){b=(this.namescope.last().alias+"."+b).replace("#.","#");if(this.lastDoc){o=this.lastDoc}e=JSDOC.Walker.onParamList(this.ts.balance("LEFT_PAREN"));if(o&&o.getTag("constructs").length){b=b.replace(/\.prototype(\.|$)/,"#");if(b.indexOf("#")>-1){b=b.match(/(^[^#]+)/)[0]}else{b=this.namescope.last().alias}d=new JSDOC.Symbol(b,e,"CONSTRUCTOR",o)}else{d=new JSDOC.Symbol(b,e,"FUNCTION",o)}if(this.ts.look(1).is("JSDOC")){var c=""+this.ts.look(1).data;c=c.replace(/(^\/\*\* *| *\*\/$)/g,"");d.type=c}JSDOC.Parser.addSymbol(d);this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(1).is("ASSIGN")&&this.ts.look(2).is("LEFT_CURLY")){var q;if(this.ts.look(-1).is("VAR")||this.isInner){b=this.namescope.last().alias+"-"+b;if(!this.namescope.last().is("GLOBAL")){q=true}}else{if(b.indexOf("this.")==0){b=this.resolveThis(b)}}if(this.lastDoc){o=this.lastDoc}d=new JSDOC.Symbol(b,e,"OBJECT",o);if(q){d.isInner=true}if(o){JSDOC.Parser.addSymbol(d)}this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(1).is("SEMICOLON")){var q;if(this.ts.look(-1).is("VAR")||this.isInner){b=this.namescope.last().alias+"-"+b;if(!this.namescope.last().is("GLOBAL")){q=true}if(this.lastDoc){o=this.lastDoc}d=new JSDOC.Symbol(b,e,"OBJECT",o);if(q){d.isInner=true}if(o){JSDOC.Parser.addSymbol(d)}}}else{if(this.ts.look(1).is("ASSIGN")){var q;if(this.ts.look(-1).is("VAR")||this.isInner){b=this.namescope.last().alias+"-"+b;if(!this.namescope.last().is("GLOBAL")){q=true}}else{if(b.indexOf("this.")==0){b=this.resolveThis(b)}}if(this.lastDoc){o=this.lastDoc}d=new JSDOC.Symbol(b,e,"OBJECT",o);if(q){d.isInner=true}if(o){JSDOC.Parser.addSymbol(d)}}else{if(this.ts.look(1).is("COLON")&&this.ts.look(2).is("LEFT_CURLY")){b=(this.namescope.last().alias+"."+b).replace("#.","#");if(this.lastDoc){o=this.lastDoc}d=new JSDOC.Symbol(b,e,"OBJECT",o);if(o){JSDOC.Parser.addSymbol(d)}this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}else{if(this.ts.look(1).is("COLON")){b=(this.namescope.last().alias+"."+b).replace("#.","#");if(this.lastDoc){o=this.lastDoc}d=new JSDOC.Symbol(b,e,"OBJECT",o);if(o){JSDOC.Parser.addSymbol(d)}}else{if(this.ts.look(1).is("LEFT_PAREN")){if(typeof JSDOC.PluginManager!="undefined"){var j={name:b};var p=this.ts.cursor;e=JSDOC.Walker.onParamList(this.ts.balance("LEFT_PAREN"));this.ts.cursor=p;for(var h=0;h<e.length;h++){j["arg"+(h+1)]=e[h].name}JSDOC.PluginManager.run("onFunctionCall",j);if(j.doc){this.ts.insertAhead(new JSDOC.Token(j.doc,"COMM","JSDOC"))}}}}}}}}}}}}}this.lastDoc=null}else{if(this.token.is("FUNCTION")){if((!this.ts.look(-1).is("COLON")||!this.ts.look(-1).is("ASSIGN"))&&!this.ts.look(1).is("NAME")){if(this.lastDoc){o=this.lastDoc}b="$anonymous";b=this.namescope.last().alias+"-"+b;e=JSDOC.Walker.onParamList(this.ts.balance("LEFT_PAREN"));d=new JSDOC.Symbol(b,e,"FUNCTION",o);JSDOC.Parser.addSymbol(d);this.namescope.push(d);var a=this.ts.getMatchingToken("LEFT_CURLY");if(a){a.popNamescope=b}else{LOG.warn("Mismatched } character. Can't parse code in file "+d.srcFile+".")}}}}}}return true};JSDOC.Walker.prototype.resolveThis=function(b){b.match(/^this\.(.+)$/);var e=RegExp.$1;if(!e){return b}var d=this.namescope.last();var a=d.scopeType||d.isa;if(a=="CONSTRUCTOR"){b=d.alias+"#"+e}else{if(a=="INSTANCE"){b=d.alias+"."+e}else{if(a=="FUNCTION"){if(d.alias.match(/(^.*)[#.-][^#.-]+/)){var f=RegExp.$1;var c=JSDOC.Parser.symbols.getSymbol(f);if(!c){if(JSDOC.Lang.isBuiltin(f)){c=JSDOC.Parser.addBuiltin(f)}else{if(d.alias.indexOf("$anonymous")<0){LOG.warn("Trying to document "+d.alias+" without first documenting "+f+".")}}}if(c){b=f+(c.is("CONSTRUCTOR")?"#":".")+e}}else{c=this.namescope.last(1);b=c.alias+(c.is("CONSTRUCTOR")?"#":".")+e}}else{b=e}}}return b};JSDOC.Walker.onParamList=function(b){if(!b){LOG.warn("Malformed parameter list. Can't parse code.");return[]}var d=[];for(var c=0,a=b.length;c<a;c++){if(b[c].is("JSDOC")){var e=b[c].data.replace(/(^\/\*\* *| *\*\/$)/g,"");if(b[c+1]&&b[c+1].is("NAME")){c++;d.push({type:e,name:b[c].data})}}else{if(b[c].is("NAME")){d.push({name:b[c].data})}}}return d};