JSDOC.JsPlate=function(a){if(a){this.template=IO.readFile(a)}this.templateFile=a;this.code="";this.parse()};JSDOC.JsPlate.prototype.parse=function(){this.template=this.template.replace(/\{#[\s\S]+?#\}/gi,"");this.code="var output=\u001e"+this.template;this.code=this.code.replace(/<for +each="(.+?)" +in="(.+?)" *>/gi,function(a,b,c){return"\u001e;\rvar $"+b+"_keys = keys("+c+");\rfor(var $"+b+"_i = 0; $"+b+"_i < $"+b+"_keys.length; $"+b+"_i++) {\rvar $"+b+"_last = ($"+b+"_i == $"+b+"_keys.length-1);\rvar $"+b+"_key = $"+b+"_keys[$"+b+"_i];\rvar "+b+" = "+c+"[$"+b+"_key];\routput+=\u001e"});this.code=this.code.replace(/<if test="(.+?)">/g,"\u001e;\rif ($1) { output+=\u001e");this.code=this.code.replace(/<elseif test="(.+?)"\s*\/>/g,"\u001e;}\relse if ($1) { output+=\u001e");this.code=this.code.replace(/<else\s*\/>/g,"\u001e;}\relse { output+=\u001e");this.code=this.code.replace(/<\/(if|for)>/g,"\u001e;\r};\routput+=\u001e");this.code=this.code.replace(/\{\+\s*([\s\S]+?)\s*\+\}/gi,function(a,b){b=b.replace(/"/g,"\u001e");b=b.replace(/(\r?\n)/g," ");return"\u001e+ ("+b+") +\u001e"});this.code=this.code.replace(/\{!\s*([\s\S]+?)\s*!\}/gi,function(a,b){b=b.replace(/"/g,"\u001e");b=b.replace(/(\n)/g," ");return"\u001e; "+b+";\routput+=\u001e"});this.code=this.code+"\u001e;";this.code=this.code.replace(/(\r?\n)/g,"\\n");this.code=this.code.replace(/"/g,'\\"');this.code=this.code.replace(/\u001e/g,'"')};JSDOC.JsPlate.prototype.toCode=function(){return this.code};JSDOC.JsPlate.keys=function(c){var b=[];if(c.constructor.toString().indexOf("Array")>-1){for(var a=0;a<c.length;a++){b.push(a)}}else{for(var a in c){b.push(a)}}return b};JSDOC.JsPlate.values=function(c){var a=[];if(c.constructor.toString().indexOf("Array")>-1){for(var b=0;b<c.length;b++){a.push(c[b])}}else{for(var b in c){a.push(c[b])}}return a};JSDOC.JsPlate.prototype.process=function(data,compact){var keys=JSDOC.JsPlate.keys;var values=JSDOC.JsPlate.values;try{eval(this.code)}catch(e){print(">> There was an error evaluating the compiled code from template: "+this.templateFile);print("   The error was on line "+e.lineNumber+" "+e.name+": "+e.message);var lines=this.code.split("\r");if(e.lineNumber-2>=0){print("line "+(e.lineNumber-1)+": "+lines[e.lineNumber-2])}print("line "+e.lineNumber+": "+lines[e.lineNumber-1]);print("")}if(compact){output=output.replace(/\s+?(\r?)\n/g,"$1\n")}return output};