!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SIP=t():e.SIP=t()}(this,function(){return i={},n.m=r=[function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(2);t.DigestAuthentication=n.DigestAuthentication,t.Grammar=n.Grammar,t.IncomingRequest=n.IncomingRequestMessage,t.IncomingResponse=n.IncomingResponseMessage,t.LoggerFactory=n.LoggerFactory,t.NameAddrHeader=n.NameAddrHeader,t.OutgoingRequest=n.OutgoingRequestMessage,t.Parser=n.Parser,t.Timers=n.Timers,t.URI=n.URI;var s=r(79);t.ClientContext=s.ClientContext;var o=r(80);t.C=o.C;var a=r(82);t.DialogStatus=a.DialogStatus,t.SessionStatus=a.SessionStatus,t.TypeStrings=a.TypeStrings,t.UAStatus=a.UAStatus;var c=r(84);t.Exceptions=c.Exceptions;var u=r(85);t.PublishContext=u.PublishContext;var d=r(86);t.ReferClientContext=d.ReferClientContext,t.ReferServerContext=d.ReferServerContext;var p=r(88);t.RegisterContext=p.RegisterContext;var l=r(87);t.ServerContext=l.ServerContext;var h=r(89);t.InviteClientContext=h.InviteClientContext,t.InviteServerContext=h.InviteServerContext,t.Session=h.Session;var g=r(92);t.Subscription=g.Subscription;var f=r(93);t.Transport=f.Transport;var v=r(28),m={InviteClientTransaction:v.InviteClientTransaction,InviteServerTransaction:v.InviteServerTransaction,NonInviteClientTransaction:v.NonInviteClientTransaction,NonInviteServerTransaction:v.NonInviteServerTransaction};t.Transactions=m;var S=r(94);t.makeUserAgentCoreConfigurationFromUA=S.makeUserAgentCoreConfigurationFromUA,t.UA=S.UA;var T=r(83);t.Utils=T.Utils;var y=i.__importStar(r(111));t.Web=y;var E=o.C.version;t.version=E;t.name="sip.js";var b=i.__importStar(r(2));t.Core=b},function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",function(){return n}),r.d(t,"__assign",function(){return s}),r.d(t,"__rest",function(){return o}),r.d(t,"__decorate",function(){return a}),r.d(t,"__param",function(){return c}),r.d(t,"__metadata",function(){return u}),r.d(t,"__awaiter",function(){return d}),r.d(t,"__generator",function(){return p}),r.d(t,"__exportStar",function(){return l}),r.d(t,"__values",function(){return h}),r.d(t,"__read",function(){return g}),r.d(t,"__spread",function(){return f}),r.d(t,"__spreadArrays",function(){return v}),r.d(t,"__await",function(){return m}),r.d(t,"__asyncGenerator",function(){return S}),r.d(t,"__asyncDelegator",function(){return T}),r.d(t,"__asyncValues",function(){return y}),r.d(t,"__makeTemplateObject",function(){return E}),r.d(t,"__importStar",function(){return b}),r.d(t,"__importDefault",function(){return C});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function n(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function o(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function a(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(o=(s<3?n(o):3<s?n(t,r,o):n(t,r))||o);return 3<s&&o&&Object.defineProperty(t,r,o),o}function c(r,i){return function(e,t){i(e,t,r)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(s,o,a,c){return new(a=a||Promise)(function(e,t){function r(e){try{n(c.next(e))}catch(e){t(e)}}function i(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,i)}n((c=c.apply(s,o||[])).next())})}function p(r,i){var n,s,o,e,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=i.call(r,a)}catch(e){t=[6,e],s=0}finally{n=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function l(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function h(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function g(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function v(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function m(e){return this instanceof m?(this.v=e,this):new m(e)}function S(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=r.apply(e,t||[]),o=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(i){s[i]&&(n[i]=function(r){return new Promise(function(e,t){1<o.push([i,r,e,t])||a(i,r)})})}function a(e,t){try{(r=s[e](t)).value instanceof m?Promise.resolve(r.value.v).then(c,u):d(o[0][2],r)}catch(e){d(o[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function T(i){var e,n;return e={},t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,r){e[t]=i[t]?function(e){return(n=!n)?{value:m(i[t](e)),done:"return"===t}:r?r(e):e}:r}}function y(c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=c[Symbol.asyncIterator];return t?t.call(c):(c=h(c),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(a){e[a]=c[a]&&function(o){return new Promise(function(e,t){var r,i,n,s;o=c[a](o),r=e,i=t,n=o.done,s=o.value,Promise.resolve(s).then(function(e){r({value:e,done:n})},i)})}}}function E(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function C(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(3),t),i.__exportStar(r(32),t),i.__exportStar(r(61),t),i.__exportStar(r(5),t),i.__exportStar(r(25),t),i.__exportStar(r(57),t),i.__exportStar(r(28),t),i.__exportStar(r(65),t),i.__exportStar(r(67),t),i.__exportStar(r(27),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(4),t),i.__exportStar(r(24),t),i.__exportStar(r(56),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=r(5),i=(n.initialDialogStateForUserAgentClient=function(e,t){var r=t.getHeaders("record-route").reverse(),i=t.parseHeader("contact");if(!i)throw new Error("Contact undefined.");if(!(i instanceof p.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var n=i.uri,s=e.cseq,o=e.callId,a=e.fromTag,c=t.toTag;if(!o)throw new Error("Call id undefined.");if(!a)throw new Error("From tag undefined.");if(!c)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");var u=e.from.uri,d=e.to.uri;if(!t.statusCode)throw new Error("Incoming response status code undefined.");return{id:o+a+c,early:t.statusCode<200,callId:o,localTag:a,remoteTag:c,localSequenceNumber:s,remoteSequenceNumber:void 0,localURI:u,remoteURI:d,remoteTarget:n,routeSet:r,secure:!1}},n.initialDialogStateForUserAgentServer=function(e,t,r){void 0===r&&(r=!1);var i=e.getHeaders("record-route"),n=e.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof p.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var s=n.uri,o=e.cseq,a=e.callId,c=e.fromTag,u=e.from.uri;return{id:a+t+c,early:r,callId:a,localTag:t,remoteTag:c,localSequenceNumber:void 0,remoteSequenceNumber:o,localURI:e.to.uri,remoteURI:u,remoteTarget:s,routeSet:i,secure:!1}},n.prototype.dispose=function(){this.core.dialogs.delete(this.id)},Object.defineProperty(n.prototype,"id",{get:function(){return this.dialogState.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"early",{get:function(){return this.dialogState.early},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"callId",{get:function(){return this.dialogState.callId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localTag",{get:function(){return this.dialogState.localTag},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteTag",{get:function(){return this.dialogState.remoteTag},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localSequenceNumber",{get:function(){return this.dialogState.localSequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteSequenceNumber",{get:function(){return this.dialogState.remoteSequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localURI",{get:function(){return this.dialogState.localURI},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteURI",{get:function(){return this.dialogState.remoteURI},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteTarget",{get:function(){return this.dialogState.remoteTarget},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"routeSet",{get:function(){return this.dialogState.routeSet},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"secure",{get:function(){return this.dialogState.secure},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"userAgentCore",{get:function(){return this.core},enumerable:!0,configurable:!0}),n.prototype.confirm=function(){this.dialogState.early=!1},n.prototype.receiveRequest=function(e){if(e.method!==p.C.ACK){if(this.remoteSequenceNumber){if(e.cseq<=this.remoteSequenceNumber)throw new Error("Out of sequence in dialog request. Did you forget to call sequenceGuard()?");this.dialogState.remoteSequenceNumber=e.cseq}this.remoteSequenceNumber||(this.dialogState.remoteSequenceNumber=e.cseq)}},n.prototype.recomputeRouteSet=function(e){this.dialogState.routeSet=e.getHeaders("record-route").reverse()},n.prototype.createOutgoingRequestMessage=function(e,t){var r,i=this.remoteURI,n=this.remoteTag,s=this.localURI,o=this.localTag,a=this.callId;r=t&&t.cseq?t.cseq:this.dialogState.localSequenceNumber?this.dialogState.localSequenceNumber+=1:this.dialogState.localSequenceNumber=1;var c=this.remoteTarget,u=this.routeSet,d=t&&t.extraHeaders,p=t&&t.body;return this.userAgentCore.makeOutgoingRequestMessage(e,c,s,i,{callId:a,cseq:r,fromTag:o,toTag:n,routeSet:u},d,p)},n.prototype.sequenceGuard=function(e){return!(e.method!==p.C.ACK&&this.remoteSequenceNumber&&e.cseq<=this.remoteSequenceNumber&&(this.core.replyStateless(e,{statusCode:500}),1))},n);function n(e,t){this.core=e,this.dialogState=t,this.core.dialogs.set(this.id,this)}t.Dialog=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(6),t),i.__exportStar(r(8),t),i.__exportStar(r(19),t),i.__exportStar(r(11),t),i.__exportStar(r(10),t),i.__exportStar(r(9),t),i.__exportStar(r(17),t),i.__exportStar(r(13),t),i.__exportStar(r(18),t),i.__exportStar(r(22),t),i.__exportStar(r(14),t),i.__exportStar(r(23),t),i.__exportStar(r(15),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(1).__exportStar(r(7),t)},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.C||(t.C={})).ACK="ACK",i.BYE="BYE",i.CANCEL="CANCEL",i.INFO="INFO",i.INVITE="INVITE",i.MESSAGE="MESSAGE",i.NOTIFY="NOTIFY",i.OPTIONS="OPTIONS",i.REGISTER="REGISTER",i.UPDATE="UPDATE",i.SUBSCRIBE="SUBSCRIBE",i.PUBLISH="PUBLISH",i.REFER="REFER",i.PRACK="PRACK"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(9),o=r(17),a=r(18);function c(e){return!(!e||"string"!=typeof e.content||"string"!=typeof e.contentType||void 0!==e.contentDisposition)||"string"==typeof e.contentDisposition}function u(e){return"application/sdp"===e?"session":"render"}t.fromBodyLegacy=function(e){var t="string"==typeof e?e:e.body,r="string"==typeof e?"application/sdp":e.contentType;return{contentDisposition:u(r),contentType:r,content:t}},t.getBody=function(e){var t,r,i,n;if(e instanceof s.IncomingRequestMessage&&e.body&&(t=(n=e.parseHeader("Content-Disposition"))?n.type:void 0,r=e.parseHeader("Content-Type"),i=e.body),e instanceof o.IncomingResponseMessage&&e.body&&(t=(n=e.parseHeader("Content-Disposition"))?n.type:void 0,r=e.parseHeader("Content-Type"),i=e.body),e instanceof a.OutgoingRequestMessage&&e.body)if(t=e.getHeader("Content-Disposition"),r=e.getHeader("Content-Type"),"string"==typeof e.body){if(!r)throw new Error("Header content type header does not equal body content type.");i=e.body}else{if(r&&r!==e.body.contentType)throw new Error("Header content type header does not equal body content type.");r=e.body.contentType,i=e.body.body}if(c(e)&&(t=e.contentDisposition,r=e.contentType,i=e.content),i){if(r&&!t&&(t=u(r)),!t)throw new Error("Content disposition undefined.");if(!r)throw new Error("Content type undefined.");return{contentDisposition:t,contentType:r,content:i}}},t.isBody=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(10),o=(i=s.IncomingMessage,n.__extends(a,i),a);function a(){return i.call(this)||this}t.IncomingRequestMessage=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(11),o=r(16),i=(n.prototype.addHeader=function(e,t){var r={raw:t};e=o.headerize(e),this.headers[e]?this.headers[e].push(r):this.headers[e]=[r]},n.prototype.getHeader=function(e){var t=this.headers[o.headerize(e)];if(t)return t[0]?t[0].raw:void 0},n.prototype.getHeaders=function(e){var t=this.headers[o.headerize(e)],r=[];if(!t)return[];for(var i=0,n=t;i<n.length;i++){var s=n[i];r.push(s.raw)}return r},n.prototype.hasHeader=function(e){return!!this.headers[o.headerize(e)]},n.prototype.parseHeader=function(e,t){if(void 0===t&&(t=0),e=o.headerize(e),this.headers[e]&&!(t>=this.headers[e].length)){var r=this.headers[e][t],i=r.raw;if(r.parsed)return r.parsed;var n=s.Grammar.parse(i,e.replace(/-/g,"_"));return-1===n?void this.headers[e].splice(t,1):r.parsed=n}},n.prototype.s=function(e,t){return void 0===t&&(t=0),this.parseHeader(e,t)},n.prototype.setHeader=function(e,t){this.headers[o.headerize(e)]=[{raw:t}]},n.prototype.toString=function(){return this.data},n);function n(){this.headers={}}t.IncomingMessage=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1).__importStar(r(12));(i=t.Grammar||(t.Grammar={})).parse=function(e,t){var r={startRule:t};try{n.parse(e,r)}catch(e){r.data=-1}return r.data},i.nameAddrHeaderParse=function(e){var t=i.parse(e,"Name_Addr_Header");return-1!==t?t:void 0},i.URIParse=function(e){var t=i.parse(e,"SIP_URI");return-1!==t?t:void 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),C=r(13),_=r(15),R=(s=Error,i.__extends(o,s),o.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function s(e){switch(e.type){case"literal":return'"'+i(e.text)+'"';case"class":var t=e.parts.map(function(e){return Array.isArray(e)?n(e[0])+"-"+n(e[1]):n(e)});return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){var t,r,i=e.map(s);if(i.sort(),0<i.length){for(r=t=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+((o=t)?'"'+i(o)+'"':"end of input")+" found.";var o},o);function o(e,t,r,i){var n=s.call(this)||this;return n.message=e,n.expected=t,n.found=r,n.location=i,n.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(n,o),n}t.SyntaxError=R,t.parse=function(u,r){r=void 0!==r?r:{};var e,d={},t={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231},i=119,p=["\r\n",v("\r\n",!1),/^[0-9]/,m([["0","9"]],!1,!1),/^[a-zA-Z]/,m([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,m([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,m([["\0","ÿ"]],!1,!1),/^["]/,m(['"'],!1,!1)," ",v(" ",!1),"\t",v("\t",!1),/^[a-zA-Z0-9]/,m([["a","z"],["A","Z"],["0","9"]],!1,!1),";",v(";",!1),"/",v("/",!1),"?",v("?",!1),":",v(":",!1),"@",v("@",!1),"&",v("&",!1),"=",v("=",!1),"+",v("+",!1),"$",v("$",!1),",",v(",",!1),"-",v("-",!1),"_",v("_",!1),".",v(".",!1),"!",v("!",!1),"~",v("~",!1),"*",v("*",!1),"'",v("'",!1),"(",v("(",!1),")",v(")",!1),"%",v("%",!1),function(){return" "},function(){return":"},/^[!-~]/,m([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,m([["","￿"]],!1,!1),/^[\x80-\xBF]/,m([["","¿"]],!1,!1),/^[a-f]/,m([["a","f"]],!1,!1),"`",v("`",!1),"<",v("<",!1),">",v(">",!1),"\\",v("\\",!1),"[",v("[",!1),"]",v("]",!1),"{",v("{",!1),"}",v("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,m([["!","'"]],!1,!1),/^[*-[]/,m([["*","["]],!1,!1),/^[\]-~]/,m([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,m([["#","["]],!1,!1),/^[\0-\t]/,m([["\0","\t"]],!1,!1),/^[\x0B-\f]/,m([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,m([["",""]],!1,!1),function(){(r=r||{data:{}}).data.uri=new _.URI(r.data.scheme,r.data.user,r.data.host,r.data.port),delete r.data.scheme,delete r.data.user,delete r.data.host,delete r.data.host_type,delete r.data.port},function(){(r=r||{data:{}}).data.uri=new _.URI(r.data.scheme,r.data.user,r.data.host,r.data.port,r.data.uri_params,r.data.uri_headers),delete r.data.scheme,delete r.data.user,delete r.data.host,delete r.data.host_type,delete r.data.port,delete r.data.uri_params,"SIP_URI"===r.startRule&&(r.data=r.data.uri)},"sips",v("sips",!0),"sip",v("sip",!0),function(e){(r=r||{data:{}}).data.scheme=e},function(){(r=r||{data:{}}).data.user=decodeURIComponent(a().slice(0,-1))},function(){(r=r||{data:{}}).data.password=a()},function(){return(r=r||{data:{}}).data.host=a(),r.data.host},function(){return(r=r||{data:{}}).data.host_type="domain",a()},/^[a-zA-Z0-9_\-]/,m([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,m([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return(r=r||{data:{}}).data.host_type="IPv6",a()},"::",v("::",!1),function(){return(r=r||{data:{}}).data.host_type="IPv6",a()},function(){return(r=r||{data:{}}).data.host_type="IPv4",a()},"25",v("25",!1),/^[0-5]/,m([["0","5"]],!1,!1),"2",v("2",!1),/^[0-4]/,m([["0","4"]],!1,!1),"1",v("1",!1),/^[1-9]/,m([["1","9"]],!1,!1),function(e){return r=r||{data:{}},e=parseInt(e.join("")),r.data.port=e},"transport=",v("transport=",!0),"udp",v("udp",!0),"tcp",v("tcp",!0),"sctp",v("sctp",!0),"tls",v("tls",!0),function(e){(r=r||{data:{}}).data.uri_params||(r.data.uri_params={}),r.data.uri_params.transport=e.toLowerCase()},"user=",v("user=",!0),"phone",v("phone",!0),"ip",v("ip",!0),function(e){(r=r||{data:{}}).data.uri_params||(r.data.uri_params={}),r.data.uri_params.user=e.toLowerCase()},"method=",v("method=",!0),function(e){(r=r||{data:{}}).data.uri_params||(r.data.uri_params={}),r.data.uri_params.method=e},"ttl=",v("ttl=",!0),function(e){(r=r||{data:{}}).data.params||(r.data.params={}),r.data.params.ttl=e},"maddr=",v("maddr=",!0),function(e){(r=r||{data:{}}).data.uri_params||(r.data.uri_params={}),r.data.uri_params.maddr=e},"lr",v("lr",!0),function(){(r=r||{data:{}}).data.uri_params||(r.data.uri_params={}),r.data.uri_params.lr=void 0},function(e,t){(r=r||{data:{}}).data.uri_params||(r.data.uri_params={}),t=null===t?void 0:t[1],r.data.uri_params[e.toLowerCase()]=t},function(e,t){e=e.join("").toLowerCase(),t=t.join(""),(r=r||{data:{}}).data.uri_headers||(r.data.uri_headers={}),r.data.uri_headers[e]?r.data.uri_headers[e].push(t):r.data.uri_headers[e]=[t]},function(){"Refer_To"===(r=r||{data:{}}).startRule&&(r.data.uri=new _.URI(r.data.scheme,r.data.user,r.data.host,r.data.port,r.data.uri_params,r.data.uri_headers),delete r.data.scheme,delete r.data.user,delete r.data.host,delete r.data.host_type,delete r.data.port,delete r.data.uri_params)},"//",v("//",!1),function(){(r=r||{data:{}}).data.scheme=a()},v("SIP",!0),function(){(r=r||{data:{}}).data.sip_version=a()},"INVITE",v("INVITE",!1),"ACK",v("ACK",!1),"VXACH",v("VXACH",!1),"OPTIONS",v("OPTIONS",!1),"BYE",v("BYE",!1),"CANCEL",v("CANCEL",!1),"REGISTER",v("REGISTER",!1),"SUBSCRIBE",v("SUBSCRIBE",!1),"NOTIFY",v("NOTIFY",!1),"REFER",v("REFER",!1),"PUBLISH",v("PUBLISH",!1),function(){return(r=r||{data:{}}).data.method=a(),r.data.method},function(e){(r=r||{data:{}}).data.status_code=parseInt(e.join(""))},function(){(r=r||{data:{}}).data.reason_phrase=a()},function(){(r=r||{data:{}}).data=a()},function(){var e,t;for(t=(r=r||{data:{}}).data.multi_header.length,e=0;e<t;e++)if(null===r.data.multi_header[e].parsed){r.data=null;break}null!==r.data?r.data=r.data.multi_header:r.data=-1},function(){var t;(r=r||{data:{}}).data.multi_header||(r.data.multi_header=[]);try{t=new C.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),delete r.data.uri,delete r.data.displayName,delete r.data.params}catch(e){t=null}r.data.multi_header.push({position:h,offset:c().start.offset,parsed:t})},function(e){'"'===(e=a().trim())[0]&&(e=e.substring(1,e.length-1)),(r=r||{data:{}}).data.displayName=e},"q",v("q",!0),function(e){(r=r||{data:{}}).data.params||(r.data.params={}),r.data.params.q=e},"expires",v("expires",!0),function(e){(r=r||{data:{}}).data.params||(r.data.params={}),r.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",v("0",!1),function(){return parseFloat(a())},function(e,t){(r=r||{data:{}}).data.params||(r.data.params={}),t=null===t?void 0:t[1],r.data.params[e.toLowerCase()]=t},"render",v("render",!0),"session",v("session",!0),"icon",v("icon",!0),"alert",v("alert",!0),function(){"Content_Disposition"===(r=r||{data:{}}).startRule&&(r.data.type=a().toLowerCase())},"handling",v("handling",!0),"optional",v("optional",!0),"required",v("required",!0),function(e){(r=r||{data:{}}).data=parseInt(e.join(""))},function(){(r=r||{data:{}}).data=a()},"text",v("text",!0),"image",v("image",!0),"audio",v("audio",!0),"video",v("video",!0),"application",v("application",!0),"message",v("message",!0),"multipart",v("multipart",!0),"x-",v("x-",!0),function(e){(r=r||{data:{}}).data.value=parseInt(e.join(""))},function(e){(r=r||{data:{}}).data=e},function(e){(r=r||{data:{}}).data.event=e.toLowerCase()},function(){var e=(r=r||{data:{}}).data.tag;r.data=new C.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),e&&r.data.setParam("tag",e)},"tag",v("tag",!0),function(e){(r=r||{data:{}}).data.tag=e},function(e){(r=r||{data:{}}).data=parseInt(e.join(""))},function(e){(r=r||{data:{}}).data=e},function(){(r=r||{data:{}}).data=new C.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params)},"digest",v("Digest",!0),"realm",v("realm",!0),function(e){(r=r||{data:{}}).data.realm=e},"domain",v("domain",!0),"nonce",v("nonce",!0),function(e){(r=r||{data:{}}).data.nonce=e},"opaque",v("opaque",!0),function(e){(r=r||{data:{}}).data.opaque=e},"stale",v("stale",!0),"true",v("true",!0),function(){(r=r||{data:{}}).data.stale=!0},"false",v("false",!0),function(){(r=r||{data:{}}).data.stale=!1},"algorithm",v("algorithm",!0),"md5",v("MD5",!0),"md5-sess",v("MD5-sess",!0),function(e){(r=r||{data:{}}).data.algorithm=e.toUpperCase()},"qop",v("qop",!0),"auth-int",v("auth-int",!0),"auth",v("auth",!0),function(e){(r=r||{data:{}}).data.qop||(r.data.qop=[]),r.data.qop.push(e.toLowerCase())},function(e){(r=r||{data:{}}).data.value=parseInt(e.join(""))},function(){var e,t;for(t=(r=r||{data:{}}).data.multi_header.length,e=0;e<t;e++)if(null===r.data.multi_header[e].parsed){r.data=null;break}null!==r.data?r.data=r.data.multi_header:r.data=-1},function(){var t;(r=r||{data:{}}).data.multi_header||(r.data.multi_header=[]);try{t=new C.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),delete r.data.uri,delete r.data.displayName,delete r.data.params}catch(e){t=null}r.data.multi_header.push({position:h,offset:c().start.offset,parsed:t})},function(){(r=r||{data:{}}).data=new C.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params)},function(){(r=r||{data:{}}).data.replaces_from_tag&&r.data.replaces_to_tag||(r.data=-1)},function(){(r=r||{data:{}}).data={call_id:r.data}},"from-tag",v("from-tag",!0),function(e){(r=r||{data:{}}).data.replaces_from_tag=e},"to-tag",v("to-tag",!0),function(e){(r=r||{data:{}}).data.replaces_to_tag=e},"early-only",v("early-only",!0),function(){(r=r||{data:{}}).data.early_only=!0},function(e,t){return t},function(e,t){return[e].concat(t)},function(e){"Require"===(r=r||{data:{}}).startRule&&(r.data=e||[])},function(e){(r=r||{data:{}}).data.value=parseInt(e.join(""))},"active",v("active",!0),"pending",v("pending",!0),"terminated",v("terminated",!0),function(){(r=r||{data:{}}).data.state=a()},"reason",v("reason",!0),function(e){r=r||{data:{}},void 0!==e&&(r.data.reason=e)},function(e){r=r||{data:{}},void 0!==e&&(r.data.expires=e)},"retry_after",v("retry_after",!0),function(e){r=r||{data:{}},void 0!==e&&(r.data.retry_after=e)},"deactivated",v("deactivated",!0),"probation",v("probation",!0),"rejected",v("rejected",!0),"timeout",v("timeout",!0),"giveup",v("giveup",!0),"noresource",v("noresource",!0),"invariant",v("invariant",!0),function(e){"Supported"===(r=r||{data:{}}).startRule&&(r.data=e||[])},function(){var e=(r=r||{data:{}}).data.tag;r.data=new C.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),e&&r.data.setParam("tag",e)},"ttl",v("ttl",!0),function(e){(r=r||{data:{}}).data.ttl=e},"maddr",v("maddr",!0),function(e){(r=r||{data:{}}).data.maddr=e},"received",v("received",!0),function(e){(r=r||{data:{}}).data.received=e},"branch",v("branch",!0),function(e){(r=r||{data:{}}).data.branch=e},"rport",v("rport",!0),function(e){r=r||{data:{}},void 0!==e&&(r.data.rport=e.join(""))},function(e){(r=r||{data:{}}).data.protocol=e},v("UDP",!0),v("TCP",!0),v("TLS",!0),v("SCTP",!0),function(e){(r=r||{data:{}}).data.transport=e},function(){(r=r||{data:{}}).data.host=a()},function(e){(r=r||{data:{}}).data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===(r=r||{data:{}}).startRule&&(r.data.deltaSeconds=e)},"refresher",v("refresher",!1),"uas",v("uas",!1),"uac",v("uac",!1),function(e){"Session_Expires"===(r=r||{data:{}}).startRule&&(r.data.refresher=e)},function(e){"Min_SE"===(r=r||{data:{}}).startRule&&(r.data=e)},"stuns",v("stuns",!0),"stun",v("stun",!0),function(e){(r=r||{data:{}}).data.scheme=e},function(e){(r=r||{data:{}}).data.host=e},"?transport=",v("?transport=",!1),"turns",v("turns",!0),"turn",v("turn",!0),function(e){(r=r||{data:{}}).data.transport=e},function(){(r=r||{data:{}}).data=a()},"Referred-By",v("Referred-By",!1),"b",v("b",!1),"cid",v("cid",!1)],l=[b('2 ""6 7!'),b('4"""5!7#'),b('4$""5!7%'),b('4&""5!7\''),b(";'.# &;("),b('4(""5!7)'),b('4*""5!7+'),b('2,""6,7-'),b('2.""6.7/'),b('40""5!71'),b('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),b(";).# &;,"),b('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),b('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),b('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),b(';.." &"'),b("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),b('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),b('4\\""5!7].# &;3'),b('4^""5!7_'),b('4`""5!7a'),b(';!.) &4b""5!7c'),b('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),b('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),b('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),b('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),b("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),b("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),b("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),b("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),b("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),b('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),b('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),b("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),b("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),b("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),b("%;//0#;&/'$8\":~\" )(\"'#&'#"),b("%;&/0#;//'$8\":~\" )(\"'#&'#"),b("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),b('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),b("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),b("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),b(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),b('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),b("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),b("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),b('%3""5$7.) &3""5#7/\' 8!:!! )'),b('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),b("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),b('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),b('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),b('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b("%;U.) &;\\.# &;X/& 8!:! )"),b('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),b('$4""5!7/,#0)*4""5!7&&&#'),b('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),b('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),b('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),b('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),b("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),b("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),b('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),b('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),b('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),b(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),b('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),b('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),b('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),b('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),b('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),b('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),b('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),b('%$;j/&#0#*;j&&&#/"!&,)'),b('%$;j/&#0#*;j&&&#/"!&,)'),b(";k.) &;+.# &;-"),b('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),b('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),b('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),b("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),b("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),b('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),b(";.# &;r"),b("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),b(";M.# &;t"),b("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),b('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),b('%24""6475/,#;{/#$+")("\'#&\'#'),b("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),b(";*.) &;+.# &;-"),b(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),b('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),b('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),b("$;~0#*;~&"),b(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),b('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),b(";.# &;"),b('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),b('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),b("$;y0#*;y&"),b('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),b('2Õ""6Õ7Ö'),b('2×""6×7Ø'),b('2Ù""6Ù7Ú'),b('2Û""6Û7Ü'),b('2Ý""6Ý7Þ'),b('2ß""6ß7à'),b('2á""6á7â'),b('2ã""6ã7ä'),b('2å""6å7æ'),b('2ç""6ç7è'),b('2é""6é7ê'),b("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),b("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),b("%;/' 8!:ì!! )"),b("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),b("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),b("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),b("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),b("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),b("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),b("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),b(";.) &;.# &; "),b("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),b("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),b('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),b('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),b(";6.) &;T.# &;H"),b("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),b(";¥.# &; "),b('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),b("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),b("%;©/& 8!:č! )"),b("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),b(";«.# &;¬"),b('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),b('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),b(";6.# &;®"),b('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),b(";­.# &;6"),b("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),b(";6.# &;H"),b("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),b("%;/' 8!:ğ!! )"),b('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),b('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),b("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),b(";¹.# &; "),b("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),b("%;/' 8!:Ħ!! )"),b("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),b(";¾"),b("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),b("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),b("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),b(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),b("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),b("%;I/' 8!:Ĭ!! )"),b("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),b(";t.# &;w"),b("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),b("%;I/' 8!:ı!! )"),b("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),b('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),b('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),b('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),b('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),b("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),b("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),b("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),b('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),b("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),b("%;/& 8!:Ő! )"),b('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),b('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),b("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),b("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),b("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),b('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),b(';1." &"'),b('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),b("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),b(";¹.# &; "),b("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),b("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),b(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),b("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),b("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),b("%3Ƃ\"\"5(7ƃ/F#;</=$;\\.) &;Y.# &;X/($8#:Ƅ#! )(#'#(\"'#&'#"),b("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),b("%3ƈ\"\"5%7Ɖ/A#;</8$$;!0#*;!&/($8#:Ɗ#! )(#'#(\"'#&'#"),b("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),b('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),b('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),b('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),b('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),b('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),b(";¾"),b('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),b(";ô.# &; "),b('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),b('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),b("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),b("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),b("$;%0#*;%&"),b("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),b('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),b('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),b("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),b(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),b('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),b('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),b('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),b('%3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\' 8!:Ʃ!! )'),b("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),b("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),b("%;ă/,#;ă/#$+\")(\"'#&'#"),b("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),b("%;q/T#$;m0#*;m&/D$%; /,#;ø/#$+\")(\"'#&'#.\" &\"/#$+#)(#'#(\"'#&'#"),b('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),b(";.# &;L"),b("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),b("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")],h=0,g=0,n=[{line:1,column:1}],s=0,o=[],f=0;if(void 0!==r.startRule){if(!(r.startRule in t))throw new Error("Can't start parsing from rule \""+r.startRule+'".');i=t[r.startRule]}function a(){return u.substring(g,h)}function c(){return T(g,h)}function v(e,t){return{type:"literal",text:e,ignoreCase:t}}function m(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function S(e){var t,r=n[e];if(r)return r;for(t=e-1;!n[t];)t--;for(r={line:(r=n[t]).line,column:r.column};t<e;)10===u.charCodeAt(t)?(r.line++,r.column=1):r.column++,t++;return n[e]=r}function T(e,t){var r=S(e),i=S(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function y(e){h<s||(s<h&&(s=h,o=[]),o.push(e))}function E(e,t,r){return new R(R.buildMessage(e,t),e,t,r)}function b(e){return e.split("").map(function(e){return e.charCodeAt(0)-32})}if(r.data={},(e=function e(t){for(var r,i=l[t],n=0,s=[],o=i.length,a=[],c=[];;){for(;n<o;)switch(i[n]){case 0:c.push(p[i[n+1]]),n+=2;break;case 1:c.push(void 0),n++;break;case 2:c.push(null),n++;break;case 3:c.push(d),n++;break;case 4:c.push([]),n++;break;case 5:c.push(h),n++;break;case 6:c.pop(),n++;break;case 7:h=c.pop(),n++;break;case 8:c.length-=i[n+1],n+=2;break;case 9:c.splice(-2,1),n++;break;case 10:c[c.length-2].push(c.pop()),n++;break;case 11:c.push(c.splice(c.length-i[n+1],i[n+1])),n+=2;break;case 12:c.push(u.substring(c.pop(),h)),n++;break;case 13:a.push(o),s.push(n+3+i[n+1]+i[n+2]),c[c.length-1]?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 14:a.push(o),s.push(n+3+i[n+1]+i[n+2]),c[c.length-1]===d?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 15:a.push(o),s.push(n+3+i[n+1]+i[n+2]),c[c.length-1]!==d?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 16:c[c.length-1]!==d?(a.push(o),s.push(n),o=n+2+i[n+1],n+=2):n+=2+i[n+1];break;case 17:a.push(o),s.push(n+3+i[n+1]+i[n+2]),u.length>h?(o=n+3+i[n+1],n+=3):(o=n+3+i[n+1]+i[n+2],n+=3+i[n+1]);break;case 18:a.push(o),s.push(n+4+i[n+2]+i[n+3]),u.substr(h,p[i[n+1]].length)===p[i[n+1]]?(o=n+4+i[n+2],n+=4):(o=n+4+i[n+2]+i[n+3],n+=4+i[n+2]);break;case 19:a.push(o),s.push(n+4+i[n+2]+i[n+3]),u.substr(h,p[i[n+1]].length).toLowerCase()===p[i[n+1]]?(o=n+4+i[n+2],n+=4):(o=n+4+i[n+2]+i[n+3],n+=4+i[n+2]);break;case 20:a.push(o),s.push(n+4+i[n+2]+i[n+3]),p[i[n+1]].test(u.charAt(h))?(o=n+4+i[n+2],n+=4):(o=n+4+i[n+2]+i[n+3],n+=4+i[n+2]);break;case 21:c.push(u.substr(h,i[n+1])),h+=i[n+1],n+=2;break;case 22:c.push(p[i[n+1]]),h+=p[i[n+1]].length,n+=2;break;case 23:c.push(d),0===f&&y(p[i[n+1]]),n+=2;break;case 24:g=c[c.length-1-i[n+1]],n+=2;break;case 25:g=h,n++;break;case 26:r=i.slice(n+4,n+4+i[n+3]).map(function(e){return c[c.length-1-e]}),c.splice(c.length-i[n+2],i[n+2],p[i[n+1]].apply(null,r)),n+=4+i[n+3];break;case 27:c.push(e(i[n+1])),n+=2;break;case 28:f++,n++;break;case 29:f--,n++;break;default:throw new Error("Invalid opcode: "+i[n]+".")}if(!(0<a.length))break;o=a.pop(),n=s.pop()}return c[0]}(i))!==d&&h===u.length)return e;throw e!==d&&h<u.length&&y({type:"end"}),E(o,s<u.length?u.charAt(s):null,s<u.length?T(s,s+1):T(s,s))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(14),o=(n=s.Parameters,i.__extends(a,n),Object.defineProperty(a.prototype,"friendlyName",{get:function(){return this.displayName||this.uri.aor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"displayName",{get:function(){return this._displayName},set:function(e){this._displayName=e},enumerable:!0,configurable:!0}),a.prototype.clone=function(){return new a(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))},a.prototype.toString=function(){var e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";for(var t in e+="<"+this.uri.toString()+">",this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e},a);function a(e,t,r){var i=n.call(this,r)||this;return i.uri=e,i._displayName=t,i}t.NameAddrHeader=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.setParam=function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},n.prototype.getParam=function(e){if(e)return this.parameters[e.toLowerCase()]},n.prototype.hasParam=function(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())},n.prototype.deleteParam=function(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){var t=this.parameters[e];return delete this.parameters[e],t}},n.prototype.clearParams=function(){this.parameters={}},n);function n(e){for(var t in this.parameters={},e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}t.Parameters=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,i=r(1),n=r(14),s=(c=n.Parameters,i.__extends(o,c),Object.defineProperty(o.prototype,"scheme",{get:function(){return this.normal.scheme},set:function(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"user",{get:function(){return this.normal.user},set:function(e){this.normal.user=this.raw.user=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"host",{get:function(){return this.normal.host},set:function(e){this.raw.host=e,this.normal.host=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"aor",{get:function(){return this.normal.user+"@"+this.normal.host},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"port",{get:function(){return this.normal.port},set:function(e){this.normal.port=this.raw.port=e},enumerable:!0,configurable:!0}),o.prototype.setHeader=function(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]},o.prototype.getHeader=function(e){if(e)return this.headers[this.headerize(e)]},o.prototype.hasHeader=function(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))},o.prototype.deleteHeader=function(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){var t=this.headers[e];return delete this.headers[e],t}},o.prototype.clearHeaders=function(){this.headers={}},o.prototype.clone=function(){return new o(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},o.prototype.toRaw=function(){return this._toString(this._raw)},o.prototype.toString=function(){return this._toString(this._normal)},Object.defineProperty(o.prototype,"_normal",{get:function(){return this.normal},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_raw",{get:function(){return this.raw},enumerable:!0,configurable:!0}),o.prototype._toString=function(e){var t=e.scheme+":";for(var r in e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,!e.port&&0!==e.port||(t+=":"+e.port),this.parameters)this.parameters.hasOwnProperty(r)&&(t+=";"+r,null!==this.parameters[r]&&(t+="="+this.parameters[r]));var i=[];for(var n in this.headers)if(this.headers.hasOwnProperty(n))for(var s in this.headers[n])this.headers[n].hasOwnProperty(s)&&i.push(n+"="+this.headers[n][s]);return 0<i.length&&(t+="?"+i.join("&")),t},o.prototype.escapeUser=function(e){var t;try{t=decodeURIComponent(e)}catch(e){throw e}return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},o.prototype.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i=r.length,n="",s=0;s<i;s++)0!==s&&(n+="-"),n+=r[s].charAt(0).toUpperCase()+r[s].substring(1);return t[n]&&(n=t[n]),n},o);function o(e,t,r,i,n,s){var o=c.call(this,n)||this;if(o.headers={},!r)throw new TypeError('missing or invalid "host" parameter');for(var a in e=e||"sip",s)s.hasOwnProperty(a)&&o.setHeader(a,s[a]);return o.raw={scheme:e,user:t,host:r,port:i},o.normal={scheme:e.toLowerCase(),user:t,host:r.toLowerCase(),port:i},o}t.URI=s},function(e,t,r){"use strict";function i(e,t){void 0===t&&(t=32);for(var r="",i=0;i<e;i++){r+=Math.floor(Math.random()*t).toString(t)}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.createRandomToken=i,t.getReasonPhrase=function(e){return n[e]||""},t.newTag=function(){return i(10)},t.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i=r.length,n="",s=0;s<i;s++)0!==s&&(n+="-"),n+=r[s].charAt(0).toUpperCase()+r[s].substring(1);return t[n]&&(n=t[n]),n},t.str_utf8_length=function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length};var n={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(10),o=(i=s.IncomingMessage,n.__extends(a,i),a);function a(){return i.call(this)||this}t.IncomingResponseMessage=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),n=r(13),d=r(16),i=(c.getDefaultOptions=function(){return{callId:"",callIdPrefix:"",cseq:1,toDisplayName:"",toTag:"",fromDisplayName:"",fromTag:"",forceRport:!1,hackViaTcp:!1,optionTags:["outbound"],routeSet:[],userAgentString:"sip.js",viaHost:""}},c.makeNameAddrHeader=function(e,t,r){var i={};return r&&(i.tag=r),new n.NameAddrHeader(e,t,i)},c.prototype.getHeader=function(e){var t=this.headers[d.headerize(e)];if(t){if(t[0])return t[0]}else for(var r=new RegExp("^\\s*"+e+"\\s*:","i"),i=0,n=this.extraHeaders;i<n.length;i++){var s=n[i];if(r.test(s))return s.substring(s.indexOf(":")+1).trim()}},c.prototype.getHeaders=function(e){var t=[],r=this.headers[d.headerize(e)];if(r)for(var i=0,n=r;i<n.length;i++){var s=n[i];t.push(s)}else for(var o=new RegExp("^\\s*"+e+"\\s*:","i"),a=0,c=this.extraHeaders;a<c.length;a++){var u=c[a];o.test(u)&&t.push(u.substring(u.indexOf(":")+1).trim())}return t},c.prototype.hasHeader=function(e){if(this.headers[d.headerize(e)])return!0;for(var t=new RegExp("^\\s*"+e+"\\s*:","i"),r=0,i=this.extraHeaders;r<i.length;r++){var n=i[r];if(t.test(n))return!0}return!1},c.prototype.setHeader=function(e,t){this.headers[d.headerize(e)]=t instanceof Array?t:[t]},c.prototype.setViaHeader=function(e,t){this.options.hackViaTcp&&(t="TCP");var r="SIP/2.0/"+t;r+=" "+this.options.viaHost+";branch="+e,this.options.forceRport&&(r+=";rport"),this.setHeader("via",r),this.branch=e},c.prototype.toString=function(){var e="";for(var t in e+=this.method+" "+this.ruri.toRaw()+" SIP/2.0\r\n",this.headers)if(this.headers[t])for(var r=0,i=this.headers[t];r<i.length;r++)e+=t+": "+i[r]+"\r\n";for(var n=0,s=this.extraHeaders;n<s.length;n++)e+=(t=s[n]).trim()+"\r\n";return e+="Supported: "+this.options.optionTags.join(", ")+"\r\n",e+="User-Agent: "+this.options.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+d.str_utf8_length(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+d.str_utf8_length(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e},c);function c(e,t,r,i,n,s,o){this.headers={},this.extraHeaders=[],this.options=c.getDefaultOptions(),n&&(this.options=a.__assign(a.__assign({},this.options),n),this.options.optionTags&&this.options.optionTags.length&&(this.options.optionTags=this.options.optionTags.slice()),this.options.routeSet&&this.options.routeSet.length&&(this.options.routeSet=this.options.routeSet.slice())),s&&s.length&&(this.extraHeaders=s.slice()),o&&(this.body={body:o.content,contentType:o.contentType}),this.method=e,this.ruri=t.clone(),this.fromURI=r.clone(),this.fromTag=this.options.fromTag?this.options.fromTag:d.newTag(),this.from=c.makeNameAddrHeader(this.fromURI,this.options.fromDisplayName,this.fromTag),this.toURI=i.clone(),this.toTag=this.options.toTag,this.to=c.makeNameAddrHeader(this.toURI,this.options.toDisplayName,this.toTag),this.callId=this.options.callId?this.options.callId:this.options.callIdPrefix+d.createRandomToken(15),this.cseq=this.options.cseq,this.setHeader("route",this.options.routeSet),this.setHeader("via",""),this.setHeader("to",this.to.toString()),this.setHeader("from",this.from.toString()),this.setHeader("cseq",this.cseq+" "+this.method),this.setHeader("call-id",this.callId),this.setHeader("max-forwards","70")}t.OutgoingRequestMessage=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1).__importDefault(r(20)),n=r(16),s=(o.prototype.authenticate=function(e,t,r){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(-1<t.qop.indexOf("auth"))this.qop="auth";else{if(!(-1<t.qop.indexOf("auth-int")))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=n.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(r),!0},o.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},o.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},o.prototype.calculateResponse=function(e){var t,r=i.default(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(t=i.default(this.method+":"+this.uri),this.response=i.default(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=i.default(this.method+":"+this.uri+":"+i.default(e||"")),this.response=i.default(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):void 0===this.qop&&(t=i.default(this.method+":"+this.uri),this.response=i.default(r+":"+this.nonce+":"+t))},o);function o(e,t,r){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=t,this.password=r,this.nc=0,this.ncHex="00000000"}t.DigestAuthentication=s},function(e,t,r){var o;e.exports=(o=r(21),function(d){var e=o,t=e.lib,r=t.WordArray,i=t.Hasher,n=e.algo,w=[];!function(){for(var e=0;e<64;e++)w[e]=4294967296*d.abs(d.sin(e+1))|0}();var s=n.MD5=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var i=t+r,n=e[i];e[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s=this._hash.words,o=e[t+0],a=e[t+1],c=e[t+2],u=e[t+3],d=e[t+4],p=e[t+5],l=e[t+6],h=e[t+7],g=e[t+8],f=e[t+9],v=e[t+10],m=e[t+11],S=e[t+12],T=e[t+13],y=e[t+14],E=e[t+15],b=s[0],C=s[1],_=s[2],R=s[3];b=A(b,C,_,R,o,7,w[0]),R=A(R,b,C,_,a,12,w[1]),_=A(_,R,b,C,c,17,w[2]),C=A(C,_,R,b,u,22,w[3]),b=A(b,C,_,R,d,7,w[4]),R=A(R,b,C,_,p,12,w[5]),_=A(_,R,b,C,l,17,w[6]),C=A(C,_,R,b,h,22,w[7]),b=A(b,C,_,R,g,7,w[8]),R=A(R,b,C,_,f,12,w[9]),_=A(_,R,b,C,v,17,w[10]),C=A(C,_,R,b,m,22,w[11]),b=A(b,C,_,R,S,7,w[12]),R=A(R,b,C,_,T,12,w[13]),_=A(_,R,b,C,y,17,w[14]),b=I(b,C=A(C,_,R,b,E,22,w[15]),_,R,a,5,w[16]),R=I(R,b,C,_,l,9,w[17]),_=I(_,R,b,C,m,14,w[18]),C=I(C,_,R,b,o,20,w[19]),b=I(b,C,_,R,p,5,w[20]),R=I(R,b,C,_,v,9,w[21]),_=I(_,R,b,C,E,14,w[22]),C=I(C,_,R,b,d,20,w[23]),b=I(b,C,_,R,f,5,w[24]),R=I(R,b,C,_,y,9,w[25]),_=I(_,R,b,C,u,14,w[26]),C=I(C,_,R,b,g,20,w[27]),b=I(b,C,_,R,T,5,w[28]),R=I(R,b,C,_,c,9,w[29]),_=I(_,R,b,C,h,14,w[30]),b=O(b,C=I(C,_,R,b,S,20,w[31]),_,R,p,4,w[32]),R=O(R,b,C,_,g,11,w[33]),_=O(_,R,b,C,m,16,w[34]),C=O(C,_,R,b,y,23,w[35]),b=O(b,C,_,R,a,4,w[36]),R=O(R,b,C,_,d,11,w[37]),_=O(_,R,b,C,h,16,w[38]),C=O(C,_,R,b,v,23,w[39]),b=O(b,C,_,R,T,4,w[40]),R=O(R,b,C,_,o,11,w[41]),_=O(_,R,b,C,u,16,w[42]),C=O(C,_,R,b,l,23,w[43]),b=O(b,C,_,R,f,4,w[44]),R=O(R,b,C,_,S,11,w[45]),_=O(_,R,b,C,E,16,w[46]),b=x(b,C=O(C,_,R,b,c,23,w[47]),_,R,o,6,w[48]),R=x(R,b,C,_,h,10,w[49]),_=x(_,R,b,C,y,15,w[50]),C=x(C,_,R,b,p,21,w[51]),b=x(b,C,_,R,S,6,w[52]),R=x(R,b,C,_,u,10,w[53]),_=x(_,R,b,C,v,15,w[54]),C=x(C,_,R,b,a,21,w[55]),b=x(b,C,_,R,g,6,w[56]),R=x(R,b,C,_,E,10,w[57]),_=x(_,R,b,C,l,15,w[58]),C=x(C,_,R,b,T,21,w[59]),b=x(b,C,_,R,d,6,w[60]),R=x(R,b,C,_,m,10,w[61]),_=x(_,R,b,C,c,15,w[62]),C=x(C,_,R,b,f,21,w[63]),s[0]=s[0]+b|0,s[1]=s[1]+C|0,s[2]=s[2]+_|0,s[3]=s[3]+R|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32;var n=d.floor(r/4294967296),s=r;t[15+(64+i>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t[14+(64+i>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,a=o.words,c=0;c<4;c++){var u=a[c];a[c]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return o},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function A(e,t,r,i,n,s,o){var a=e+(t&r|~t&i)+n+o;return(a<<s|a>>>32-s)+t}function I(e,t,r,i,n,s,o){var a=e+(t&i|r&~i)+n+o;return(a<<s|a>>>32-s)+t}function O(e,t,r,i,n,s,o){var a=e+(t^r^i)+n+o;return(a<<s|a>>>32-s)+t}function x(e,t,r,i,n,s,o){var a=e+(r^(t|~i))+n+o;return(a<<s|a>>>32-s)+t}e.MD5=i._createHelper(s),e.HmacMD5=i._createHmacHelper(s)}(Math),o.MD5)},function(e,t,r){var i;e.exports=(i=i||function(d){var r=Object.create||function(e){var t;return i.prototype=e,t=new i,i.prototype=null,t};function i(){}var e={},t=e.lib={},n=t.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},p=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<n;s++){var o=r[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}else for(s=0;s<n;s+=4)t[i+s>>>2]=r[s>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=d.ceil(t/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){function t(t){t=t;var r=987654321,i=4294967295;return function(){var e=((r=36969*(65535&r)+(r>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return e/=4294967296,(e+=.5)*(.5<d.random()?1:-1)}}for(var r,i=[],n=0;n<e;n+=4){var s=t(4294967296*(r||d.random()));r=987654071*s(),i.push(4294967296*s()|0)}return new p.init(i,e)}}),s=e.enc={},o=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new p.init(r,t/2)}},a=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new p.init(r,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,i=t.sigBytes,n=this.blockSize,s=i/(4*n),o=(s=e?d.ceil(s):d.max((0|s)-this._minBufferSize,0))*n,a=d.min(4*o,i);if(o){for(var c=0;c<o;c+=n)this._doProcessBlock(r,c);var u=r.splice(0,o);t.sigBytes-=a}return new p.init(u,a)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),l=(t.Hasher=u.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new l.HMAC.init(r,t).finalize(e)}}}),e.algo={});return e}(Math),i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=r(16);t.constructOutgoingResponse=function(e,t){var r="\r\n";if(t.statusCode<100||699<t.statusCode)throw new TypeError("Invalid statusCode: "+t.statusCode);var i=t.reasonPhrase?t.reasonPhrase:g.getReasonPhrase(t.statusCode),n="SIP/2.0 "+t.statusCode+" "+i+r;100<=t.statusCode&&t.statusCode,t.statusCode;var s="From: "+e.getHeader("From")+r,o="Call-ID: "+e.callId+r,a="CSeq: "+e.cseq+" "+e.method+r,c=e.getHeaders("via").reduce(function(e,t){return e+"Via: "+t+r},""),u="To: "+e.getHeader("to");if(100<t.statusCode&&!e.parseHeader("to").hasParam("tag")){var d=t.toTag;u+=";tag="+(d=d||g.newTag())}u+=r;var p="";t.supported&&(p="Supported: "+t.supported.join(", ")+r);var l="";t.userAgent&&(l="User-Agent: "+t.userAgent+r);var h="";return t.extraHeaders&&(h=t.extraHeaders.reduce(function(e,t){return e+t.trim()+r},"")),n+=c,n+=s,n+=u,n+=a,n+=o,n+=p,n+=l,n+=h,t.body?(n+="Content-Type: "+t.body.contentType+r,n+="Content-Length: "+g.str_utf8_length(t.body.content)+r+r,n+=t.body.content):n+="Content-Length: 0"+r+r,{message:n}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,c=r(11),u=r(9),d=r(17);function p(e,t){var r=t,i=0,n=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===i;){if(-1===(n=e.indexOf("\r\n",r)))return n;!e.substring(n+2,n+4).match(/(^\r\n)/)&&e.charAt(n+2).match(/(^\s+)/)?r=n+2:i=n}return i}function l(t,e,r,i){var n,s=e.indexOf(":",r),o=e.substring(r,s).trim(),a=e.substring(s+1,i).trim();switch(o.toLowerCase()){case"via":case"v":t.addHeader("via",a),1===t.getHeaders("via").length?(n=t.parseHeader("Via"))&&(t.via=n,t.viaBranch=n.branch):n=0;break;case"from":case"f":t.setHeader("from",a),(n=t.parseHeader("from"))&&(t.from=n,t.fromTag=n.getParam("tag"));break;case"to":case"t":t.setHeader("to",a),(n=t.parseHeader("to"))&&(t.to=n,t.toTag=n.getParam("tag"));break;case"record-route":if(-1===(n=c.Grammar.parse(a,"Record_Route"))){n=void 0;break}if(!(n instanceof Array)){n=void 0;break}n.forEach(function(e){t.addHeader("record-route",a.substring(e.position,e.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=e.parsed});break;case"call-id":case"i":t.setHeader("call-id",a),(n=t.parseHeader("call-id"))&&(t.callId=a);break;case"contact":case"m":if(-1===(n=c.Grammar.parse(a,"Contact"))){n=void 0;break}if(!(n instanceof Array)){n=void 0;break}n.forEach(function(e){t.addHeader("contact",a.substring(e.position,e.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=e.parsed});break;case"content-length":case"l":t.setHeader("content-length",a),n=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",a),n=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",a),(n=t.parseHeader("cseq"))&&(t.cseq=n.value),t instanceof d.IncomingResponseMessage&&(t.method=n.method);break;case"max-forwards":t.setHeader("max-forwards",a),n=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",a),n=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",a),n=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",a),(n=t.parseHeader("refer-to"))&&(t.referTo=n);break;default:t.addHeader(o.toLowerCase(),a),n=0}return void 0!==n||{error:"error parsing header '"+o+"'"}}(i=t.Parser||(t.Parser={})).getHeader=p,i.parseHeader=l,i.parseMessage=function(e,t){var r=0,i=e.indexOf("\r\n");if(-1!==i){var n,s=e.substring(0,i),o=c.Grammar.parse(s,"Request_Response");if(-1!==o){var a;for(o.status_code?((n=new d.IncomingResponseMessage).statusCode=o.status_code,n.reasonPhrase=o.reason_phrase):((n=new u.IncomingRequestMessage).method=o.method,n.ruri=o.uri),n.data=e,r=i+2;;){if(-2===(i=p(e,r))){a=r+2;break}if(-1===i)return void t.error("malformed message");if(!0!==l(n,e,r,i))return void t.error(o.error);r=i+2}return n.hasHeader("content-length")?n.body=e.substr(a,Number(n.getHeader("content-length"))):n.body=e.substring(a),n}t.warn('error parsing first line of SIP message: "'+s+'"')}else t.warn("no CRLF found, not a SIP message, discarded")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),n=r(5),o=r(25),a=r(27),c=r(28),u=r(42),d=r(44),p=r(46),l=r(47),h=r(48),g=r(49),f=r(50),v=r(51),m=r(52),S=r(53),T=r(54),y=r(55),E=r(4),b=(s=E.Dialog,i.__extends(C,s),C.prototype.dispose=function(){s.prototype.dispose.call(this),this._signalingState=o.SignalingState.Closed,this._offer=void 0,this._answer=void 0,this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.logger.log("INVITE dialog "+this.id+" destroyed")},Object.defineProperty(C.prototype,"sessionState",{get:function(){return this.early?o.SessionState.Early:this.ackWait?o.SessionState.AckWait:this._signalingState===o.SignalingState.Closed?o.SessionState.Terminated:o.SessionState.Confirmed},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"signalingState",{get:function(){return this._signalingState},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"offer",{get:function(){return this._offer},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"answer",{get:function(){return this._answer},enumerable:!0,configurable:!0}),C.prototype.confirm=function(){this.early&&this.start2xxRetransmissionTimer(),s.prototype.confirm.call(this)},C.prototype.reConfirm=function(){this.reinviteUserAgentServer&&this.startReInvite2xxRetransmissionTimer()},C.prototype.ack=function(e){var t;if(void 0===e&&(e={}),this.logger.log("INVITE dialog "+this.id+" sending ACK request"),this.reinviteUserAgentClient){if(!(this.reinviteUserAgentClient.transaction instanceof c.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");t=this.reinviteUserAgentClient.transaction,this.reinviteUserAgentClient=void 0}else{if(!(this.initialTransaction instanceof c.InviteClientTransaction))throw new Error("Initial transaction not instance of InviteClientTransaction.");t=this.initialTransaction}e.cseq=t.request.cseq;var r=this.createOutgoingRequestMessage(n.C.ACK,e);return t.ackResponse(r),this.signalingStateTransition(r),{message:r}},C.prototype.bye=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending BYE request"),this.initialTransaction instanceof c.InviteServerTransaction){if(this.early)throw new Error("UAS MUST NOT send a BYE on early dialogs.");if(this.ackWait&&this.initialTransaction.state!==c.TransactionState.Terminated)throw new Error("UAS MUST NOT send a BYE on a confirmed dialog until it has received an ACK for its 2xx response or until the server transaction times out.")}return new u.ByeUserAgentClient(this,e,t)},C.prototype.info=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending INFO request"),this.early)throw new Error("Dialog not confirmed.");return new p.InfoUserAgentClient(this,e,t)},C.prototype.invite=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending INVITE request"),this.early)throw new Error("Dialog not confirmed.");if(this.reinviteUserAgentClient)throw new Error("There is an ongoing re-INVITE client transaction.");if(this.reinviteUserAgentServer)throw new Error("There is an ongoing re-INVITE server transaction.");return new m.ReInviteUserAgentClient(this,e,t)},C.prototype.notify=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending NOTIFY request"),this.early)throw new Error("Dialog not confirmed.");return new h.NotifyUserAgentClient(this,e,t)},C.prototype.prack=function(e,t){return this.logger.log("INVITE dialog "+this.id+" sending PRACK request"),new f.PrackUserAgentClient(this,e,t)},C.prototype.refer=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending REFER request"),this.early)throw new Error("Dialog not confirmed.");return new T.ReferUserAgentClient(this,e,t)},C.prototype.receiveRequest=function(e){if(this.logger.log("INVITE dialog "+this.id+" received "+e.method+" request"),e.method===n.C.ACK){if(this.ackWait){if(this.initialTransaction instanceof c.InviteClientTransaction)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+e.method+" request, dropping.");if(this.initialTransaction.request.cseq!==e.cseq)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+e.method+" request, dropping.");this.ackWait=!1}else{if(!this.reinviteUserAgentServer)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+e.method+" request, dropping.");if(this.reinviteUserAgentServer.transaction.request.cseq!==e.cseq)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+e.method+" request, dropping.");this.reinviteUserAgentServer=void 0}return this.signalingStateTransition(e),void(this.delegate&&this.delegate.onAck&&this.delegate.onAck({message:e}))}if(this.sequenceGuard(e)){if(e.method===n.C.INVITE){if(this.reinviteUserAgentServer){var t=["Retry-After: "+(Math.floor(10*Math.random())+1)];return void this.core.replyStateless(e,{statusCode:500,extraHeaders:t})}if(this.reinviteUserAgentClient)return void this.core.replyStateless(e,{statusCode:491})}if(s.prototype.receiveRequest.call(this,e),e.method===n.C.INVITE){var r=e.parseHeader("contact");if(!r)throw new Error("Contact undefined.");if(!(r instanceof n.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");this.dialogState.remoteTarget=r.uri}switch(e.method){case n.C.BYE:var i=new d.ByeUserAgentServer(this,e);this.delegate&&this.delegate.onBye?this.delegate.onBye(i):i.accept(),this.dispose();break;case n.C.INFO:i=new l.InfoUserAgentServer(this,e),this.delegate&&this.delegate.onInfo?this.delegate.onInfo(i):i.reject({statusCode:469,extraHeaders:["Recv-Info :"]});break;case n.C.INVITE:i=new S.ReInviteUserAgentServer(this,e),this.signalingStateTransition(e),this.delegate&&this.delegate.onInvite?this.delegate.onInvite(i):i.reject({statusCode:488});break;case n.C.NOTIFY:i=new g.NotifyUserAgentServer(this,e),this.delegate&&this.delegate.onNotify?this.delegate.onNotify(i):i.accept();break;case n.C.PRACK:i=new v.PrackUserAgentServer(this,e),this.delegate&&this.delegate.onPrack?this.delegate.onPrack(i):i.accept();break;case n.C.REFER:i=new y.ReferUserAgentServer(this,e),this.delegate&&this.delegate.onRefer?this.delegate.onRefer(i):i.reject();break;default:this.logger.log("INVITE dialog "+this.id+" received unimplemented "+e.method+" request"),this.core.replyStateless(e,{statusCode:501})}}else this.logger.log("INVITE dialog "+this.id+" rejected out of order "+e.method+" request.")},C.prototype.reliableSequenceGuard=function(e){var t=e.statusCode;if(!t)throw new Error("Status code undefined");if(100<t&&t<200){var r=e.getHeader("require"),i=e.getHeader("rseq"),n=r&&r.includes("100rel")&&i?Number(i):void 0;if(n){if(this.rseq&&this.rseq+1!==n)return!1;this.rseq||(this.rseq=n)}}return!0},C.prototype.signalingStateRollback=function(){this._signalingState!==o.SignalingState.HaveLocalOffer&&this.signalingState!==o.SignalingState.HaveRemoteOffer||this._rollbackOffer&&this._rollbackAnswer&&(this._signalingState=o.SignalingState.Stable,this._offer=this._rollbackOffer,this._answer=this._rollbackAnswer)},C.prototype.signalingStateTransition=function(e){var t=n.getBody(e);if(t&&"session"===t.contentDisposition){if(this._signalingState===o.SignalingState.Stable&&(this._rollbackOffer=this._offer,this._rollbackAnswer=this._answer),e instanceof n.IncomingRequestMessage)switch(this._signalingState){case o.SignalingState.Initial:case o.SignalingState.Stable:this._signalingState=o.SignalingState.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case o.SignalingState.HaveLocalOffer:this._signalingState=o.SignalingState.Stable,this._answer=t;break;case o.SignalingState.HaveRemoteOffer:case o.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof n.IncomingResponseMessage)switch(this._signalingState){case o.SignalingState.Initial:case o.SignalingState.Stable:this._signalingState=o.SignalingState.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case o.SignalingState.HaveLocalOffer:this._signalingState=o.SignalingState.Stable,this._answer=t;break;case o.SignalingState.HaveRemoteOffer:case o.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof n.OutgoingRequestMessage)switch(this._signalingState){case o.SignalingState.Initial:case o.SignalingState.Stable:this._signalingState=o.SignalingState.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case o.SignalingState.HaveLocalOffer:break;case o.SignalingState.HaveRemoteOffer:this._signalingState=o.SignalingState.Stable,this._answer=t;break;case o.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(n.isBody(e))switch(this._signalingState){case o.SignalingState.Initial:case o.SignalingState.Stable:this._signalingState=o.SignalingState.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case o.SignalingState.HaveLocalOffer:break;case o.SignalingState.HaveRemoteOffer:this._signalingState=o.SignalingState.Stable,this._answer=t;break;case o.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}}},C.prototype.start2xxRetransmissionTimer=function(){var e=this;if(this.initialTransaction instanceof c.InviteServerTransaction){var t=this.initialTransaction,r=a.Timers.T1,i=function(){e.ackWait?(e.logger.log("No ACK for 2xx response received, attempting retransmission"),t.retransmitAcceptedResponse(),r=Math.min(2*r,a.Timers.T2),e.invite2xxTimer=setTimeout(i,r)):e.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(i,r);var n=function(){t.state===c.TransactionState.Terminated&&(t.removeListener("stateChanged",n),e.invite2xxTimer&&(clearTimeout(e.invite2xxTimer),e.invite2xxTimer=void 0),e.ackWait&&(e.delegate&&e.delegate.onAckTimeout?e.delegate.onAckTimeout():e.bye()))};t.addListener("stateChanged",n)}},C.prototype.startReInvite2xxRetransmissionTimer=function(){var e=this;if(this.reinviteUserAgentServer&&this.reinviteUserAgentServer.transaction instanceof c.InviteServerTransaction){var t=this.reinviteUserAgentServer.transaction,r=a.Timers.T1,i=function(){e.reinviteUserAgentServer?(e.logger.log("No ACK for 2xx response received, attempting retransmission"),t.retransmitAcceptedResponse(),r=Math.min(2*r,a.Timers.T2),e.invite2xxTimer=setTimeout(i,r)):e.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(i,r);var n=function(){t.state===c.TransactionState.Terminated&&(t.removeListener("stateChanged",n),e.invite2xxTimer&&(clearTimeout(e.invite2xxTimer),e.invite2xxTimer=void 0),e.reinviteUserAgentServer)};t.addListener("stateChanged",n)}},C);function C(e,t,r,i){var n=s.call(this,t,r)||this;return n.initialTransaction=e,n._signalingState=o.SignalingState.Initial,n.ackWait=!1,n.delegate=i,e instanceof c.InviteServerTransaction&&(n.ackWait=!0),n.early||n.start2xxRetransmissionTimer(),n.signalingStateTransition(e.request),n.logger=t.loggerFactory.getLogger("sip.invite-dialog"),n.logger.log("INVITE dialog "+n.id+" constructed"),n}t.SessionDialog=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(1).__exportStar(r(26),t)},function(e,t,r){"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.SessionState||(t.SessionState={})).Initial="Initial",i.Early="Early",i.AckWait="AckWait",i.Confirmed="Confirmed",i.Terminated="Terminated",(n=t.SignalingState||(t.SignalingState={})).Initial="Initial",n.HaveLocalOffer="HaveLocalOffer",n.HaveRemoteOffer="HaveRemoteOffer",n.Stable="Stable",n.Closed="Closed"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=500;t.Timers={T1:i,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(29),t),i.__exportStar(r(36),t),i.__exportStar(r(38),t),i.__exportStar(r(40),t),i.__exportStar(r(41),t),i.__exportStar(r(36),t),i.__exportStar(r(39),t),i.__exportStar(r(37),t),i.__exportStar(r(30),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(1),n=r(30),s=(o=n.Transaction,i.__extends(a,o),a.makeId=function(e){if("CANCEL"!==e.method)return"z9hG4bK"+Math.floor(1e7*Math.random());if(!e.branch)throw new Error("Outgoing CANCEL request without a branch.");return e.branch},Object.defineProperty(a.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),a.prototype.onRequestTimeout=function(){this.user.onRequestTimeout&&this.user.onRequestTimeout()},a);function a(e,t,r,i,n){var s=o.call(this,t,r,a.makeId(e),i,n)||this;return s._request=e,s.user=r,e.setViaHeader(s.id,t.protocol),s}t.ClientTransaction=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(1),n=r(31),s=r(32),a=(o=n.EventEmitter,i.__extends(c,o),c.prototype.dispose=function(){this.logger.debug("Destroyed "+this.typeToString()+" with id "+this.id+".")},Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"kind",{get:function(){throw new Error("Invalid kind.")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"transport",{get:function(){return this._transport},enumerable:!0,configurable:!0}),c.prototype.on=function(e,t){return o.prototype.on.call(this,e,t)},c.prototype.logTransportError=function(e,t){this.logger.error(e.message),this.logger.error("Transport error occurred in "+this.typeToString()+" with id "+this.id+"."),this.logger.error(t)},c.prototype.send=function(e){var r=this;return this.transport.send(e).catch(function(e){if(e instanceof s.TransportError)throw r.onTransportError(e),e;var t;throw t=e&&"string"==typeof e.message?new s.TransportError(e.message):new s.TransportError,r.onTransportError(t),t})},c.prototype.setState=function(e){this.logger.debug('State change to "'+e+'" on '+this.typeToString()+" with id "+this.id+"."),this._state=e,this._user.onStateChange&&this._user.onStateChange(e),this.emit("stateChanged")},c.prototype.typeToString=function(){return"UnknownType"},c);function c(e,t,r,i,n){var s=o.call(this)||this;return s._transport=e,s._user=t,s._id=r,s._state=i,s.logger=t.loggerFactory.getLogger(n,r),s.logger.debug("Constructing "+s.typeToString()+" with id "+s.id+"."),s}t.Transaction=a},function(e,t,r){"use strict";var i,n="object"==typeof Reflect?Reflect:null,d=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};i=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}((e.exports=o).EventEmitter=o).prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,r,i){var n,s,o,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),0<(n=u(e))&&o.length>n&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function p(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,d(this.listener,this.target,e))}.bind(i);return n.listener=r,i.wrapFn=n}function l(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):g(n,n.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var s;if(0<t.length&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=n[e];if(void 0===a)return!1;if("function"==typeof a)d(a,this,t);else{var c=a.length,u=g(a,c);for(r=0;r<c;++r)d(u[r],this,t)}return!0},o.prototype.on=o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,p(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,p(this,e,t)),this},o.prototype.off=o.prototype.removeListener=function(e,t){var r,i,n,s,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;0<=s;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;0<=i;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return l(this,e,!0)},o.prototype.rawListeners=function(e){return l(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return 0<this._eventsCount?i(this._events):[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(33),t),i.__exportStar(r(34),t),i.__exportStar(r(35),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=(i=Error,n.__extends(o,i),o);function o(e){var t=this.constructor,r=i.call(this,e)||this;return Object.setPrototypeOf(r,t.prototype),r}t.Exception=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(33),o=(i=s.Exception,n.__extends(a,i),a);function a(e){return i.call(this,e||"Transaction state error.")||this}t.TransactionStateError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(33),o=(i=s.Exception,n.__extends(a,i),a);function a(e){return i.call(this,e||"Unspecified transport error.")||this}t.TransportError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(27),o=r(29),a=r(37),c=(n=o.ClientTransaction,i.__extends(u,n),u.prototype.dispose=function(){this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),n.prototype.dispose.call(this)},Object.defineProperty(u.prototype,"kind",{get:function(){return"ict"},enumerable:!0,configurable:!0}),u.prototype.ackResponse=function(e){var t=this,r=e.toTag;if(!r)throw new Error("To tag undefined.");var i="z9hG4bK"+Math.floor(1e7*Math.random());e.setViaHeader(i,this.transport.protocol),this.ackRetransmissionCache.set(r,e),this.send(e.toString()).catch(function(e){t.logTransportError(e,"Failed to send ACK to 2xx response.")})},u.prototype.receiveResponse=function(e){var t=this,r=e.statusCode;if(!r||r<100||699<r)throw new Error("Invalid status code "+r);switch(this.state){case a.TransactionState.Calling:if(100<=r&&r<=199)return this.stateTransition(a.TransactionState.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(200<=r&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(a.TransactionState.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(300<=r&&r<=699)return this.stateTransition(a.TransactionState.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case a.TransactionState.Proceeding:if(100<=r&&r<=199)return void(this.user.receiveResponse&&this.user.receiveResponse(e));if(200<=r&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(a.TransactionState.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(300<=r&&r<=699)return this.stateTransition(a.TransactionState.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case a.TransactionState.Accepted:if(200<=r&&r<=299){if(!this.ackRetransmissionCache.has(e.toTag))return this.ackRetransmissionCache.set(e.toTag,void 0),void(this.user.receiveResponse&&this.user.receiveResponse(e));var i=this.ackRetransmissionCache.get(e.toTag);return i?void this.send(i.toString()).catch(function(e){t.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")}):void 0}break;case a.TransactionState.Completed:if(300<=r&&r<=699)return void this.ack(e);break;case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="Received unexpected "+r+" response while in state "+this.state+".";this.logger.warn(n)},u.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(a.TransactionState.Terminated,!0)},u.prototype.typeToString=function(){return"INVITE client transaction"},u.prototype.ack=function(e){var t=this,r=this.request.ruri,i=this.request.callId,n=this.request.cseq,s=this.request.getHeader("from"),o=e.getHeader("to"),a=this.request.getHeader("via"),c=this.request.getHeader("route");if(!s)throw new Error("From undefined.");if(!o)throw new Error("To undefined.");if(!a)throw new Error("Via undefined.");var u="ACK "+r+" SIP/2.0\r\n";c&&(u+="Route: "+c+"\r\n"),u+="Via: "+a+"\r\n",u+="To: "+o+"\r\n",u+="From: "+s+"\r\n",u+="Call-ID: "+i+"\r\n",u+="CSeq: "+n+" ACK\r\n",u+="Max-Forwards: 70\r\n",u+="Content-Length: 0\r\n\r\n",this.send(u).catch(function(e){t.logTransportError(e,"Failed to send ACK to non-2xx response.")})},u.prototype.stateTransition=function(e,t){var r=this;function i(){throw new Error("Invalid state transition from "+r.state+" to "+e)}switch(void 0===t&&(t=!1),e){case a.TransactionState.Calling:i();break;case a.TransactionState.Proceeding:this.state!==a.TransactionState.Calling&&i();break;case a.TransactionState.Accepted:case a.TransactionState.Completed:this.state!==a.TransactionState.Calling&&this.state!==a.TransactionState.Proceeding&&i();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Calling&&this.state!==a.TransactionState.Accepted&&this.state!==a.TransactionState.Completed&&(t||i());break;default:i()}this.B&&(clearTimeout(this.B),this.B=void 0),a.TransactionState.Proceeding,e===a.TransactionState.Completed&&(this.D=setTimeout(function(){return r.timer_D()},s.Timers.TIMER_D)),e===a.TransactionState.Accepted&&(this.M=setTimeout(function(){return r.timer_M()},s.Timers.TIMER_M)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},u.prototype.timer_A=function(){},u.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id+"."),this.state===a.TransactionState.Calling&&(this.onRequestTimeout(),this.stateTransition(a.TransactionState.Terminated))},u.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id+"."),this.state===a.TransactionState.Completed&&this.stateTransition(a.TransactionState.Terminated)},u.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id+"."),this.state===a.TransactionState.Accepted&&this.stateTransition(a.TransactionState.Terminated)},u);function u(e,t,r){var i=n.call(this,e,t,r,a.TransactionState.Calling,"sip.transaction.ict")||this;return i.ackRetransmissionCache=new Map,i.B=setTimeout(function(){return i.timer_B()},s.Timers.TIMER_B),i.send(e.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")}),i}t.InviteClientTransaction=c},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.TransactionState||(t.TransactionState={})).Accepted="Accepted",i.Calling="Calling",i.Completed="Completed",i.Confirmed="Confirmed",i.Proceeding="Proceeding",i.Terminated="Terminated",i.Trying="Trying"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(5),o=r(27),a=r(39),c=r(37),u=(i=a.ServerTransaction,n.__extends(d,i),d.prototype.dispose=function(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),i.prototype.dispose.call(this)},Object.defineProperty(d.prototype,"kind",{get:function(){return"ist"},enumerable:!0,configurable:!0}),d.prototype.receiveRequest=function(e){var t=this;switch(this.state){case c.TransactionState.Proceeding:if(e.method===s.C.INVITE)return void(this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")}));break;case c.TransactionState.Accepted:if(e.method===s.C.INVITE)return;break;case c.TransactionState.Completed:if(e.method===s.C.INVITE){if(!this.lastFinalResponse)throw new Error("Last final response undefined.");return void this.send(this.lastFinalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")})}if(e.method===s.C.ACK)return void this.stateTransition(c.TransactionState.Confirmed);break;case c.TransactionState.Confirmed:case c.TransactionState.Terminated:if(e.method===s.C.INVITE||e.method===s.C.ACK)return;break;default:throw new Error("Invalid state "+this.state)}var r="INVITE server transaction received unexpected "+e.method+" request while in state "+this.state+".";this.logger.warn(r)},d.prototype.receiveResponse=function(e,t){var r=this;if(e<100||699<e)throw new Error("Invalid status code "+e);switch(this.state){case c.TransactionState.Proceeding:if(100<=e&&e<=199)return this.lastProvisionalResponse=t,100<e&&this.startProgressExtensionTimer(),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 1xx response.")});if(200<=e&&e<=299)return this.lastFinalResponse=t,this.stateTransition(c.TransactionState.Accepted),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});if(300<=e&&e<=699)return this.lastFinalResponse=t,this.stateTransition(c.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send non-2xx final response.")});break;case c.TransactionState.Accepted:if(200<=e&&e<=299)return void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});break;case c.TransactionState.Completed:case c.TransactionState.Confirmed:case c.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(i),new Error(i)},d.prototype.retransmitAcceptedResponse=function(){var t=this;this.state===c.TransactionState.Accepted&&this.lastFinalResponse&&this.send(this.lastFinalResponse).catch(function(e){t.logTransportError(e,"Failed to send 2xx response.")})},d.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e)},d.prototype.typeToString=function(){return"INVITE server transaction"},d.prototype.stateTransition=function(e){function t(){throw new Error("Invalid state transition from "+r.state+" to "+e)}var r=this;switch(e){case c.TransactionState.Proceeding:t();break;case c.TransactionState.Accepted:case c.TransactionState.Completed:this.state!==c.TransactionState.Proceeding&&t();break;case c.TransactionState.Confirmed:this.state!==c.TransactionState.Completed&&t();break;case c.TransactionState.Terminated:this.state!==c.TransactionState.Accepted&&this.state!==c.TransactionState.Completed&&this.state!==c.TransactionState.Confirmed&&t();break;default:t()}this.stopProgressExtensionTimer(),e===c.TransactionState.Accepted&&(this.L=setTimeout(function(){return r.timer_L()},o.Timers.TIMER_L)),e===c.TransactionState.Completed&&(this.H=setTimeout(function(){return r.timer_H()},o.Timers.TIMER_H)),e===c.TransactionState.Confirmed&&(this.I=setTimeout(function(){return r.timer_I()},o.Timers.TIMER_I)),e===c.TransactionState.Terminated&&this.dispose(),this.setState(e)},d.prototype.startProgressExtensionTimer=function(){var t=this;void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval(function(){if(t.logger.debug("Progress extension timer expired for INVITE server transaction "+t.id+"."),!t.lastProvisionalResponse)throw new Error("Last provisional response undefined.");t.send(t.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")})},o.Timers.PROVISIONAL_RESPONSE_INTERVAL))},d.prototype.stopProgressExtensionTimer=function(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)},d.prototype.timer_G=function(){},d.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id+"."),this.state===c.TransactionState.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(c.TransactionState.Terminated))},d.prototype.timer_I=function(){this.logger.debug("Timer I expired for INVITE server transaction "+this.id+"."),this.stateTransition(c.TransactionState.Terminated)},d.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id+"."),this.state===c.TransactionState.Accepted&&this.stateTransition(c.TransactionState.Terminated)},d);function d(e,t,r){return i.call(this,e,t,r,c.TransactionState.Proceeding,"sip.transaction.ist")||this}t.InviteServerTransaction=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(1),n=r(30),s=(o=n.Transaction,i.__extends(a,o),Object.defineProperty(a.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),a);function a(e,t,r,i,n){var s=o.call(this,t,r,e.viaBranch,i,n)||this;return s._request=e,s.user=r,s}t.ServerTransaction=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(27),o=r(29),a=r(37),c=(n=o.ClientTransaction,i.__extends(u,n),u.prototype.dispose=function(){this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),n.prototype.dispose.call(this)},Object.defineProperty(u.prototype,"kind",{get:function(){return"nict"},enumerable:!0,configurable:!0}),u.prototype.receiveResponse=function(e){var t=e.statusCode;if(!t||t<100||699<t)throw new Error("Invalid status code "+t);switch(this.state){case a.TransactionState.Trying:if(100<=t&&t<=199)return this.stateTransition(a.TransactionState.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(200<=t&&t<=699)return this.stateTransition(a.TransactionState.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case a.TransactionState.Proceeding:if(100<=t&&t<=199&&this.user.receiveResponse)return this.user.receiveResponse(e);if(200<=t&&t<=699)return this.stateTransition(a.TransactionState.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));case a.TransactionState.Completed:case a.TransactionState.Terminated:return;default:throw new Error("Invalid state "+this.state)}var r="Non-INVITE client transaction received unexpected "+t+" response while in state "+this.state+".";this.logger.warn(r)},u.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(a.TransactionState.Terminated,!0)},u.prototype.typeToString=function(){return"non-INVITE client transaction"},u.prototype.stateTransition=function(e,t){var r=this;function i(){throw new Error("Invalid state transition from "+r.state+" to "+e)}switch(void 0===t&&(t=!1),e){case a.TransactionState.Trying:i();break;case a.TransactionState.Proceeding:this.state!==a.TransactionState.Trying&&i();break;case a.TransactionState.Completed:this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding&&i();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding&&this.state!==a.TransactionState.Completed&&(t||i());break;default:i()}e===a.TransactionState.Completed&&(this.F&&(clearTimeout(this.F),this.F=void 0),this.K=setTimeout(function(){return r.timer_K()},s.Timers.TIMER_K)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},u.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id+"."),this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding||(this.onRequestTimeout(),this.stateTransition(a.TransactionState.Terminated))},u.prototype.timer_K=function(){this.state===a.TransactionState.Completed&&this.stateTransition(a.TransactionState.Terminated)},u);function u(e,t,r){var i=n.call(this,e,t,r,a.TransactionState.Trying,"sip.transaction.nict")||this;return i.F=setTimeout(function(){return i.timer_F()},s.Timers.TIMER_F),i.send(e.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")}),i}t.NonInviteClientTransaction=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(27),o=r(39),a=r(37),c=(i=o.ServerTransaction,n.__extends(u,i),u.prototype.dispose=function(){this.J&&(clearTimeout(this.J),this.J=void 0),i.prototype.dispose.call(this)},Object.defineProperty(u.prototype,"kind",{get:function(){return"nist"},enumerable:!0,configurable:!0}),u.prototype.receiveRequest=function(e){var t=this;switch(this.state){case a.TransactionState.Trying:break;case a.TransactionState.Proceeding:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")});break;case a.TransactionState.Completed:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")});break;case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}},u.prototype.receiveResponse=function(e,t){var r=this;if(e<100||699<e)throw new Error("Invalid status code "+e);if(100<e&&e<=199)throw new Error("Provisional response other than 100 not allowed.");switch(this.state){case a.TransactionState.Trying:if(this.lastResponse=t,100<=e&&e<200)return this.stateTransition(a.TransactionState.Proceeding),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send provisional response.")});if(200<=e&&e<=699)return this.stateTransition(a.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case a.TransactionState.Proceeding:if(this.lastResponse=t,200<=e&&e<=699)return this.stateTransition(a.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case a.TransactionState.Completed:return;case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="Non-INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(i),new Error(i)},u.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(a.TransactionState.Terminated,!0)},u.prototype.typeToString=function(){return"non-INVITE server transaction"},u.prototype.stateTransition=function(e,t){var r=this;function i(){throw new Error("Invalid state transition from "+r.state+" to "+e)}switch(void 0===t&&(t=!1),e){case a.TransactionState.Trying:i();break;case a.TransactionState.Proceeding:this.state!==a.TransactionState.Trying&&i();break;case a.TransactionState.Completed:this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding&&i();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Proceeding&&this.state!==a.TransactionState.Completed&&(t||i());break;default:i()}e===a.TransactionState.Completed&&(this.J=setTimeout(function(){return r.timer_J()},s.Timers.TIMER_J)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},u.prototype.timer_J=function(){this.logger.debug("Timer J expired for NON-INVITE server transaction "+this.id+"."),this.state===a.TransactionState.Completed&&this.stateTransition(a.TransactionState.Terminated)},u);function u(e,t,r){return i.call(this,e,t,r,a.TransactionState.Trying,"sip.transaction.nist")||this}t.NonInviteServerTransaction=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),o=r(5),a=r(28),n=r(43),c=(s=n.UserAgentClient,i.__extends(u,s),u);function u(e,t,r){var i,n=e.createOutgoingRequestMessage(o.C.BYE,r);return i=s.call(this,a.NonInviteClientTransaction,e.userAgentCore,n,t)||this,e.dispose(),i}t.ByeUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),s=r(28),i=(o.prototype.dispose=function(){this.transaction.dispose()},Object.defineProperty(o.prototype,"loggerFactory",{get:function(){return this.core.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"transaction",{get:function(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction},enumerable:!0,configurable:!0}),o.prototype.cancel=function(e,t){var r=this;if(void 0===t&&(t={}),!this.transaction)throw new Error("Transaction undefined.");if(!this.message.to)throw new Error("To undefined.");if(!this.message.from)throw new Error("From undefined.");var i=this.core.makeOutgoingRequestMessage(n.C.CANCEL,this.message.ruri,this.message.from.uri,this.message.to.uri,{toTag:this.message.toTag,fromTag:this.message.fromTag,callId:this.message.callId,cseq:this.message.cseq},t.extraHeaders);return i.branch=this.message.branch,this.message.headers.Route&&(i.headers.Route=this.message.headers.Route),e&&i.setHeader("Reason",e),this.transaction.state===s.TransactionState.Proceeding?new o(s.NonInviteClientTransaction,this.core,i):this.transaction.once("stateChanged",function(){r.transaction&&r.transaction.state===s.TransactionState.Proceeding&&new o(s.NonInviteClientTransaction,r.core,i)}),i},o.prototype.authenticationGuard=function(e){var t,r,i=e.statusCode;if(!i)throw new Error("Response status code undefined.");if(401!==i&&407!==i)return!0;if(r=401===i?(t=e.parseHeader("www-authenticate"),"authorization"):(t=e.parseHeader("proxy-authenticate"),"proxy-authorization"),!t)return this.logger.warn(i+" with wrong or missing challenge, cannot authenticate"),!0;if(this.challenged&&(this.stale||!0!==t.stale))return this.logger.warn(i+" apparently in authentication loop, cannot authenticate"),!0;if(!this.credentials&&(this.credentials=this.core.configuration.authenticationFactory(),!this.credentials))return this.logger.warn("Unable to obtain credentials, cannot authenticate"),!0;if(!this.credentials.authenticate(this.message,t))return!0;this.challenged=!0,t.stale&&(this.stale=!0);var n=this.message.cseq+=1;return this.message.setHeader("cseq",n+" "+this.message.method),this.message.setHeader(r,this.credentials.toString()),this.init(),!1},o.prototype.onRequestTimeout=function(){this.logger.warn("User agent client request timed out. Generating internal 408 Request Timeout.");var e=new n.IncomingResponseMessage;e.statusCode=408,e.reasonPhrase="Request Timeout",this.receiveResponse(e)},o.prototype.onTransportError=function(e){this.logger.error(e.message),this.logger.error("User agent client request transport error. Generating internal 503 Service Unavailable.");var t=new n.IncomingResponseMessage;t.statusCode=503,t.reasonPhrase="Service Unavailable",this.receiveResponse(t)},o.prototype.receiveResponse=function(e){if(this.authenticationGuard(e)){var t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e});break;case/^2[0-9]{2}$/.test(t):this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e});break;case/^3[0-9]{2}$/.test(t):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error("Invalid status code "+t)}}},o.prototype.init=function(){var t=this,e={loggerFactory:this.loggerFactory,onRequestTimeout:function(){return t.onRequestTimeout()},onStateChange:function(e){e===s.TransactionState.Terminated&&(t.core.userAgentClients.delete(i),r===t._transaction&&t.dispose())},onTransportError:function(e){return t.onTransportError(e)},receiveResponse:function(e){return t.receiveResponse(e)}},r=new this.transactionConstructor(this.message,this.core.transport,e),i=(this._transaction=r).id+r.request.method;this.core.userAgentClients.set(i,this)},o);function o(e,t,r,i){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=i,this.challenged=!1,this.stale=!1,this.logger=this.loggerFactory.getLogger("sip.user-agent-client"),this.init()}t.UserAgentClient=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(45),a=(i=o.UserAgentServer,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteServerTransaction,e.userAgentCore,t,r)||this}t.ByeUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(32),i=r(5),s=r(16),o=r(28),a=(c.prototype.dispose=function(){this.transaction.dispose()},Object.defineProperty(c.prototype,"loggerFactory",{get:function(){return this.core.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"transaction",{get:function(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction},enumerable:!0,configurable:!0}),c.prototype.accept=function(e){if(void 0===e&&(e={statusCode:200}),!this.acceptable)throw new n.TransactionStateError(this.message.method+" not acceptable in state "+this.transaction.state+".");var t=e.statusCode;if(t<200||299<t)throw new TypeError("Invalid statusCode: "+t);return this.reply(e)},c.prototype.progress=function(e){if(void 0===e&&(e={statusCode:180}),!this.progressable)throw new n.TransactionStateError(this.message.method+" not progressable in state "+this.transaction.state+".");var t=e.statusCode;if(t<101||199<t)throw new TypeError("Invalid statusCode: "+t);return this.reply(e)},c.prototype.redirect=function(e,t){if(void 0===t&&(t={statusCode:302}),!this.redirectable)throw new n.TransactionStateError(this.message.method+" not redirectable in state "+this.transaction.state+".");var r=t.statusCode;if(r<300||399<r)throw new TypeError("Invalid statusCode: "+r);var i=new Array;return e.forEach(function(e){return i.push("Contact: "+e.toString())}),t.extraHeaders=(t.extraHeaders||[]).concat(i),this.reply(t)},c.prototype.reject=function(e){if(void 0===e&&(e={statusCode:480}),!this.rejectable)throw new n.TransactionStateError(this.message.method+" not rejectable in state "+this.transaction.state+".");var t=e.statusCode;if(t<400||699<t)throw new TypeError("Invalid statusCode: "+t);return this.reply(e)},c.prototype.trying=function(e){if(!this.tryingable)throw new n.TransactionStateError(this.message.method+" not tryingable in state "+this.transaction.state+".");return this.reply({statusCode:100})},c.prototype.receiveCancel=function(e){this.delegate&&this.delegate.onCancel&&this.delegate.onCancel(e)},Object.defineProperty(c.prototype,"acceptable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding||this.transaction.state===o.TransactionState.Accepted;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying||this.transaction.state===o.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"progressable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return!1;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"redirectable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying||this.transaction.state===o.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rejectable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying||this.transaction.state===o.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tryingable",{get:function(){if(this.transaction instanceof o.InviteServerTransaction)return this.transaction.state===o.TransactionState.Proceeding;if(this.transaction instanceof o.NonInviteServerTransaction)return this.transaction.state===o.TransactionState.Trying;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),c.prototype.reply=function(e){e.toTag||100===e.statusCode||(e.toTag=this.toTag),e.userAgent=e.userAgent||this.core.configuration.userAgentHeaderFieldValue,e.supported=e.supported||this.core.configuration.supportedOptionTagsResponse;var t=i.constructOutgoingResponse(this.message,e);return this.transaction.receiveResponse(e.statusCode,t.message),t},c.prototype.init=function(){var t=this,e={loggerFactory:this.loggerFactory,onStateChange:function(e){e===o.TransactionState.Terminated&&(t.core.userAgentServers.delete(i),t.dispose())},onTransportError:function(e){t.logger.error(e.message),t.delegate&&t.delegate.onTransportError?t.delegate.onTransportError(e):t.logger.error("User agent server response transport error.")}},r=new this.transactionConstructor(this.message,this.core.transport,e),i=(this._transaction=r).id;this.core.userAgentServers.set(r.id,this)},c);function c(e,t,r,i){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=i,this.logger=this.loggerFactory.getLogger("sip.user-agent-server"),this.toTag=r.toTag?r.toTag:s.newTag(),this.init()}t.UserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(5),o=r(28),a=r(43),c=(n=a.UserAgentClient,i.__extends(u,n),u);function u(e,t,r){var i=e.createOutgoingRequestMessage(s.C.INFO,r);return n.call(this,o.NonInviteClientTransaction,e.userAgentCore,i,t)||this}t.InfoUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(45),a=(i=o.UserAgentServer,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteServerTransaction,e.userAgentCore,t,r)||this}t.InfoUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(5),o=r(28),a=r(43),c=(n=a.UserAgentClient,i.__extends(u,n),u);function u(e,t,r){var i=e.createOutgoingRequestMessage(s.C.NOTIFY,r);return n.call(this,o.NonInviteClientTransaction,e.userAgentCore,i,t)||this}t.NotifyUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(28),o=r(45),a=(n=o.UserAgentServer,i.__extends(c,n),c);function c(e,t,r){var i=void 0!==e.userAgentCore?e.userAgentCore:e;return n.call(this,s.NonInviteServerTransaction,i,t,r)||this}t.NotifyUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),o=r(5),a=r(28),n=r(43),c=(s=n.UserAgentClient,i.__extends(u,s),u);function u(e,t,r){var i,n=e.createOutgoingRequestMessage(o.C.PRACK,r);return i=s.call(this,a.NonInviteClientTransaction,e.userAgentCore,n,t)||this,e.signalingStateTransition(n),i}t.PrackUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(28),o=r(45),a=(n=o.UserAgentServer,i.__extends(c,n),c.prototype.accept=function(e){return void 0===e&&(e={statusCode:200}),e.body&&this.dialog.signalingStateTransition(e.body),n.prototype.accept.call(this,e)},c);function c(e,t,r){var i=n.call(this,s.NonInviteServerTransaction,e.userAgentCore,t,r)||this;return e.signalingStateTransition(t),i.dialog=e,i}t.PrackUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),o=r(5),a=r(28),n=r(43),c=(s=n.UserAgentClient,i.__extends(u,s),u.prototype.receiveResponse=function(e){var t=this,r=e.statusCode?e.statusCode.toString():"";if(!r)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(r):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(r):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:this.dialog,prack:function(e){throw new Error("Unimplemented.")}});break;case/^2[0-9]{2}$/.test(r):this.dialog.signalingStateTransition(e),this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e,session:this.dialog,ack:function(e){return t.dialog.ack(e)}});break;case/^3[0-9]{2}$/.test(r):this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentClient=void 0,this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(r):this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentClient=void 0,this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error("Invalid status code "+r)}},u);function u(e,t,r){var i=this,n=e.createOutgoingRequestMessage(o.C.INVITE,r);return(i=s.call(this,a.InviteClientTransaction,e.userAgentCore,n,t)||this).delegate=t,e.signalingStateTransition(n),(e.reinviteUserAgentClient=i).dialog=e,i}t.ReInviteUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(1),o=r(28),i=r(45),a=(n=i.UserAgentServer,s.__extends(c,n),c.prototype.accept=function(e){void 0===e&&(e={statusCode:200}),e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(this.dialog.routeSet.map(function(e){return"Record-Route: "+e}));var t=n.prototype.accept.call(this,e),r=this.dialog,i=s.__assign(s.__assign({},t),{session:r});return e.body&&this.dialog.signalingStateTransition(e.body),this.dialog.reConfirm(),i},c.prototype.progress=function(e){void 0===e&&(e={statusCode:180});var t=n.prototype.progress.call(this,e),r=this.dialog,i=s.__assign(s.__assign({},t),{session:r});return e.body&&this.dialog.signalingStateTransition(e.body),i},c.prototype.redirect=function(e,t){throw void 0===t&&(t={statusCode:302}),this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentServer=void 0,new Error("Unimplemented.")},c.prototype.reject=function(e){return void 0===e&&(e={statusCode:488}),this.dialog.signalingStateRollback(),this.dialog.reinviteUserAgentServer=void 0,n.prototype.reject.call(this,e)},c);function c(e,t,r){var i=n.call(this,o.InviteServerTransaction,e.userAgentCore,t,r)||this;return(e.reinviteUserAgentServer=i).dialog=e,i}t.ReInviteUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(5),o=r(28),a=r(43),c=(n=a.UserAgentClient,i.__extends(u,n),u);function u(e,t,r){var i=e.createOutgoingRequestMessage(s.C.REFER,r);return n.call(this,o.NonInviteClientTransaction,e.userAgentCore,i,t)||this}t.ReferUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(28),o=r(45),a=(n=o.UserAgentServer,i.__extends(c,n),c);function c(e,t,r){var i=void 0!==e.userAgentCore?e.userAgentCore:e;return n.call(this,s.NonInviteServerTransaction,i,t,r)||this}t.ReferUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=r(1),u=r(5),o=r(57),n=r(27),s=r(59),c=r(49),d=r(60),p=r(4),l=(a=p.Dialog,i.__extends(h,a),h.initialDialogStateForSubscription=function(e,t){var r=t.getHeaders("record-route"),i=t.parseHeader("contact");if(!i)throw new Error("Contact undefined.");if(!(i instanceof u.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var n=i.uri,s=e.cseq,o=e.callId,a=e.fromTag,c=t.fromTag;if(!o)throw new Error("Call id undefined.");if(!a)throw new Error("From tag undefined.");if(!c)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");return{id:o+a+c,early:!1,callId:o,localTag:a,remoteTag:c,localSequenceNumber:s,remoteSequenceNumber:void 0,localURI:e.from.uri,remoteURI:e.to.uri,remoteTarget:n,routeSet:r,secure:!1}},h.prototype.dispose=function(){a.prototype.dispose.call(this),this.N&&(clearTimeout(this.N),this.N=void 0),this.refreshTimerClear(),this.logger.log("SUBSCRIBE dialog "+this.id+" destroyed")},Object.defineProperty(h.prototype,"autoRefresh",{get:function(){return this._autoRefresh},set:function(e){this._autoRefresh=!0,this.refreshTimerSet()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"subscriptionEvent",{get:function(){return this._subscriptionEvent},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"subscriptionExpires",{get:function(){var e=Math.floor(Date.now()/1e3)-this._subscriptionExpiresLastSet,t=this._subscriptionExpires-e;return Math.max(t,0)},set:function(e){if(e<0)throw new Error("Expires must be greater than or equal to zero.");if(this._subscriptionExpires=e,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this.autoRefresh){var t=this.subscriptionRefresh;(void 0===t||e<=t)&&this.refreshTimerSet()}},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"subscriptionExpiresInitial",{get:function(){return this._subscriptionExpiresInitial},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"subscriptionRefresh",{get:function(){if(void 0!==this._subscriptionRefresh&&void 0!==this._subscriptionRefreshLastSet){var e=Math.floor(Date.now()/1e3)-this._subscriptionRefreshLastSet,t=this._subscriptionRefresh-e;return Math.max(t,0)}},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"subscriptionState",{get:function(){return this._subscriptionState},enumerable:!0,configurable:!0}),h.prototype.receiveRequest=function(e){if(this.logger.log("SUBSCRIBE dialog "+this.id+" received "+e.method+" request"),this.sequenceGuard(e))switch(a.prototype.receiveRequest.call(this,e),e.method){case u.C.NOTIFY:this.onNotify(e);break;default:this.logger.log("SUBSCRIBE dialog "+this.id+" received unimplemented "+e.method+" request"),this.core.replyStateless(e,{statusCode:501})}else this.logger.log("SUBSCRIBE dialog "+this.id+" rejected out of order "+e.method+" request.")},h.prototype.refresh=function(){var e="Allow: "+s.AllowedMethods.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: "+this.subscriptionExpiresInitial),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)},h.prototype.subscribe=function(e,t){var r=this;if(void 0===t&&(t={}),this.subscriptionState!==o.SubscriptionState.Pending&&this.subscriptionState!==o.SubscriptionState.Active)throw new Error("Invalid state "+this.subscriptionState+'. May only re-subscribe while in state "pending" or "active".');this.logger.log("SUBSCRIBE dialog "+this.id+" sending SUBSCRIBE request");var i=new d.ReSubscribeUserAgentClient(this,e,t);return this.N=setTimeout(function(){return r.timer_N()},n.Timers.TIMER_N),i},h.prototype.terminate=function(){this.stateTransition(o.SubscriptionState.Terminated),this.onTerminated()},h.prototype.unsubscribe=function(){var e="Allow: "+s.AllowedMethods.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: 0"),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)},h.prototype.onNotify=function(e){var t=e.parseHeader("Event").event;if(t&&t===this.subscriptionEvent){this.N&&(clearTimeout(this.N),this.N=void 0);var r=e.parseHeader("Subscription-State");if(r&&r.state){var i=r.state,n=r.expires?Math.max(r.expires,0):void 0;switch(i){case"pending":this.stateTransition(o.SubscriptionState.Pending,n);break;case"active":this.stateTransition(o.SubscriptionState.Active,n);break;case"terminated":this.stateTransition(o.SubscriptionState.Terminated,n);break;default:this.logger.warn("Unrecognized subscription state.")}var s=new c.NotifyUserAgentServer(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(s):s.accept()}else this.core.replyStateless(e,{statusCode:489})}else this.core.replyStateless(e,{statusCode:489})},h.prototype.onRefresh=function(e){this.delegate&&this.delegate.onRefresh&&this.delegate.onRefresh(e)},h.prototype.onTerminated=function(){this.delegate&&this.delegate.onTerminated&&this.delegate.onTerminated()},h.prototype.refreshTimerClear=function(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=void 0)},h.prototype.refreshTimerSet=function(){var e=this;if(this.refreshTimerClear(),this.autoRefresh&&0<this.subscriptionExpires){var t=900*this.subscriptionExpires;this._subscriptionRefresh=Math.floor(t/1e3),this._subscriptionRefreshLastSet=Math.floor(Date.now()/1e3),this.refreshTimer=setTimeout(function(){e.refreshTimer=void 0,e._subscriptionRefresh=void 0,e._subscriptionRefreshLastSet=void 0,e.onRefresh(e.refresh())},t)}},h.prototype.stateTransition=function(e,t){function r(){i.logger.warn("Invalid subscription state transition from "+i.subscriptionState+" to "+e)}var i=this;switch(e){case o.SubscriptionState.Initial:case o.SubscriptionState.NotifyWait:return void r();case o.SubscriptionState.Pending:if(this.subscriptionState!==o.SubscriptionState.NotifyWait&&this.subscriptionState!==o.SubscriptionState.Pending)return void r();break;case o.SubscriptionState.Active:case o.SubscriptionState.Terminated:if(this.subscriptionState!==o.SubscriptionState.NotifyWait&&this.subscriptionState!==o.SubscriptionState.Pending&&this.subscriptionState!==o.SubscriptionState.Active)return void r();break;default:return void r()}e===o.SubscriptionState.Pending&&t&&(this.subscriptionExpires=t),e===o.SubscriptionState.Active&&t&&(this.subscriptionExpires=t),e===o.SubscriptionState.Terminated&&this.dispose(),this._subscriptionState=e},h.prototype.timer_N=function(){this.subscriptionState!==o.SubscriptionState.Terminated&&(this.stateTransition(o.SubscriptionState.Terminated),this.onTerminated())},h);function h(e,t,r,i,n,s){var o=a.call(this,i,n)||this;return o.delegate=s,o._autoRefresh=!1,o._subscriptionEvent=e,o._subscriptionExpires=t,o._subscriptionExpiresInitial=t,o._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),o._subscriptionRefresh=void 0,o._subscriptionRefreshLastSet=void 0,o._subscriptionState=r,o.logger=i.loggerFactory.getLogger("sip.subscribe-dialog"),o.logger.log("SUBSCRIBE dialog "+o.id+" constructed"),o}t.SubscriptionDialog=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(1).__exportStar(r(58),t)},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.SubscriptionState||(t.SubscriptionState={})).Initial="Initial",i.NotifyWait="NotifyWait",i.Pending="Pending",i.Active="Active",i.Terminated="Terminated"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5);t.AllowedMethods=[i.C.ACK,i.C.BYE,i.C.CANCEL,i.C.INFO,i.C.INVITE,i.C.MESSAGE,i.C.NOTIFY,i.C.OPTIONS,i.C.PRACK,i.C.REFER,i.C.REGISTER,i.C.SUBSCRIBE]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),o=r(5),a=r(28),n=r(43),c=(s=n.UserAgentClient,i.__extends(u,s),u.prototype.waitNotifyStop=function(){},u.prototype.receiveResponse=function(e){if(e.statusCode&&200<=e.statusCode&&e.statusCode<300){var t=e.getHeader("Expires");if(t){var r=Number(t);this.dialog.subscriptionExpires>r&&(this.dialog.subscriptionExpires=r)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE")}e.statusCode&&400<=e.statusCode&&e.statusCode<700&&-1!==[404,405,410,416,480,481,482,483,484,485,489,501,604].indexOf(e.statusCode)&&this.dialog.terminate(),s.prototype.receiveResponse.call(this,e)},u);function u(e,t,r){var i=this,n=e.createOutgoingRequestMessage(o.C.SUBSCRIBE,r);return(i=s.call(this,a.NonInviteClientTransaction,e.userAgentCore,n,t)||this).dialog=e,i}t.ReSubscribeUserAgentClient=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(62),t),i.__exportStar(r(63),t),i.__exportStar(r(64),t)},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.Levels||(t.Levels={}))[i.error=0]="error",i[i.warn=1]="warn",i[i.log=2]="log",i[i.debug=3]="debug"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(62),i=r(64),n=(Object.defineProperty(o.prototype,"level",{get:function(){return this._level},set:function(e){0<=e&&e<=3?this._level=e:3<e?this._level=3:s.Levels.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"connector",{get:function(){return this._connector},set:function(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0},enumerable:!0,configurable:!0}),o.prototype.getLogger=function(e,t){if(t&&3===this.level)return new i.Logger(this,e,t);if(this.loggers[e])return this.loggers[e];var r=new i.Logger(this,e);return this.loggers[e]=r},o.prototype.genericLog=function(e,t,r,i){this.level>=e&&this.builtinEnabled&&this.print(e,t,r,i),this.connector&&this.connector(s.Levels[e],t,r,i)},o.prototype.print=function(e,t,r,i){if("string"==typeof i){var n=[new Date,t];r&&n.push(r),i=n.concat(i).join(" | ")}switch(e){case s.Levels.error:console.error(i);break;case s.Levels.warn:console.warn(i);break;case s.Levels.log:console.log(i);break;case s.Levels.debug:console.debug(i)}},o);function o(){this.builtinEnabled=!0,this._level=s.Levels.log,this.loggers={},this.logger=this.getLogger("sip:loggerfactory")}t.LoggerFactory=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(62),n=(s.prototype.error=function(e){this.genericLog(i.Levels.error,e)},s.prototype.warn=function(e){this.genericLog(i.Levels.warn,e)},s.prototype.log=function(e){this.genericLog(i.Levels.log,e)},s.prototype.debug=function(e){this.genericLog(i.Levels.debug,e)},s.prototype.genericLog=function(e,t){this.logger.genericLog(e,this.category,this.label,t)},s);function s(e,t,r){this.logger=e,this.category=t,this.label=r}t.Logger=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(1).__exportStar(r(66),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=r(1),f=r(5),i=r(28),u=r(67),d=r(59),p=["application/sdp","application/dtmf-relay"],n=(s.prototype.dispose=function(){this.reset()},s.prototype.reset=function(){this.dialogs.forEach(function(e){return e.dispose()}),this.dialogs.clear(),this.subscribers.forEach(function(e){return e.dispose()}),this.subscribers.clear(),this.userAgentClients.forEach(function(e){return e.dispose()}),this.userAgentClients.clear(),this.userAgentServers.forEach(function(e){return e.dispose()}),this.userAgentServers.clear()},Object.defineProperty(s.prototype,"loggerFactory",{get:function(){return this.configuration.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"transport",{get:function(){var e=this.configuration.transportAccessor();if(!e)throw new Error("Transport undefined.");return e},enumerable:!0,configurable:!0}),s.prototype.invite=function(e,t){return new u.InviteUserAgentClient(this,e,t)},s.prototype.message=function(e,t){return new u.MessageUserAgentClient(this,e,t)},s.prototype.publish=function(e,t){return new u.PublishUserAgentClient(this,e,t)},s.prototype.register=function(e,t){return new u.RegisterUserAgentClient(this,e,t)},s.prototype.subscribe=function(e,t){return new u.SubscribeUserAgentClient(this,e,t)},s.prototype.request=function(e,t){return new u.UserAgentClient(i.NonInviteClientTransaction,this,e,t)},s.prototype.makeOutgoingRequestMessage=function(e,t,r,i,n,s,o){var a=this.configuration.sipjsId,c=this.configuration.displayName,u=this.configuration.viaForceRport,d=this.configuration.hackViaTcp,p=this.configuration.supportedOptionTags.slice();e===f.C.REGISTER&&p.push("path","gruu"),e===f.C.INVITE&&(this.configuration.contact.pubGruu||this.configuration.contact.tempGruu)&&p.push("gruu");var l={callIdPrefix:a,forceRport:u,fromDisplayName:c,hackViaTcp:d,optionTags:p,routeSet:this.configuration.routeSet,userAgentString:this.configuration.userAgentHeaderFieldValue,viaHost:this.configuration.viaHost},h=g.__assign(g.__assign({},l),n);return new f.OutgoingRequestMessage(e,t,r,i,h,s,o)},s.prototype.receiveIncomingRequestFromTransport=function(e){this.receiveRequestFromTransport(e)},s.prototype.receiveIncomingResponseFromTransport=function(e){this.receiveResponseFromTransport(e)},s.prototype.replyStateless=function(t,e){var r=this,i=this.configuration.userAgentHeaderFieldValue,n=this.configuration.supportedOptionTagsResponse;e=g.__assign(g.__assign({},e),{userAgent:i,supported:n});var s=f.constructOutgoingResponse(t,e);return this.transport.send(s.message).catch(function(e){e instanceof Error&&r.logger.error(e.message),r.logger.error("Transport error occurred sending stateless reply to "+t.method+" request.")}),s},s.prototype.receiveRequestFromTransport=function(e){var t=e.viaBranch,r=this.userAgentServers.get(t);e.method===f.C.ACK&&r&&r.transaction.state===i.TransactionState.Accepted&&r instanceof u.InviteUserAgentServer?this.logger.warn("Discarding out of dialog ACK after 2xx response sent on transaction "+t+"."):e.method!==f.C.CANCEL?r?r.transaction.receiveRequest(e):this.receiveRequest(e):r?(this.replyStateless(e,{statusCode:200}),r.transaction instanceof i.InviteServerTransaction&&r.transaction.state===i.TransactionState.Proceeding&&r instanceof u.InviteUserAgentServer&&r.receiveCancel(e)):this.replyStateless(e,{statusCode:481})},s.prototype.receiveRequest=function(t){if(-1!==d.AllowedMethods.indexOf(t.method)){if(!t.ruri)throw new Error("Request-URI undefined.");if("sip"===t.ruri.scheme){var r=t.ruri,e=function(e){return!!e&&e.user===r.user};if(!e(this.configuration.aor)&&!(e(this.configuration.contact.uri)||e(this.configuration.contact.pubGruu)||e(this.configuration.contact.tempGruu)))return this.logger.warn("Request-URI does not point to us."),void(t.method!==f.C.ACK&&this.replyStateless(t,{statusCode:404}));if(t.method!==f.C.INVITE||t.hasHeader("Contact")){if(!t.toTag){var i=t.viaBranch;if(!this.userAgentServers.has(i)&&Array.from(this.userAgentServers.values()).some(function(e){return e.transaction.request.fromTag===t.fromTag&&e.transaction.request.callId===t.callId&&e.transaction.request.cseq===t.cseq}))return void this.replyStateless(t,{statusCode:482})}t.toTag?this.receiveInsideDialogRequest(t):this.receiveOutsideDialogRequest(t)}else this.replyStateless(t,{statusCode:400,reasonPhrase:"Missing Contact Header"})}else this.replyStateless(t,{statusCode:416})}else{var n="Allow: "+d.AllowedMethods.toString();this.replyStateless(t,{statusCode:405,extraHeaders:[n]})}},s.prototype.receiveInsideDialogRequest=function(e){if(e.method===f.C.NOTIFY){var t=e.parseHeader("Event");if(!t||!t.event)return void this.replyStateless(e,{statusCode:489});var r=e.callId+e.toTag+t.event,i=this.subscribers.get(r);if(i){var n=new u.NotifyUserAgentServer(this,e);return void i.onNotify(n)}}var s=e.callId+e.toTag+e.fromTag,o=this.dialogs.get(s);if(o){if(e.method!==f.C.OPTIONS)return void o.receiveRequest(e);var a="Allow: "+d.AllowedMethods.toString(),c="Accept: "+p.toString();this.replyStateless(e,{statusCode:200,extraHeaders:[a,c]})}else e.method!==f.C.ACK&&this.replyStateless(e,{statusCode:481})},s.prototype.receiveOutsideDialogRequest=function(e){switch(e.method){case f.C.ACK:break;case f.C.BYE:this.replyStateless(e,{statusCode:481});break;case f.C.CANCEL:throw new Error("Unexpected out of dialog request method "+e.method+".");case f.C.INFO:this.replyStateless(e,{statusCode:405});break;case f.C.INVITE:var t=new u.InviteUserAgentServer(this,e);this.delegate.onInvite?this.delegate.onInvite(t):t.reject();break;case f.C.MESSAGE:t=new u.MessageUserAgentServer(this,e),this.delegate.onMessage?this.delegate.onMessage(t):t.accept();break;case f.C.NOTIFY:t=new u.NotifyUserAgentServer(this,e),this.delegate.onNotify?this.delegate.onNotify(t):t.reject({statusCode:405});break;case f.C.OPTIONS:var r="Allow: "+d.AllowedMethods.toString(),i="Accept: "+p.toString();this.replyStateless(e,{statusCode:200,extraHeaders:[r,i]});break;case f.C.REFER:t=new u.ReferUserAgentServer(this,e),this.delegate.onRefer?this.delegate.onRefer(t):t.reject({statusCode:405});break;case f.C.REGISTER:t=new u.RegisterUserAgentServer(this,e),this.delegate.onRegister?this.delegate.onRegister(t):t.reject({statusCode:405});break;case f.C.SUBSCRIBE:t=new u.SubscribeUserAgentServer(this,e),this.delegate.onSubscribe?this.delegate.onSubscribe(t):t.reject({statusCode:480});break;default:throw new Error("Unexpected out of dialog request method "+e.method+".")}},s.prototype.receiveResponseFromTransport=function(e){if(1<e.getHeaders("via").length)this.logger.warn("More than one Via header field present in the response, dropping");else{var t=e.viaBranch+e.method,r=this.userAgentClients.get(t);r?r.transaction.receiveResponse(e):this.logger.warn("Discarding unmatched "+e.statusCode+" response to "+e.method+" "+t+".")}},s);function s(e,t){void 0===t&&(t={}),this.userAgentClients=new Map,this.userAgentServers=new Map,this.configuration=e,this.delegate=t,this.dialogs=new Map,this.subscribers=new Map,this.logger=e.loggerFactory.getLogger("sip.user-agent-core")}t.UserAgentCore=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(42),t),i.__exportStar(r(44),t),i.__exportStar(r(68),t),i.__exportStar(r(46),t),i.__exportStar(r(47),t),i.__exportStar(r(69),t),i.__exportStar(r(70),t),i.__exportStar(r(71),t),i.__exportStar(r(72),t),i.__exportStar(r(48),t),i.__exportStar(r(49),t),i.__exportStar(r(73),t),i.__exportStar(r(50),t),i.__exportStar(r(51),t),i.__exportStar(r(52),t),i.__exportStar(r(53),t),i.__exportStar(r(60),t),i.__exportStar(r(74),t),i.__exportStar(r(54),t),i.__exportStar(r(55),t),i.__exportStar(r(75),t),i.__exportStar(r(76),t),i.__exportStar(r(77),t),i.__exportStar(r(78),t),i.__exportStar(r(43),t),i.__exportStar(r(45),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(43),a=(i=o.UserAgentClient,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteClientTransaction,e,t,r)||this}t.CancelUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),d=r(3),p=r(25),l=r(28),s=r(43),o=(n=s.UserAgentClient,i.__extends(a,n),a.prototype.dispose=function(){this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),n.prototype.dispose.call(this)},a.prototype.onTransportError=function(e){if(this.transaction.state===l.TransactionState.Calling)return n.prototype.onTransportError.call(this,e);this.logger.error(e.message),this.logger.error("User agent client request transport error while sending ACK.")},a.prototype.receiveResponse=function(e){var r=this;if(this.authenticationGuard(e)){var t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):return void(this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e}));case/^1[0-9]{2}$/.test(t):if(!e.toTag)return void this.logger.warn("Non-100 1xx INVITE response received without a to tag, dropping.");var i=d.Dialog.initialDialogStateForUserAgentClient(this.message,e),n=this.earlyDialogs.get(i.id);if(!n){if(!((a=this.transaction)instanceof l.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");n=new d.SessionDialog(a,this.core,i),this.earlyDialogs.set(n.id,n)}if(!n.reliableSequenceGuard(e))return void this.logger.warn("1xx INVITE reliable response received out of order, dropping.");n.signalingState!==p.SignalingState.Initial&&n.signalingState!==p.SignalingState.HaveLocalOffer||n.signalingStateTransition(e);var s=n;return void(this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:s,prack:function(e){return s.prack(void 0,e)}}));case/^2[0-9]{2}$/.test(t):i=d.Dialog.initialDialogStateForUserAgentClient(this.message,e);var o=this.confirmedDialogs.get(i.id);if(o){if(u=this.confirmedDialogAcks.get(i.id)){if(!((a=this.transaction)instanceof l.InviteClientTransaction))throw new Error("Client transaction not instance of InviteClientTransaction.");a.ackResponse(u.message)}return}if(o=this.earlyDialogs.get(i.id))o.confirm(),o.recomputeRouteSet(e),this.earlyDialogs.delete(o.id),this.confirmedDialogs.set(o.id,o);else{var a;if(!((a=this.transaction)instanceof l.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");o=new d.SessionDialog(a,this.core,i),this.confirmedDialogs.set(o.id,o)}o.signalingState!==p.SignalingState.Initial&&o.signalingState!==p.SignalingState.HaveLocalOffer||o.signalingStateTransition(e);var c=o;if(this.delegate&&this.delegate.onAccept)this.delegate.onAccept({message:e,session:c,ack:function(e){var t=c.ack(e);return r.confirmedDialogAcks.set(c.id,t),t}});else{var u=c.ack();this.confirmedDialogAcks.set(c.id,u)}return;case/^3[0-9]{2}$/.test(t):return this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e}));case/^[4-6][0-9]{2}$/.test(t):return this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e}));default:throw new Error("Invalid status code "+t)}throw new Error("Executing what should be an unreachable code path receiving "+t+" response.")}},a);function a(e,t,r){var i=n.call(this,l.InviteClientTransaction,e,t,r)||this;return i.confirmedDialogAcks=new Map,i.confirmedDialogs=new Map,i.earlyDialogs=new Map,i.delegate=r,i}t.InviteUserAgentClient=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u,d=r(1),p=r(3),l=r(32),h=r(25),g=r(28),f=r(59),i=r(45),n=(u=i.UserAgentServer,d.__extends(s,u),s.prototype.dispose=function(){this.earlyDialog&&this.earlyDialog.dispose(),u.prototype.dispose.call(this)},s.prototype.accept=function(e){if(void 0===e&&(e={statusCode:200}),!this.acceptable)throw new l.TransactionStateError(this.message.method+" not acceptable in state "+this.transaction.state+".");if(!this.confirmedDialog)if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{var t=this.transaction;if(!(t instanceof g.InviteServerTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");var r=p.Dialog.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new p.SessionDialog(t,this.core,r)}var i=this.message.getHeaders("record-route").map(function(e){return"Record-Route: "+e}),n="Contact: "+this.core.configuration.contact.toString(),s="Allow: "+f.AllowedMethods.toString();if(!e.body)if(this.confirmedDialog.signalingState===h.SignalingState.Stable)e.body=this.confirmedDialog.answer;else if(this.confirmedDialog.signalingState===h.SignalingState.Initial||this.confirmedDialog.signalingState===h.SignalingState.HaveRemoteOffer)throw new Error("Response must have a body.");e.statusCode=e.statusCode||200,e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(i),e.extraHeaders.push(s),e.extraHeaders.push(n);var o=u.prototype.accept.call(this,e),a=this.confirmedDialog,c=d.__assign(d.__assign({},o),{session:a});return e.body&&this.confirmedDialog.signalingState!==h.SignalingState.Stable&&this.confirmedDialog.signalingStateTransition(e.body),c},s.prototype.progress=function(e){if(void 0===e&&(e={statusCode:180}),!this.progressable)throw new l.TransactionStateError(this.message.method+" not progressable in state "+this.transaction.state+".");if(!this.earlyDialog){var t=this.transaction;if(!(t instanceof g.InviteServerTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");var r=p.Dialog.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new p.SessionDialog(t,this.core,r)}var i=this.message.getHeaders("record-route").map(function(e){return"Record-Route: "+e}),n="Contact: "+this.core.configuration.contact;e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(i),e.extraHeaders.push(n);var s=u.prototype.progress.call(this,e),o=this.earlyDialog,a=d.__assign(d.__assign({},s),{session:o});return e.body&&this.earlyDialog.signalingState!==h.SignalingState.Stable&&this.earlyDialog.signalingStateTransition(e.body),a},s.prototype.redirect=function(e,t){return void 0===t&&(t={statusCode:302}),u.prototype.redirect.call(this,e,t)},s.prototype.reject=function(e){return void 0===e&&(e={statusCode:486}),u.prototype.reject.call(this,e)},s);function s(e,t,r){var i=u.call(this,g.InviteServerTransaction,e,t,r)||this;return i.core=e,i}t.InviteUserAgentServer=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(43),a=(i=o.UserAgentClient,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteClientTransaction,e,t,r)||this}t.MessageUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(28),o=r(45),a=(n=o.UserAgentServer,i.__extends(c,n),c);function c(e,t,r){var i=n.call(this,s.NonInviteServerTransaction,e,t,r)||this;return i.core=e,i}t.MessageUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(43),a=(i=o.UserAgentClient,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteClientTransaction,e,t,r)||this}t.PublishUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(45),a=(i=o.UserAgentServer,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteServerTransaction,e.userAgentCore,t,r)||this}t.ReSubscribeUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(28),o=r(43),a=(i=o.UserAgentClient,n.__extends(c,i),c);function c(e,t,r){return i.call(this,s.NonInviteClientTransaction,e,t,r)||this}t.RegisterUserAgentClient=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(28),o=r(45),a=(n=o.UserAgentServer,i.__extends(c,n),c);function c(e,t,r){var i=n.call(this,s.NonInviteServerTransaction,e,t,r)||this;return i.core=e,i}t.RegisterUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(1),a=r(56),c=r(57),n=r(27),u=r(28),s=r(43),d=(o=s.UserAgentClient,i.__extends(p,o),p.prototype.dispose=function(){o.prototype.dispose.call(this)},p.prototype.onNotify=function(e){var t=e.message.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return this.logger.warn("Failed to parse event."),void e.reject({statusCode:489});var r=e.message.parseHeader("Subscription-State");if(!r||!r.state)return this.logger.warn("Failed to parse subscription state."),void e.reject({statusCode:489});var i=r.state;switch(i){case"pending":case"active":case"terminated":break;default:return this.logger.warn("Invalid subscription state "+i),void e.reject({statusCode:489})}if("terminated"!==i&&!e.message.parseHeader("contact"))return this.logger.warn("Failed to parse contact."),void e.reject({statusCode:489});if(this.dialog)throw new Error("Dialog already created. This implementation only supports install of single subscriptions.");switch(this.waitNotifyStop(),this.subscriptionExpires=r.expires?Math.min(this.subscriptionExpires,Math.max(r.expires,0)):this.subscriptionExpires,i){case"pending":this.subscriptionState=c.SubscriptionState.Pending;break;case"active":this.subscriptionState=c.SubscriptionState.Active;break;case"terminated":this.subscriptionState=c.SubscriptionState.Terminated;break;default:throw new Error("Unrecognized state "+i+".")}if(this.subscriptionState!==c.SubscriptionState.Terminated){var n=a.SubscriptionDialog.initialDialogStateForSubscription(this.message,e.message);this.dialog=new a.SubscriptionDialog(this.subscriptionEvent,this.subscriptionExpires,this.subscriptionState,this.core,n)}if(this.delegate&&this.delegate.onNotify){var s=e,o=this.dialog;this.delegate.onNotify({request:s,subscription:o})}else e.accept()},p.prototype.waitNotifyStart=function(){var e=this;this.N||(this.core.subscribers.set(this.subscriberId,this),this.N=setTimeout(function(){return e.timer_N()},n.Timers.TIMER_N))},p.prototype.waitNotifyStop=function(){this.N&&(this.core.subscribers.delete(this.subscriberId),clearTimeout(this.N),this.N=void 0)},p.prototype.receiveResponse=function(e){if(this.authenticationGuard(e)){if(e.statusCode&&200<=e.statusCode&&e.statusCode<300){var t=e.getHeader("Expires");if(t){var r=Number(t);r>this.subscriptionExpiresRequested&&this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),r<this.subscriptionExpires&&(this.subscriptionExpires=r)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE");this.dialog&&this.dialog.subscriptionExpires>this.subscriptionExpires&&(this.dialog.subscriptionExpires=this.subscriptionExpires)}e.statusCode&&300<=e.statusCode&&e.statusCode<700&&this.waitNotifyStop(),o.prototype.receiveResponse.call(this,e)}},p.prototype.timer_N=function(){this.logger.warn("Timer N expired for SUBSCRIBE user agent client. Timed out waiting for NOTIFY."),this.waitNotifyStop(),this.delegate&&this.delegate.onNotifyTimeout&&this.delegate.onNotifyTimeout()},p);function p(e,t,r){var i=this,n=t.getHeader("Event");if(!n)throw new Error("Event undefined");var s=t.getHeader("Expires");if(!s)throw new Error("Expires undefined");return(i=o.call(this,u.NonInviteClientTransaction,e,t,r)||this).delegate=r,i.subscriberId=t.callId+t.fromTag+n,i.subscriptionExpiresRequested=i.subscriptionExpires=Number(s),i.subscriptionEvent=n,i.subscriptionState=c.SubscriptionState.NotifyWait,i.waitNotifyStart(),i}t.SubscribeUserAgentClient=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(28),o=r(45),a=(n=o.UserAgentServer,i.__extends(c,n),c);function c(e,t,r){var i=n.call(this,s.NonInviteServerTransaction,e,t,r)||this;return i.core=e,i}t.SubscribeUserAgentServer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),n=r(31),o=r(80),l=r(2),h=r(82),g=r(83),a=(s=n.EventEmitter,i.__extends(c,s),c.initializer=function(e,t,r,i,n){if(e.type=h.TypeStrings.ClientContext,void 0===i)throw new TypeError("Not enough arguments");e.ua=t,e.logger=t.getLogger("sip.clientcontext"),e.method=r;var s=t.normalizeTarget(i);if(!s)throw new TypeError("Invalid target: "+i);var o=t.userAgentCore.configuration.aor;if(n&&n.params&&n.params.fromUri&&!(o="string"==typeof n.params.fromUri?l.Grammar.URIParse(n.params.fromUri):n.params.fromUri))throw new TypeError("Invalid from URI: "+n.params.fromUri);var a=s;if(n&&n.params&&n.params.toUri&&!(a="string"==typeof n.params.toUri?l.Grammar.URIParse(n.params.toUri):n.params.toUri))throw new TypeError("Invalid to URI: "+n.params.toUri);var c,u,d=((n=(n=Object.create(n||Object.prototype))||{}).extraHeaders||[]).slice(),p=n.params||{};n.body&&(c={body:n.body,contentType:n.contentType?n.contentType:"application/sdp"},e.body=c),c&&(u=g.Utils.fromBodyObj(c)),e.request=t.userAgentCore.makeOutgoingRequestMessage(r,s,o,a,p,d,u),e.request.from&&(e.localIdentity=e.request.from),e.request.to&&(e.remoteIdentity=e.request.to)},c.prototype.send=function(){var t=this;return this.ua.userAgentCore.request(this.request,{onAccept:function(e){return t.receiveResponse(e.message)},onProgress:function(e){return t.receiveResponse(e.message)},onRedirect:function(e){return t.receiveResponse(e.message)},onReject:function(e){return t.receiveResponse(e.message)},onTrying:function(e){return t.receiveResponse(e.message)}}),this},c.prototype.receiveResponse=function(e){var t=e.statusCode||0,r=g.Utils.getReasonPhrase(t);switch(!0){case/^1[0-9]{2}$/.test(t.toString()):this.emit("progress",e,r);break;case/^2[0-9]{2}$/.test(t.toString()):this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("accepted",e,r);break;default:this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("rejected",e,r),this.emit("failed",e,r)}},c.prototype.onRequestTimeout=function(){this.emit("failed",void 0,o.C.causes.REQUEST_TIMEOUT)},c.prototype.onTransportError=function(){this.emit("failed",void 0,o.C.causes.CONNECTION_ERROR)},c);function c(e,t,r,i){var n=s.call(this)||this;return n.data={},c.initializer(n,e,t,r,i),n}t.ClientContext=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n,s,o,a=r(81);(i=t.C||(t.C={})).version=a.LIBRARY_VERSION,i.USER_AGENT="SIP.js/"+a.LIBRARY_VERSION,i.SIP="sip",i.SIPS="sips",(n=i.causes||(i.causes={})).CONNECTION_ERROR="Connection Error",n.INTERNAL_ERROR="Internal Error",n.REQUEST_TIMEOUT="Request Timeout",n.SIP_FAILURE_CODE="SIP Failure Code",n.ADDRESS_INCOMPLETE="Address Incomplete",n.AUTHENTICATION_ERROR="Authentication Error",n.BUSY="Busy",n.DIALOG_ERROR="Dialog Error",n.INCOMPATIBLE_SDP="Incompatible SDP",n.NOT_FOUND="Not Found",n.REDIRECTED="Redirected",n.REJECTED="Rejected",n.UNAVAILABLE="Unavailable",n.BAD_MEDIA_DESCRIPTION="Bad Media Description",n.CANCELED="Canceled",n.EXPIRES="Expires",n.NO_ACK="No ACK",n.NO_ANSWER="No Answer",n.NO_PRACK="No PRACK",n.RTP_TIMEOUT="RTP Timeout",n.USER_DENIED_MEDIA_ACCESS="User Denied Media Access",n.WEBRTC_ERROR="WebRTC Error",n.WEBRTC_NOT_SUPPORTED="WebRTC Not Supported",(s=i.supported||(i.supported={})).REQUIRED="required",s.SUPPORTED="supported",s.UNSUPPORTED="none",i.SIP_ERROR_CAUSES={ADDRESS_INCOMPLETE:[484],AUTHENTICATION_ERROR:[401,407],BUSY:[486,600],INCOMPATIBLE_SDP:[488,606],NOT_FOUND:[404,604],REDIRECTED:[300,301,302,305,380],REJECTED:[403,603],UNAVAILABLE:[480,410,408,430]},i.ACK="ACK",i.BYE="BYE",i.CANCEL="CANCEL",i.INFO="INFO",i.INVITE="INVITE",i.MESSAGE="MESSAGE",i.NOTIFY="NOTIFY",i.OPTIONS="OPTIONS",i.REGISTER="REGISTER",i.UPDATE="UPDATE",i.SUBSCRIBE="SUBSCRIBE",i.PUBLISH="PUBLISH",i.REFER="REFER",i.PRACK="PRACK",i.REASON_PHRASE={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},i.OPTION_TAGS={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},(o=i.dtmfType||(i.dtmfType={})).INFO="info",o.RTP="rtp"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIBRARY_VERSION="0.15.10"},function(e,t,r){"use strict";var i,n,s,o;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.DialogStatus||(t.DialogStatus={}))[i.STATUS_EARLY=1]="STATUS_EARLY",i[i.STATUS_CONFIRMED=2]="STATUS_CONFIRMED",(n=t.SessionStatus||(t.SessionStatus={}))[n.STATUS_NULL=0]="STATUS_NULL",n[n.STATUS_INVITE_SENT=1]="STATUS_INVITE_SENT",n[n.STATUS_1XX_RECEIVED=2]="STATUS_1XX_RECEIVED",n[n.STATUS_INVITE_RECEIVED=3]="STATUS_INVITE_RECEIVED",n[n.STATUS_WAITING_FOR_ANSWER=4]="STATUS_WAITING_FOR_ANSWER",n[n.STATUS_ANSWERED=5]="STATUS_ANSWERED",n[n.STATUS_WAITING_FOR_PRACK=6]="STATUS_WAITING_FOR_PRACK",n[n.STATUS_WAITING_FOR_ACK=7]="STATUS_WAITING_FOR_ACK",n[n.STATUS_CANCELED=8]="STATUS_CANCELED",n[n.STATUS_TERMINATED=9]="STATUS_TERMINATED",n[n.STATUS_ANSWERED_WAITING_FOR_PRACK=10]="STATUS_ANSWERED_WAITING_FOR_PRACK",n[n.STATUS_EARLY_MEDIA=11]="STATUS_EARLY_MEDIA",n[n.STATUS_CONFIRMED=12]="STATUS_CONFIRMED",(s=t.TypeStrings||(t.TypeStrings={}))[s.ClientContext=0]="ClientContext",s[s.ConfigurationError=1]="ConfigurationError",s[s.Dialog=2]="Dialog",s[s.DigestAuthentication=3]="DigestAuthentication",s[s.DTMF=4]="DTMF",s[s.IncomingMessage=5]="IncomingMessage",s[s.IncomingRequest=6]="IncomingRequest",s[s.IncomingResponse=7]="IncomingResponse",s[s.InvalidStateError=8]="InvalidStateError",s[s.InviteClientContext=9]="InviteClientContext",s[s.InviteServerContext=10]="InviteServerContext",s[s.Logger=11]="Logger",s[s.LoggerFactory=12]="LoggerFactory",s[s.MethodParameterError=13]="MethodParameterError",s[s.NameAddrHeader=14]="NameAddrHeader",s[s.NotSupportedError=15]="NotSupportedError",s[s.OutgoingRequest=16]="OutgoingRequest",s[s.Parameters=17]="Parameters",s[s.PublishContext=18]="PublishContext",s[s.ReferClientContext=19]="ReferClientContext",s[s.ReferServerContext=20]="ReferServerContext",s[s.RegisterContext=21]="RegisterContext",s[s.RenegotiationError=22]="RenegotiationError",s[s.RequestSender=23]="RequestSender",s[s.ServerContext=24]="ServerContext",s[s.Session=25]="Session",s[s.SessionDescriptionHandler=26]="SessionDescriptionHandler",s[s.SessionDescriptionHandlerError=27]="SessionDescriptionHandlerError",s[s.SessionDescriptionHandlerObserver=28]="SessionDescriptionHandlerObserver",s[s.Subscription=29]="Subscription",s[s.Transport=30]="Transport",s[s.UA=31]="UA",s[s.URI=32]="URI",(o=t.UAStatus||(t.UAStatus={}))[o.STATUS_INIT=0]="STATUS_INIT",o[o.STATUS_STARTING=1]="STATUS_STARTING",o[o.STATUS_READY=2]="STATUS_READY",o[o.STATUS_USER_CLOSED=3]="STATUS_USER_CLOSED",o[o.STATUS_NOT_READY=4]="STATUS_NOT_READY"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=r(80),a=r(11),c=r(15);(s=t.Utils||(t.Utils={})).defer=function(){var r={};return r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),r},s.reducePromises=function(e,t){return e.reduce(function(e,t){return e=e.then(t)},Promise.resolve(t))},s.str_utf8_length=function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},s.generateFakeSDP=function(e){if(e){var t=e.indexOf("o="),r=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,r)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},s.isDecimal=function(e){var t=parseInt(e,10);return!isNaN(t)&&parseFloat(e)===t},s.createRandomToken=function(e,t){void 0===t&&(t=32);for(var r="",i=0;i<e;i++){r+=Math.floor(Math.random()*t).toString(t)}return r},s.newTag=function(){return s.createRandomToken(10)},s.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(16*Math.random());return("x"===e?t:t%4+8).toString(16)})},s.normalizeTarget=function(e,t){if(e){if(e instanceof c.URI)return e;if("string"!=typeof e)return;var r=e.split("@"),i=void 0,n=void 0;switch(r.length){case 1:if(!t)return;i=e,n=t;break;case 2:i=r[0],n=r[1];break;default:i=r.slice(0,r.length-1).join("@"),n=r[r.length-1]}return i=i.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(i)&&(i=i.replace(/[\-\.\(\)]/g,"")),e=o.C.SIP+":"+s.escapeUser(i)+"@"+n,a.Grammar.URIParse(e)}},s.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},s.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i=r.length,n="",s=0;s<i;s++)0!==s&&(n+="-"),n+=r[s].charAt(0).toUpperCase()+r[s].substring(1);return t[n]&&(n=t[n]),n},s.sipErrorCause=function(e){for(var t in o.C.SIP_ERROR_CAUSES)if(-1!==o.C.SIP_ERROR_CAUSES[t].indexOf(e))return o.C.causes[t];return o.C.causes.SIP_FAILURE_CODE},s.getReasonPhrase=function(e,t){return t||o.C.REASON_PHRASE[e]||""},s.getReasonHeaderValue=function(e,t){return"SIP;cause="+e+';text="'+(t=s.getReasonPhrase(e,t))+'"'},s.getCancelReason=function(e,t){if(e&&e<200||699<e)throw new TypeError("Invalid statusCode: "+e);if(e)return s.getReasonHeaderValue(e,t)},s.buildStatusLine=function(e,t){if(!e||e<100||699<e)throw new TypeError("Invalid statusCode: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason: "+t);return"SIP/2.0 "+e+" "+(t=s.getReasonPhrase(e,t))+"\r\n"},s.fromBodyObj=function(e){var t=e.body,r=e.contentType;return{contentDisposition:"application/sdp"===r?"session":"render",contentType:r,content:t}},s.toBodyObj=function(e){return{body:e.content,contentType:e.contentType}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=r(1),d=r(2),y=r(82);!function(e){var t,r=(t=d.Exception,T.__extends(i,t),i);function i(){return t.call(this,"The session description handler has closed.")||this}e.ClosedSessionDescriptionHandlerError=r;var n,s=(n=d.Exception,T.__extends(o,n),o);function o(){return n.call(this,"The session has terminated.")||this}e.TerminatedSessionError=s;var a,c=(a=d.Exception,T.__extends(u,a),u);function u(e){return a.call(this,e||"Unsupported session description content type.")||this}e.UnsupportedSessionDescriptionContentTypeError=c}(t.Exceptions||(t.Exceptions={}));var n,E=(n=d.Exception,T.__extends(i,n),i);function i(e,t,r){var i=n.call(this,r)||this;return i.code=e,i.name=t,i.message=r,i}!function(e){var i,t=(i=E,T.__extends(r,i),r);function r(e,t){var r=i.call(this,1,"CONFIGURATION_ERROR",t?"Invalid value "+JSON.stringify(t)+" for parameter '"+e+"'":"Missing parameter: "+e)||this;return r.type=y.TypeStrings.ConfigurationError,r.parameter=e,r.value=t,r}e.ConfigurationError=t;var n,s=(n=E,T.__extends(o,n),o);function o(e){var t=n.call(this,2,"INVALID_STATE_ERROR","Invalid status: "+e)||this;return t.type=y.TypeStrings.InvalidStateError,t.status=e,t}e.InvalidStateError=s;var a,c=(a=E,T.__extends(u,a),u);function u(e){var t=a.call(this,3,"NOT_SUPPORTED_ERROR",e)||this;return t.type=y.TypeStrings.NotSupportedError,t}e.NotSupportedError=c;var d,p=(d=E,T.__extends(l,d),l);function l(e){var t=d.call(this,5,"RENEGOTIATION_ERROR",e)||this;return t.type=y.TypeStrings.RenegotiationError,t}e.RenegotiationError=p;var h,g=(h=E,T.__extends(f,h),f);function f(e,t,r){var i=h.call(this,6,"METHOD_PARAMETER_ERROR",r?"Invalid value "+JSON.stringify(r)+" for parameter '"+t+"'":"Missing parameter: "+t)||this;return i.type=y.TypeStrings.MethodParameterError,i.method=e,i.parameter=t,i.value=r,i}e.MethodParameterError=g;var v,m=(v=E,T.__extends(S,v),S);function S(e,t,r){var i=v.call(this,8,"SESSION_DESCRIPTION_HANDLER_ERROR",r||"Error with Session Description Handler")||this;return i.type=y.TypeStrings.SessionDescriptionHandlerError,i.method=e,i.error=t,i}e.SessionDescriptionHandlerError=m}(t.Exceptions||(t.Exceptions={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),n=r(79),o=r(80),a=r(2),c=r(82),u=r(84),d=r(83),p=(s=n.ClientContext,i.__extends(l,s),l.prototype.publish=function(e){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.options.body=e,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this),this.sendPublishRequest()},l.prototype.unpublish=function(){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,void(this.pubRequestExpires=0)!==this.pubRequestEtag&&this.sendPublishRequest()},l.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},l.prototype.onRequestTimeout=function(){s.prototype.onRequestTimeout.call(this),this.emit("unpublished",void 0,o.C.causes.REQUEST_TIMEOUT)},l.prototype.onTransportError=function(){s.prototype.onTransportError.call(this),this.emit("unpublished",void 0,o.C.causes.CONNECTION_ERROR)},l.prototype.receiveResponse=function(e){var t=this,r=e.statusCode||0,i=d.Utils.getReasonPhrase(r);switch(!0){case/^1[0-9]{2}$/.test(r.toString()):this.emit("progress",e,i);break;case/^2[0-9]{2}$/.test(r.toString()):if(e.hasHeader("SIP-ETag")?this.pubRequestEtag=e.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),e.hasHeader("Expires")){var n=Number(e.getHeader("Expires"));"number"==typeof n&&0<=n&&n<=this.pubRequestExpires?this.pubRequestExpires=n:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")}else this.logger.warn("Expires header missing in a 200-class response to PUBLISH");0!==this.pubRequestExpires?(this.publishRefreshTimer=setTimeout(function(){return t.refreshRequest()},900*this.pubRequestExpires),this.emit("published",e,i)):this.emit("unpublished",e,i);break;case/^412$/.test(r.toString()):void 0!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=void 0,this.emit("progress",e,i),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i));break;case/^423$/.test(r.toString()):if(0!==this.pubRequestExpires&&e.hasHeader("Min-Expires")){var s=Number(e.getHeader("Min-Expires"));"number"==typeof s||s>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=s,this.emit("progress",e,i),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i))}else this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i);break;default:this.pubRequestExpires=0,this.emit("failed",e,i),this.emit("unpublished",e,i)}0===this.pubRequestExpires&&(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestEtag=void 0)},l.prototype.send=function(){var t=this;return this.ua.userAgentCore.publish(this.request,{onAccept:function(e){return t.receiveResponse(e.message)},onProgress:function(e){return t.receiveResponse(e.message)},onRedirect:function(e){return t.receiveResponse(e.message)},onReject:function(e){return t.receiveResponse(e.message)},onTrying:function(e){return t.receiveResponse(e.message)}}),this},l.prototype.refreshRequest=function(){if(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),(this.pubRequestBody=void 0)===this.pubRequestEtag)throw new u.Exceptions.MethodParameterError("Publish","Body",void 0);if(0===this.pubRequestExpires)throw new u.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires);this.sendPublishRequest()},l.prototype.sendPublishRequest=function(){var e=Object.create(this.options||Object.prototype);e.extraHeaders=(this.options.extraHeaders||[]).slice(),e.extraHeaders.push("Event: "+this.event),e.extraHeaders.push("Expires: "+this.pubRequestExpires),void 0!==this.pubRequestEtag&&e.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag);var t=this.target instanceof a.URI?this.target:this.ua.normalizeTarget(this.target);if(!t)throw new Error("ruri undefined.");var r,i,n=this.options.params||{};void 0!==this.pubRequestBody&&(r={body:this.pubRequestBody,contentType:this.options.contentType}),r&&(i=d.Utils.fromBodyObj(r)),this.request=this.ua.userAgentCore.makeOutgoingRequestMessage(o.C.PUBLISH,t,n.fromUri?n.fromUri:this.ua.userAgentCore.configuration.aor,n.toUri?n.toUri:this.target,n,e.extraHeaders,i),this.send()},l);function l(e,t,r,i){void 0===i&&(i={});var n=this;if(i.extraHeaders=(i.extraHeaders||[]).slice(),i.contentType=i.contentType||"text/plain","number"!=typeof i.expires||i.expires%1!=0?i.expires=3600:i.expires=Number(i.expires),"boolean"!=typeof i.unpublishOnClose&&(i.unpublishOnClose=!0),null==t||""===t)throw new u.Exceptions.MethodParameterError("Publish","Target",t);if(void 0===(t=e.normalizeTarget(t)))throw new u.Exceptions.MethodParameterError("Publish","Target",t);if((n=s.call(this,e,o.C.PUBLISH,t,i)||this).type=c.TypeStrings.PublishContext,n.options=i,n.target=t,null==r||""===r)throw new u.Exceptions.MethodParameterError("Publish","Event",r);return n.event=r,n.logger=e.getLogger("sip.publish"),n.pubRequestExpires=n.options.expires,n}t.PublishContext=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(1),n=r(79),o=r(80),u=r(2),a=r(82),c=r(84),d=r(87),p=(s=n.ClientContext,i.__extends(l,s),l.prototype.refer=function(r){var i=this;void 0===r&&(r={});var e=(this.extraHeaders||[]).slice();return r.extraHeaders&&e.concat(r.extraHeaders),this.applicant.sendRequest(o.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(e){var t=e&&e.statusCode?e.statusCode.toString():"";/^1[0-9]{2}$/.test(t)?i.emit("referRequestProgress",i):/^2[0-9]{2}$/.test(t)?i.emit("referRequestAccepted",i):/^[4-6][0-9]{2}$/.test(t)&&i.emit("referRequestRejected",i),r.receiveResponse&&r.receiveResponse(e)}}),this},l.prototype.receiveNotify=function(e){var t=e.message.hasHeader("Content-Type")?e.message.getHeader("Content-Type"):void 0;if(t&&-1!==t.search(/^message\/sipfrag/)){var r=u.Grammar.parse(e.message.body,"sipfrag");if(-1===r)return void e.reject({statusCode:489,reasonPhrase:"Bad Event"});switch(!0){case/^1[0-9]{2}$/.test(r.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(r.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return e.accept(),void this.emit("notify",e.message)}e.reject({statusCode:489,reasonPhrase:"Bad Event"})},l.prototype.initReferTo=function(e){var t;if("string"==typeof e){var r=u.Grammar.parse(e,"Refer_To");t=r&&r.uri?r.uri:e;var i=this.ua.normalizeTarget(e);if(!i)throw new TypeError("Invalid target: "+e);t=i}else{if(!e.session)throw new Error("Session undefined.");var n=e.remoteIdentity.friendlyName,s=e.session.remoteTarget.toString(),o=e.session.callId,a=e.session.remoteTag,c=e.session.localTag;t='"'+n+'" <'+s+"?Replaces="+encodeURIComponent(o+";to-tag="+a+";from-tag="+c)+">"}return t},l);function l(e,t,r,i){void 0===i&&(i={});var n=this;if(void 0===e||void 0===t||void 0===r)throw new TypeError("Not enough arguments");return(n=s.call(this,e,o.C.REFER,t.remoteIdentity.uri.toString(),i)||this).type=a.TypeStrings.ReferClientContext,n.options=i,n.extraHeaders=(n.options.extraHeaders||[]).slice(),n.applicant=t,n.target=n.initReferTo(r),n.ua&&n.extraHeaders.push("Referred-By: <"+n.ua.configuration.uri+">"),n.extraHeaders.push("Contact: "+t.contact),n.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),n.extraHeaders.push("Refer-To: "+n.target),n.errorListener=n.onTransportError.bind(n),e.transport&&e.transport.on("transportError",n.errorListener),n}t.ReferClientContext=p;var h,g=(h=d.ServerContext,i.__extends(f,h),f.prototype.progress=function(){if(this.status!==a.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new c.Exceptions.InvalidStateError(this.status);this.incomingRequest.trying()},f.prototype.reject=function(e){if(void 0===e&&(e={}),this.status===a.SessionStatus.STATUS_TERMINATED)throw new c.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=a.SessionStatus.STATUS_TERMINATED,h.prototype.reject.call(this,e),this.emit("referRequestRejected",this)},f.prototype.accept=function(e,t){var i=this;if(void 0===e&&(e={}),this.status!==a.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new c.Exceptions.InvalidStateError(this.status);if(this.status=a.SessionStatus.STATUS_ANSWERED,this.incomingRequest.accept({statusCode:202,reasonPhrase:"Accepted"}),this.emit("referRequestAccepted",this),e.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var r=this.referTo.uri;if(!r.scheme||!r.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var n=e.inviteOptions||{},s=(n.extraHeaders||[]).slice();if(this.replaces&&s.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&s.push("Referred-By: "+this.referredBy),n.extraHeaders=s,r.clearHeaders(),this.targetSession=this.ua.invite(r.toString(),n,t),this.emit("referInviteSent",this),this.targetSession){this.targetSession.once("progress",function(e){var t=e.statusCode||100,r=e.reasonPhrase;i.sendNotify(("SIP/2.0 "+t+" "+r).trim()),i.emit("referProgress",i),i.referredSession&&i.referredSession.emit("referProgress",i)}),this.targetSession.once("accepted",function(){i.logger.log("Successfully followed the refer"),i.sendNotify("SIP/2.0 200 OK"),i.emit("referAccepted",i),i.referredSession&&i.referredSession.emit("referAccepted",i)});var o=function(e){if(i.status!==a.SessionStatus.STATUS_TERMINATED){if(i.logger.log("Refer was not successful. Resuming session"),e&&429===e.statusCode)return i.logger.log("Alerting referrer that identity is required."),void i.sendNotify("SIP/2.0 429 Provide Referrer Identity");i.sendNotify("SIP/2.0 603 Declined"),i.status=a.SessionStatus.STATUS_TERMINATED,i.emit("referRejected",i),i.referredSession&&i.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o),this.targetSession.once("failed",o)}}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)},f.prototype.sendNotify=function(e){if(this.status!==a.SessionStatus.STATUS_ANSWERED)throw new c.Exceptions.InvalidStateError(this.status);if(-1===u.Grammar.parse(e,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var t={contentDisposition:"render",contentType:"message/sipfrag",content:e};if(this.session)this.session.notify(void 0,{extraHeaders:["Event: refer","Subscription-State: terminated"],body:t});else{var r=this.ua.userAgentCore.makeOutgoingRequestMessage(o.C.NOTIFY,this.remoteTarget,this.fromUri,this.toUri,{cseq:this.cseq+=1,callId:this.callId,fromTag:this.fromTag,toTag:this.toTag,routeSet:this.routeSet},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],t),i=this.ua.transport;if(!i)throw new Error("Transport undefined.");var n={loggerFactory:this.ua.getLoggerFactory()};new u.NonInviteClientTransaction(r,i,n)}},f.prototype.on=function(e,t){return h.prototype.on.call(this,e,t)},f);function f(e,t,r){var i=h.call(this,e,t)||this;return i.session=r,i.type=a.TypeStrings.ReferServerContext,i.ua=e,i.status=a.SessionStatus.STATUS_INVITE_RECEIVED,i.fromTag=i.request.fromTag,i.id=i.request.callId+i.fromTag,i.contact=i.ua.contact.toString(),i.logger=e.getLogger("sip.referservercontext",i.id),i.cseq=Math.floor(1e4*Math.random()),i.callId=i.request.callId,i.fromUri=i.request.to.uri,i.fromTag=i.request.to.parameters.tag,i.remoteTarget=i.request.headers.Contact[0].parsed.uri,i.toUri=i.request.from.uri,i.toTag=i.request.fromTag,i.routeSet=i.request.getHeaders("record-route"),i.request.hasHeader("refer-to")?(i.referTo=i.request.parseHeader("refer-to"),i.referredSession=i.ua.findSession(i.request),i.request.hasHeader("referred-by")&&(i.referredBy=i.request.getHeader("referred-by")),i.referTo.uri.hasHeader("replaces")&&(i.replaces=i.referTo.uri.getHeader("replaces")),i.errorListener=i.onTransportError.bind(i),e.transport&&e.transport.on("transportError",i.errorListener),i.status=a.SessionStatus.STATUS_WAITING_FOR_ANSWER):(i.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),i.reject()),i}t.ReferServerContext=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(31),o=r(80),l=r(2),a=r(82),h=r(83),c=(i=s.EventEmitter,n.__extends(u,i),u.initializer=function(e,t,r){var i=r.message;if(e.type=a.TypeStrings.ServerContext,e.ua=t,e.logger=t.getLogger("sip.servercontext"),(e.request=i).body&&(e.body=i.body),i.hasHeader("Content-Type")&&(e.contentType=i.getHeader("Content-Type")),e.method=i.method,e.localIdentity=i.to,e.remoteIdentity=i.from,i.hasHeader("P-Asserted-Identity")){var n=i.getHeader("P-Asserted-Identity");n&&(e.assertedIdentity=l.Grammar.nameAddrHeaderParse(n))}},u.prototype.progress=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||180,e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},u.prototype.accept=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||200,e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},u.prototype.reject=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||480,e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},u.prototype.reply=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||100,i=e.minCode||100,n=e.maxCode||699,s=h.Utils.getReasonPhrase(r,e.reasonPhrase),o=e.extraHeaders||[],a=e.body?l.fromBodyLegacy(e.body):void 0,c=e.events||[];if(r<i||n<r)throw new TypeError("Invalid statusCode: "+r);var u,d={statusCode:r,reasonPhrase:s,extraHeaders:o,body:a},p=r.toString();switch(!0){case/^100$/.test(p):u=this.incomingRequest.trying(d).message;break;case/^1[0-9]{2}$/.test(p):u=this.incomingRequest.progress(d).message;break;case/^2[0-9]{2}$/.test(p):u=this.incomingRequest.accept(d).message;break;case/^3[0-9]{2}$/.test(p):u=this.incomingRequest.redirect([],d).message;break;case/^[4-6][0-9]{2}$/.test(p):u=this.incomingRequest.reject(d).message;break;default:throw new Error("Invalid status code "+r)}return c.forEach(function(e){t.emit(e,u,s)}),this},u.prototype.onRequestTimeout=function(){this.emit("failed",void 0,o.C.causes.REQUEST_TIMEOUT)},u.prototype.onTransportError=function(){this.emit("failed",void 0,o.C.causes.CONNECTION_ERROR)},u);function u(e,t){var r=i.call(this)||this;return r.incomingRequest=t,r.data={},u.initializer(r,e,t),r}t.ServerContext=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(79),o=r(80),a=r(2),c=r(82),u=r(84),d=r(83);function p(e){var t={expires:600,extraContactHeaderParams:[],instanceId:void 0,params:{},regId:void 0,registrar:void 0},r={mandatory:{},optional:{expires:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<=t)return t}},extraContactHeaderParams:function(e){if(e instanceof Array)return e.filter(function(e){return"string"==typeof e})},instanceId:function(e){if("string"==typeof e)return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===a.Grammar.parse(e,"uuid")?void 0:e},params:function(e){if("object"==typeof e)return e},regId:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<=t)return t}},registrar:function(e){if("string"==typeof e){/^sip:/i.test(e)||(e=o.C.SIP+":"+e);var t=a.Grammar.URIParse(e);return!t||t.user?void 0:t}}}};for(var i in r.mandatory){if(!e.hasOwnProperty(i))throw new u.Exceptions.ConfigurationError(i);var n=e[i];if(void 0===(s=r.mandatory[i](n)))throw new u.Exceptions.ConfigurationError(i,n);t[i]=s}for(var i in r.optional)if(e.hasOwnProperty(i)){var s;if((n=e[i])instanceof Array&&0===n.length)continue;if(null===n||""===n||void 0===n||"number"==typeof n&&isNaN(n))continue;if(void 0===(s=r.optional[i](n)))throw new u.Exceptions.ConfigurationError(i,n);t[i]=s}return t}var l,s=(l=n.ClientContext,i.__extends(h,l),h.prototype.register=function(e){var s=this;void 0===e&&(e={}),this.options=i.__assign(i.__assign({},this.options),e);var t=(this.options.extraHeaders||[]).slice();t.push("Contact: "+this.generateContactHeader(this.expires)),t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(e){if(e.cseq===s.request.cseq){void 0!==s.registrationTimer&&(clearTimeout(s.registrationTimer),s.registrationTimer=void 0);var t=(e.statusCode||0).toString();switch(!0){case/^1[0-9]{2}$/.test(t):s.emit("progress",e);break;case/^2[0-9]{2}$/.test(t):s.emit("accepted",e);var r=void 0;e.hasHeader("expires")&&(r=Number(e.getHeader("expires"))),void 0!==s.registrationExpiredTimer&&(clearTimeout(s.registrationExpiredTimer),s.registrationExpiredTimer=void 0);var i=e.getHeaders("contact").length;if(!i){s.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(var n=void 0;i--;){if((n=e.parseHeader("contact",i)).uri.user===s.ua.contact.uri.user){r=n.getParam("expires");break}n=void 0}if(!n){s.logger.warn("no Contact header pointing to us, response ignored");break}void 0===r&&(r=s.expires),s.registrationTimer=setTimeout(function(){s.registrationTimer=void 0,s.register(s.options)},1e3*r-3e3),s.registrationExpiredTimer=setTimeout(function(){s.logger.warn("registration expired"),s.registered&&s.unregistered(void 0,o.C.causes.EXPIRES)},1e3*r),n.hasParam("temp-gruu")&&(s.ua.contact.tempGruu=a.Grammar.URIParse(n.getParam("temp-gruu").replace(/"/g,""))),n.hasParam("pub-gruu")&&(s.ua.contact.pubGruu=a.Grammar.URIParse(n.getParam("pub-gruu").replace(/"/g,""))),s.registered=!0,s.emit("registered",e||void 0);break;case/^423$/.test(t):e.hasHeader("min-expires")?(s.expires=Number(e.getHeader("min-expires")),s.register(s.options)):(s.logger.warn("423 response received for REGISTER without Min-Expires"),s.registrationFailure(e,o.C.causes.SIP_FAILURE_CODE));break;default:s.registrationFailure(e,d.Utils.sipErrorCause(e.statusCode||0))}}},this.onRequestTimeout=function(){s.registrationFailure(void 0,o.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){s.registrationFailure(void 0,o.C.causes.CONNECTION_ERROR)},this.request.cseq++,this.request.setHeader("cseq",this.request.cseq+" REGISTER"),this.request.extraHeaders=t,this.send()},h.prototype.close=function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registeredBefore=this.registered,this.registered&&this.unregister(e)},h.prototype.unregister=function(e){var r=this;void 0===e&&(e={}),this.registered||e.all||this.logger.warn("Already unregistered, but sending an unregister anyways.");var t=(e.extraHeaders||[]).slice();this.registered=!1,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),e.all?(t.push("Contact: *"),t.push("Expires: 0")):t.push("Contact: "+this.generateContactHeader(0)),this.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(t):r.emit("progress",e);break;case/^2[0-9]{2}$/.test(t):r.emit("accepted",e),void 0!==r.registrationExpiredTimer&&(clearTimeout(r.registrationExpiredTimer),r.registrationExpiredTimer=void 0),r.unregistered(e);break;default:r.unregistered(e,d.Utils.sipErrorCause(e.statusCode||0))}},this.onRequestTimeout=function(){},this.request.cseq++,this.request.setHeader("cseq",this.request.cseq+" REGISTER"),this.request.extraHeaders=t,this.send()},h.prototype.unregistered=function(e,t){this.registered=!1,this.emit("unregistered",e||void 0,t||void 0)},h.prototype.send=function(){var t=this;return this.ua.userAgentCore.register(this.request,{onAccept:function(e){return t.receiveResponse(e.message)},onProgress:function(e){return t.receiveResponse(e.message)},onRedirect:function(e){return t.receiveResponse(e.message)},onReject:function(e){return t.receiveResponse(e.message)},onTrying:function(e){return t.receiveResponse(e.message)}}),this},h.prototype.registrationFailure=function(e,t){this.emit("failed",e||void 0,t||void 0)},h.prototype.onTransportDisconnected=function(){this.registeredBefore=this.registered,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),void 0!==this.registrationExpiredTimer&&(clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=void 0),this.registered&&this.unregistered(void 0,o.C.causes.CONNECTION_ERROR)},h.prototype.generateContactHeader=function(e){void 0===e&&(e=0);var t=this.contact;return this.options.regId&&this.options.instanceId&&(t+=";reg-id="+this.options.regId,t+=';+sip.instance="<urn:uuid:'+this.options.instanceId+'>"'),this.options.extraContactHeaderParams&&this.options.extraContactHeaderParams.forEach(function(e){t+=";"+e}),t+=";expires="+e},h);function h(e,t){void 0===t&&(t={});var r=this,i=p(t);if(i.regId&&!i.instanceId?i.instanceId=d.Utils.newUUID():!i.regId&&i.instanceId&&(i.regId=1),i.params.toUri=i.params.toUri||e.configuration.uri,i.params.toDisplayName=i.params.toDisplayName||e.configuration.displayName,i.params.callId=i.params.callId||d.Utils.createRandomToken(22),i.params.cseq=i.params.cseq||Math.floor(1e4*Math.random()),!i.registrar){var n={};"object"==typeof e.configuration.uri?(n=e.configuration.uri.clone()).user=void 0:n=e.configuration.uri,i.registrar=n}for(var s in(r=l.call(this,e,o.C.REGISTER,i.registrar,i)||this).type=c.TypeStrings.RegisterContext,r.options=i,r.logger=e.getLogger("sip.registercontext"),r.logger.log("configuration parameters for RegisterContext after validation:"),i)i.hasOwnProperty(s)&&r.logger.log("· "+s+": "+JSON.stringify(i[s]));return r.expires=i.expires,r.contact=e.contact.toString(),r.registered=!1,e.transport.on("disconnected",function(){return r.onTransportDisconnected()}),r}t.RegisterContext=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(31),u=r(79),v=r(80),m=r(2),S=r(82),T=r(84),c=r(86),a=r(87),d=r(90),p=r(91),l=r(83),o=(i=s.EventEmitter,n.__extends(h,i),h.prototype.dtmf=function(e,r){var i=this;if(void 0===r&&(r={}),this.status!==S.SessionStatus.STATUS_CONFIRMED&&this.status!==S.SessionStatus.STATUS_WAITING_FOR_ACK)throw new T.Exceptions.InvalidStateError(this.status);p.DTMFValidator.validate(e);var n=function(){if(i.status!==S.SessionStatus.STATUS_TERMINATED&&i.tones&&0!==i.tones.length){var e,t=i.tones.shift();e=","===t.tone?2e3:(t.on("failed",function(){i.tones=void 0}),t.send(r),t.duration+t.interToneGap),setTimeout(n,e)}else i.tones=void 0};e=e.toString();var t=this.ua.configuration.dtmfType;if(this.sessionDescriptionHandler&&t===v.C.dtmfType.RTP&&(this.sessionDescriptionHandler.sendDtmf(e,r)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),t=v.C.dtmfType.INFO)),t===v.C.dtmfType.INFO){for(var s=[],o=e.split("");0<o.length;)s.push(new d.DTMF(this,o.shift(),r));if(this.tones)return this.tones=this.tones.concat(s),this;this.tones=s,n()}return this},h.prototype.bye=function(e){if(void 0===e&&(e={}),this.status===S.SessionStatus.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;this.logger.log("terminating Session");var t=e.statusCode;if(t&&(t<200||700<=t))throw new TypeError("Invalid statusCode: "+t);return e.receiveResponse=function(){},this.sendRequest(v.C.BYE,e).terminated()},h.prototype.refer=function(e,t){if(void 0===t&&(t={}),this.status!==S.SessionStatus.STATUS_CONFIRMED)throw new T.Exceptions.InvalidStateError(this.status);return this.referContext=new c.ReferClientContext(this.ua,this,e,t),this.emit("referRequested",this.referContext),this.referContext.refer(t),this.referContext},h.prototype.sendRequest=function(e,t){if(void 0===t&&(t={}),!this.session)throw new Error("Session undefined.");var r;t.body&&(t.body=l.Utils.fromBodyObj(t.body));var i,n=t.receiveResponse;n&&(r={onAccept:function(e){return n(e.message)},onProgress:function(e){return n(e.message)},onRedirect:function(e){return n(e.message)},onReject:function(e){return n(e.message)},onTrying:function(e){return n(e.message)}});var s=t;switch(e){case v.C.BYE:i=this.session.bye(r,s);break;case v.C.INVITE:i=this.session.invite(r,s);break;case v.C.REFER:i=this.session.refer(r,s);break;default:throw new Error("Unexpected "+e+". Method not implemented by user agent core.")}return this.emit(e.toLowerCase(),i.message),this},h.prototype.close=function(){if(this.status===S.SessionStatus.STATUS_TERMINATED)return this;for(var e in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)this.timers[e]&&clearTimeout(this.timers[e]);return this.status=S.SessionStatus.STATUS_TERMINATED,this.ua.transport&&this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},h.prototype.hold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==S.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==S.SessionStatus.STATUS_CONFIRMED)throw new T.Exceptions.InvalidStateError(this.status);this.localHold?this.logger.log("Session is already on hold, cannot put it on hold again"):(e.modifiers=t,this.sessionDescriptionHandler&&e.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.localHold=!0,this.sendReinvite(e))},h.prototype.unhold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==S.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==S.SessionStatus.STATUS_CONFIRMED)throw new T.Exceptions.InvalidStateError(this.status);this.localHold?(e.modifiers=t,this.localHold=!1,this.sendReinvite(e)):this.logger.log("Session is not on hold, cannot unhold it")},h.prototype.reinvite=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=[]),e.modifiers=t,this.sendReinvite(e)},h.prototype.terminate=function(e){return this},h.prototype.onTransportError=function(){this.status!==S.SessionStatus.STATUS_CONFIRMED&&this.status!==S.SessionStatus.STATUS_TERMINATED&&this.failed(void 0,v.C.causes.CONNECTION_ERROR)},h.prototype.onRequestTimeout=function(){this.status===S.SessionStatus.STATUS_CONFIRMED?this.terminated(void 0,v.C.causes.REQUEST_TIMEOUT):this.status!==S.SessionStatus.STATUS_TERMINATED&&(this.failed(void 0,v.C.causes.REQUEST_TIMEOUT),this.terminated(void 0,v.C.causes.REQUEST_TIMEOUT))},h.prototype.onDialogError=function(e){this.status===S.SessionStatus.STATUS_CONFIRMED?this.terminated(e,v.C.causes.DIALOG_ERROR):this.status!==S.SessionStatus.STATUS_TERMINATED&&(this.failed(e,v.C.causes.DIALOG_ERROR),this.terminated(e,v.C.causes.DIALOG_ERROR))},h.prototype.on=function(e,t){return i.prototype.on.call(this,e,t)},h.prototype.onAck=function(t){function e(){clearTimeout(r.timers.ackTimer),clearTimeout(r.timers.invite2xxTimer),r.status=S.SessionStatus.STATUS_CONFIRMED;var e=t.message.getHeader("Content-Disposition");e&&"render"===e.type&&(r.renderbody=t.message.body,r.rendertype=t.message.getHeader("Content-Type")),r.emit("confirmed",t.message)}var r=this;this.status===S.SessionStatus.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler&&this.sessionDescriptionHandler.hasDescription(t.message.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(e){throw r.logger.warn(e),r.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),r.failed(t.message,v.C.causes.BAD_MEDIA_DESCRIPTION),r.terminated(t.message,v.C.causes.BAD_MEDIA_DESCRIPTION),e}).then(function(){return e()})):e())},h.prototype.receiveRequest=function(e){switch(e.message.method){case v.C.BYE:e.accept(),this.status===S.SessionStatus.STATUS_CONFIRMED&&(this.emit("bye",e.message),this.terminated(e.message,v.C.BYE));break;case v.C.INVITE:this.status===S.SessionStatus.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(e));break;case v.C.INFO:if(this.status===S.SessionStatus.STATUS_CONFIRMED||this.status===S.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(e.message);var t=e.message.getHeader("content-type");if(t)if(t.match(/^application\/dtmf-relay/i)){if(e.message.body){var r=e.message.body.split("\r\n",2);if(2===r.length){var i=void 0,n=void 0,s=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/;s.test(r[0])&&(i=r[0].replace(s,"$2"));var o=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;o.test(r[1])&&(n=parseInt(r[1].replace(o,"$2"),10)),i&&n&&new d.DTMF(this,i,{duration:n}).init_incoming(e)}}}else e.reject({statusCode:415,extraHeaders:["Accept: application/dtmf-relay"]})}break;case v.C.REFER:if(this.status===S.SessionStatus.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new c.ReferServerContext(this.ua,e,this.session),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var a={followRefer:!0};this.passedOptions&&(a.inviteOptions=this.passedOptions),this.referContext.accept(a,this.modifiers)}break;case v.C.NOTIFY:if(this.referContext&&this.referContext.type===S.TypeStrings.ReferClientContext&&e.message.hasHeader("event")&&/^refer(;.*)?$/.test(e.message.getHeader("event")))return void this.referContext.receiveNotify(e);e.accept(),this.emit("notify",e.message)}},h.prototype.receiveReinvite=function(r){var e,i=this;if(this.emit("reinvite",this,r.message),r.message.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=m.Grammar.nameAddrHeaderParse(r.message.getHeader("P-Asserted-Identity"))),this.sessionDescriptionHandler){if("0"!==r.message.getHeader("Content-Length")||r.message.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(r.message.getHeader("Content-Type")||""))return r.reject({statusCode:415}),void this.emit("reinviteFailed",this);e=this.sessionDescriptionHandler.setDescription(r.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else e=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);e.catch(function(e){var t;throw t=e.type===S.TypeStrings.SessionDescriptionHandlerError?500:(e.type===S.TypeStrings.RenegotiationError?(i.emit("renegotiationError",e),i.logger.warn(e.toString())):i.logger.error(e),488),r.reject({statusCode:t}),i.emit("reinviteFailed",i),e}).then(function(e){var t=["Contact: "+i.contact];r.accept({statusCode:200,extraHeaders:t,body:l.Utils.fromBodyObj(e)}),i.status=S.SessionStatus.STATUS_WAITING_FOR_ACK,i.emit("reinviteAccepted",i)})}else this.logger.warn("No SessionDescriptionHandler to reinvite")},h.prototype.sendReinvite=function(e){var i=this;if(void 0===e&&(e={}),this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else if(this.sessionDescriptionHandler){this.pendingReinvite=!0,e.modifiers=e.modifiers||[];var n=(e.extraHeaders||[]).slice();n.push("Contact: "+this.contact),n.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){if(!i.session)throw new Error("Session undefined.");var t={onAccept:function(e){if(i.status!==S.SessionStatus.STATUS_TERMINATED)if(i.pendingReinvite){if(i.status=S.SessionStatus.STATUS_CONFIRMED,i.emit("ack",e.ack()),i.pendingReinvite=!1,clearTimeout(i.timers.invite2xxTimer),!i.sessionDescriptionHandler||!i.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||""))return i.logger.error("2XX response received to re-invite but did not have a description"),i.emit("reinviteFailed",i),void i.emit("renegotiationError",new T.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));i.sessionDescriptionHandler.setDescription(e.message.body,i.sessionDescriptionHandlerOptions,i.modifiers).catch(function(e){throw i.logger.error("Could not set the description in 2XX response"),i.logger.error(e),i.emit("reinviteFailed",i),i.emit("renegotiationError",e),i.sendRequest(v.C.BYE,{extraHeaders:["Reason: "+l.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),i.terminated(void 0,v.C.causes.INCOMPATIBLE_SDP),e}).then(function(){i.emit("reinviteAccepted",i)})}else i.logger.error("Received reinvite response, but have no pending reinvite");else i.logger.error("Received reinvite response, but in STATUS_TERMINATED")},onProgress:function(e){},onRedirect:function(e){i.pendingReinvite=!1,i.logger.log("Received a non 1XX or 2XX response to a re-invite"),i.emit("reinviteFailed",i),i.emit("renegotiationError",new T.Exceptions.RenegotiationError("Invalid response to a re-invite"))},onReject:function(e){i.pendingReinvite=!1,i.logger.log("Received a non 1XX or 2XX response to a re-invite"),i.emit("reinviteFailed",i),i.emit("renegotiationError",new T.Exceptions.RenegotiationError("Invalid response to a re-invite"))},onTrying:function(e){}},r={extraHeaders:n,body:l.Utils.fromBodyObj(e)};i.session.invite(t,r)}).catch(function(e){if(e.type===S.TypeStrings.RenegotiationError)throw i.pendingReinvite=!1,i.emit("renegotiationError",e),i.logger.warn("Renegotiation Error"),i.logger.warn(e.toString()),e;throw i.logger.error("sessionDescriptionHandler error"),i.logger.error(e),e})}else this.logger.warn("No SessionDescriptionHandler, can't reinvite..")},h.prototype.failed=function(e,t){return this.status===S.SessionStatus.STATUS_TERMINATED||this.emit("failed",e,t),this},h.prototype.rejected=function(e,t){return this.emit("rejected",e,t),this},h.prototype.canceled=function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},h.prototype.accepted=function(e,t){return e instanceof String||(t=l.Utils.getReasonPhrase(e&&e.statusCode||0,t)),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",e,t),this},h.prototype.terminated=function(e,t){return this.status===S.SessionStatus.STATUS_TERMINATED||(this.endTime=new Date,this.close(),this.emit("terminated",e,t)),this},h.prototype.connecting=function(e){return this.emit("connecting",{request:e}),this},h.C=S.SessionStatus,h);function h(e){var t=i.call(this)||this;if(t.data={},t.type=S.TypeStrings.Session,!e)throw new T.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function");return t.status=h.C.STATUS_NULL,t.pendingReinvite=!1,t.sessionDescriptionHandlerFactory=e,t.hasOffer=!1,t.hasAnswer=!1,t.timers={ackTimer:void 0,expiresTimer:void 0,invite2xxTimer:void 0,userNoAnswerTimer:void 0,rel1xxTimer:void 0,prackTimer:void 0},t.startTime=void 0,t.endTime=void 0,t.tones=void 0,t.localHold=!1,t.earlySdp=void 0,t.rel100=v.C.supported.UNSUPPORTED,t}t.Session=o;var g,f=(g=o,n.__extends(y,g),Object.defineProperty(y.prototype,"autoSendAnInitialProvisionalResponse",{get:function(){return this.rel100!==v.C.supported.REQUIRED},enumerable:!0,configurable:!0}),y.prototype.reply=function(e){return void 0===e&&(e={}),this},y.prototype.reject=function(e){var t=this;if(void 0===e&&(e={}),this.status===S.SessionStatus.STATUS_TERMINATED)throw new T.Exceptions.InvalidStateError(this.status);this.logger.log("rejecting RTCSession");var r=e.statusCode||480,i=l.Utils.getReasonPhrase(r,e.reasonPhrase),n=e.extraHeaders||[];if(r<300||699<r)throw new TypeError("Invalid statusCode: "+r);var s=e.body?m.fromBodyLegacy(e.body):void 0,o=r<400?this.incomingRequest.redirect([],{statusCode:r,reasonPhrase:i,extraHeaders:n,body:s}):this.incomingRequest.reject({statusCode:r,reasonPhrase:i,extraHeaders:n,body:s});return["rejected","failed"].forEach(function(e){t.emit(e,o.message,i)}),this.terminated()},y.prototype.accept=function(e){var i=this;return void 0===e&&(e={}),this._accept(e).then(function(e){var t=e.message,r=e.session;r.delegate={onAck:function(e){return i.onAck(e)},onAckTimeout:function(){return i.onAckTimeout()},onBye:function(e){return i.receiveRequest(e)},onInfo:function(e){return i.receiveRequest(e)},onInvite:function(e){return i.receiveRequest(e)},onNotify:function(e){return i.receiveRequest(e)},onPrack:function(e){return i.receiveRequest(e)},onRefer:function(e){return i.receiveRequest(e)}},i.session=r,i.status=S.SessionStatus.STATUS_WAITING_FOR_ACK,i.accepted(t,l.Utils.getReasonPhrase(200))}).catch(function(e){if(i.onContextError(e),!i._canceled)throw e}),this},y.prototype.progress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||180;if(r<100||199<r)throw new TypeError("Invalid statusCode: "+r);if(this.status===S.SessionStatus.STATUS_TERMINATED)return this.logger.warn("Unexpected call for progress while terminated, ignoring"),this;if(this.status===S.SessionStatus.STATUS_ANSWERED)return this.logger.warn("Unexpected call for progress while answered, ignoring"),this;if(this.status===S.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK)return this.logger.warn("Unexpected call for progress while answered (waiting for prack), ignoring"),this;if(this.status===S.SessionStatus.STATUS_WAITING_FOR_PRACK)return this.logger.warn("Unexpected call for progress while waiting for prack, ignoring"),this;if(100!==e.statusCode)return this.rel100===v.C.supported.REQUIRED||this.rel100===v.C.supported.SUPPORTED&&e.rel100||this.rel100===v.C.supported.SUPPORTED&&this.ua.configuration.rel100===v.C.supported.REQUIRED?this._reliableProgressWaitForPrack(e).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}):this._progress(e).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this;try{this.incomingRequest.trying()}catch(e){if(this.onContextError(e),!this._canceled)throw e}return this},y.prototype.terminate=function(e){var t=this;if(void 0===e&&(e={}),!this.session)return this.reject(e),this;switch(this.session.sessionState){case m.SessionState.Initial:case m.SessionState.Early:return this.reject(e),this;case m.SessionState.AckWait:return this.session.delegate={onAck:function(){t.sendRequest(v.C.BYE,e)},onAckTimeout:function(){t.sendRequest(v.C.BYE,e)}},this.emit("bye",this.request),this.terminated(),this;case m.SessionState.Confirmed:return this.bye(e),this;case m.SessionState.Terminated:default:return this}},y.prototype.onCancel=function(e){this.status!==S.SessionStatus.STATUS_WAITING_FOR_ANSWER&&this.status!==S.SessionStatus.STATUS_WAITING_FOR_PRACK&&this.status!==S.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==S.SessionStatus.STATUS_EARLY_MEDIA&&this.status!==S.SessionStatus.STATUS_ANSWERED||(this.status=S.SessionStatus.STATUS_CANCELED,this.incomingRequest.reject({statusCode:487}),this.canceled(),this.rejected(e,v.C.causes.CANCELED),this.failed(e,v.C.causes.CANCELED),this.terminated(e,v.C.causes.CANCELED))},y.prototype.receiveRequest=function(t){var r=this;switch(t.message.method){case v.C.PRACK:this.status===S.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===S.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(clearTimeout(this.timers.rel1xxTimer),clearTimeout(this.timers.prackTimer),t.accept(),this.status===S.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=S.SessionStatus.STATUS_EARLY_MEDIA,this.accept()),this.status=S.SessionStatus.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.message.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){clearTimeout(r.timers.rel1xxTimer),clearTimeout(r.timers.prackTimer),t.accept(),r.status===S.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(r.status=S.SessionStatus.STATUS_EARLY_MEDIA,r.accept()),r.status=S.SessionStatus.STATUS_EARLY_MEDIA},function(e){r.logger.warn(e),r.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),r.failed(t.message,v.C.causes.BAD_MEDIA_DESCRIPTION),r.terminated(t.message,v.C.causes.BAD_MEDIA_DESCRIPTION)})):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t.message,v.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t.message,v.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===S.SessionStatus.STATUS_EARLY_MEDIA&&t.accept();break;default:g.prototype.receiveRequest.call(this,t)}},y.prototype.setupSessionDescriptionHandler=function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)},y.prototype.generateResponseOfferAnswer=function(e){if(!this.session){var t=m.getBody(this.incomingRequest.message);return t&&"session"===t.contentDisposition?this.setOfferAndGetAnswer(t,e):this.getOffer(e)}switch(this.session.signalingState){case m.SignalingState.Initial:return this.getOffer(e);case m.SignalingState.Stable:case m.SignalingState.HaveLocalOffer:return Promise.resolve(void 0);case m.SignalingState.HaveRemoteOffer:if(!this.session.offer)throw new Error("Session offer undefined");return this.setOfferAndGetAnswer(this.session.offer,e);case m.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.session.signalingState+".")}},y.prototype.handlePrackOfferAnswer=function(e,t){if(!this.session)throw new Error("Session undefined.");var r=m.getBody(e.message);if(!r||"session"!==r.contentDisposition)return Promise.resolve(void 0);switch(this.session.signalingState){case m.SignalingState.Initial:throw new Error("Invalid signaling state "+this.session.signalingState+".");case m.SignalingState.Stable:return this.setAnswer(r,t).then(function(){});case m.SignalingState.HaveLocalOffer:throw new Error("Invalid signaling state "+this.session.signalingState+".");case m.SignalingState.HaveRemoteOffer:return this.setOfferAndGetAnswer(r,t);case m.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.session.signalingState+".")}},y.prototype.canceled=function(){return this._canceled=!0,g.prototype.canceled.call(this)},y.prototype.terminated=function(e,t){return this.prackNeverArrived(),g.prototype.terminated.call(this,e,t)},y.prototype._accept=function(e){var t=this;return void 0===e&&(e={}),this.onInfo=e.onInfo,this.status===S.SessionStatus.STATUS_WAITING_FOR_PRACK?(this.status=S.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK,this.waitForArrivalOfPrack().then(function(){t.status=S.SessionStatus.STATUS_ANSWERED,clearTimeout(t.timers.userNoAnswerTimer)}).then(function(){return t.generateResponseOfferAnswer(e)}).then(function(e){return t.incomingRequest.accept({statusCode:200,body:e})})):this.status!==S.SessionStatus.STATUS_WAITING_FOR_ANSWER?Promise.reject(new T.Exceptions.InvalidStateError(this.status)):(this.status=S.SessionStatus.STATUS_ANSWERED,this.status=S.SessionStatus.STATUS_ANSWERED,clearTimeout(this.timers.userNoAnswerTimer),this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.accept({statusCode:200,body:e})}))},y.prototype._progress=function(e){void 0===e&&(e={});var t=e.statusCode||180,r=e.reasonPhrase,i=(e.extraHeaders||[]).slice(),n=e.body?m.fromBodyLegacy(e.body):void 0;if(183===t&&!n)return this._progressWithSDP(e);try{var s=this.incomingRequest.progress({statusCode:t,reasonPhrase:r,extraHeaders:i,body:n});return this.emit("progress",s.message,r),this.session=s.session,Promise.resolve(s)}catch(e){return Promise.reject(e)}},y.prototype._progressWithSDP=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||183,i=e.reasonPhrase,n=(e.extraHeaders||[]).slice();return this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.progress({statusCode:r,reasonPhrase:i,extraHeaders:n,body:e})}).then(function(e){return t.emit("progress",e.message,i),t.session=e.session,e})},y.prototype._reliableProgress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||183,i=e.reasonPhrase,n=(e.extraHeaders||[]).slice();return n.push("Require: 100rel"),n.push("RSeq: "+Math.floor(1e4*Math.random())),this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.progress({statusCode:r,reasonPhrase:i,extraHeaders:n,body:e})}).then(function(e){return t.emit("progress",e.message,i),t.session=e.session,e})},y.prototype._reliableProgressWaitForPrack=function(d){var p=this;void 0===d&&(d={});var l,h=d.statusCode||183,g=d.reasonPhrase,f=(d.extraHeaders||[]).slice();return f.push("Require: 100rel"),f.push("RSeq: "+this.rseq++),this.status=S.SessionStatus.STATUS_WAITING_FOR_PRACK,new Promise(function(a,c){var u=!0;return p.generateResponseOfferAnswer(d).then(function(e){return l=e,p.incomingRequest.progress({statusCode:h,reasonPhrase:g,extraHeaders:f,body:l})}).then(function(t){var r,i;p.emit("progress",t.message,g),p.session=t.session,t.session.delegate={onPrack:function(e){r=e,clearTimeout(n),clearTimeout(o),u&&(u=!1,p.handlePrackOfferAnswer(r,d).then(function(e){try{i=r.accept({statusCode:200,body:e}),p.status===S.SessionStatus.STATUS_WAITING_FOR_PRACK&&(p.status=S.SessionStatus.STATUS_WAITING_FOR_ANSWER),p.prackArrived(),a({prackRequest:r,prackResponse:i,progressResponse:t})}catch(e){c(e)}}))}};var n=setTimeout(function(){if(u){u=!1,p.logger.warn("No PRACK received, rejecting INVITE."),clearTimeout(o);try{p.incomingRequest.reject({statusCode:504}),p.terminated(void 0,v.C.causes.NO_PRACK),c(new T.Exceptions.TerminatedSessionError)}catch(e){c(e)}}},64*m.Timers.T1),e=function(){try{p.incomingRequest.progress({statusCode:h,reasonPhrase:g,extraHeaders:f,body:l})}catch(e){return u=!1,void c(e)}o=setTimeout(e,s*=2)},s=m.Timers.T1,o=setTimeout(e,s)})})},y.prototype.onAckTimeout=function(){if(this.status===S.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.logger.log("no ACK received for an extended period of time, terminating the call"),!this.session)throw new Error("Session undefined.");this.session.bye(),this.terminated(void 0,v.C.causes.NO_ACK)}},y.prototype.onContextError=function(e){var t=480;e instanceof m.Exception?e instanceof T.Exceptions.SessionDescriptionHandlerError?(this.logger.error(e.message),e.error&&this.logger.error(e.error)):e instanceof T.Exceptions.TerminatedSessionError?this.logger.warn("Incoming session terminated while waiting for PRACK."):e instanceof T.Exceptions.UnsupportedSessionDescriptionContentTypeError?t=415:e instanceof m.Exception&&this.logger.error(e.message):e instanceof Error?this.logger.error(e.message):(this.logger.error("An error occurred in the session description handler."),this.logger.error(e));try{this.incomingRequest.reject({statusCode:t}),this.failed(this.incomingRequest.message,e.message),this.terminated(this.incomingRequest.message,e.message)}catch(e){return}},y.prototype.prackArrived=function(){this.waitingForPrackResolve&&this.waitingForPrackResolve(),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0},y.prototype.prackNeverArrived=function(){this.waitingForPrackReject&&this.waitingForPrackReject(new T.Exceptions.TerminatedSessionError),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0},y.prototype.waitForArrivalOfPrack=function(){var r=this;if(this.waitingForPrackPromise)throw new Error("Already waiting for PRACK");return this.waitingForPrackPromise=new Promise(function(e,t){r.waitingForPrackResolve=e,r.waitingForPrackReject=t}),this.waitingForPrackPromise},y.prototype.getOffer=function(e){return this.hasOffer=!0,this.getSessionDescriptionHandler().getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){return l.Utils.fromBodyObj(e)})},y.prototype.setAnswer=function(e,t){this.hasAnswer=!0;var r=this.getSessionDescriptionHandler();return r.hasDescription(e.contentType)?r.setDescription(e.content,t.sessionDescriptionHandlerOptions,t.modifiers):Promise.reject(new T.Exceptions.UnsupportedSessionDescriptionContentTypeError)},y.prototype.setOfferAndGetAnswer=function(e,t){this.hasOffer=!0,this.hasAnswer=!0;var r=this.getSessionDescriptionHandler();return r.hasDescription(e.contentType)?r.setDescription(e.content,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return r.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(e){return l.Utils.fromBodyObj(e)}):Promise.reject(new T.Exceptions.UnsupportedSessionDescriptionContentTypeError)},y.prototype.getSessionDescriptionHandler=function(){var e=this.sessionDescriptionHandler=this.setupSessionDescriptionHandler();return this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),e},y);function y(e,t){var r=this;if(!e.configuration.sessionDescriptionHandlerFactory)throw e.logger.warn("Can't build ISC without SDH Factory"),new Error("ISC Constructor Failed");(r=g.call(this,e.configuration.sessionDescriptionHandlerFactory)||this)._canceled=!1,r.rseq=Math.floor(1e4*Math.random());var i=(r.incomingRequest=t).message;a.ServerContext.initializer(r,e,t),r.type=S.TypeStrings.InviteServerContext;var n=i.parseHeader("Content-Disposition");n&&"render"===n.type&&(r.renderbody=i.body,r.rendertype=i.getHeader("Content-Type")),r.status=S.SessionStatus.STATUS_INVITE_RECEIVED,r.fromTag=i.fromTag,r.id=i.callId+r.fromTag,r.request=i,r.contact=r.ua.contact.toString(),r.logger=e.getLogger("sip.inviteservercontext",r.id),r.ua.sessions[r.id]=r;function s(e,t){i.hasHeader(e)&&0<=i.getHeader(e).toLowerCase().indexOf("100rel")&&(r.rel100=t)}if(s("require",v.C.supported.REQUIRED),s("supported",v.C.supported.SUPPORTED),r.request.toTag=t.toTag,r.status=S.SessionStatus.STATUS_WAITING_FOR_ANSWER,r.timers.userNoAnswerTimer=setTimeout(function(){t.reject({statusCode:408}),r.failed(i,v.C.causes.NO_ANSWER),r.terminated(i,v.C.causes.NO_ANSWER)},r.ua.configuration.noAnswerTimeout||60),i.hasHeader("expires")){var o=1e3*Number(i.getHeader("expires")||0);r.timers.expiresTimer=setTimeout(function(){r.status===S.SessionStatus.STATUS_WAITING_FOR_ANSWER&&(t.reject({statusCode:487}),r.failed(i,v.C.causes.EXPIRES),r.terminated(i,v.C.causes.EXPIRES))},o)}return r.errorListener=r.onTransportError.bind(r),e.transport&&e.transport.on("transportError",r.errorListener),r}t.InviteServerContext=f;var E,b=(E=o,n.__extends(C,E),C.prototype.receiveResponse=function(e){throw new Error("Unimplemented.")},C.prototype.send=function(){return this.sendInvite(),this},C.prototype.invite=function(){var t=this;return this.ua.sessions[this.id]=this,Promise.resolve().then(function(){t.isCanceled||t.status===S.SessionStatus.STATUS_TERMINATED||(t.inviteWithoutSdp?(t.renderbody&&t.rendertype&&(t.request.body={body:t.renderbody,contentType:t.rendertype}),t.status=S.SessionStatus.STATUS_INVITE_SENT,t.send()):(t.sessionDescriptionHandler=t.sessionDescriptionHandlerFactory(t,t.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),t.emit("SessionDescriptionHandler-created",t.sessionDescriptionHandler),t.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(e){t.isCanceled||t.status===S.SessionStatus.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=S.SessionStatus.STATUS_INVITE_SENT,t.send())},function(e){e.type===S.TypeStrings.SessionDescriptionHandlerError&&(t.logger.log(e.message),e.error&&t.logger.log(e.error)),t.status!==S.SessionStatus.STATUS_TERMINATED&&(t.failed(void 0,v.C.causes.WEBRTC_ERROR),t.terminated(void 0,v.C.causes.WEBRTC_ERROR))})))}),this},C.prototype.cancel=function(e){if(void 0===e&&(e={}),this.status===S.SessionStatus.STATUS_TERMINATED||this.status===S.SessionStatus.STATUS_CONFIRMED)throw new T.Exceptions.InvalidStateError(this.status);if(this.isCanceled)throw new T.Exceptions.InvalidStateError(S.SessionStatus.STATUS_CANCELED);this.isCanceled=!0,this.logger.log("Canceling session");var t=l.Utils.getCancelReason(e.statusCode,e.reasonPhrase);return e.extraHeaders=(e.extraHeaders||[]).slice(),this.outgoingInviteRequest&&(this.logger.warn("Canceling session before it was created"),this.outgoingInviteRequest.cancel(t,e)),this.canceled()},C.prototype.terminate=function(e){return this.status===S.SessionStatus.STATUS_TERMINATED||(this.status===S.SessionStatus.STATUS_WAITING_FOR_ACK||this.status===S.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.cancel(e)),this},C.prototype.sendInvite=function(){var t=this;this.outgoingInviteRequest=this.ua.userAgentCore.invite(this.request,{onAccept:function(e){return t.onAccept(e)},onProgress:function(e){return t.onProgress(e)},onRedirect:function(e){return t.onRedirect(e)},onReject:function(e){return t.onReject(e)},onTrying:function(e){return t.onTrying(e)}})},C.prototype.ackAndBye=function(e,t,r,i){if(!this.ua.userAgentCore)throw new Error("Method requires user agent core.");var n=[];r&&n.push("Reason: "+l.Utils.getReasonHeaderValue(r,i));var s=e.ack();this.emit("ack",s.message);var o=t.bye(void 0,{extraHeaders:n});this.emit("bye",o.message)},C.prototype.disposeEarlyMedia=function(){if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");this.earlyMediaSessionDescriptionHandlers.forEach(function(e){e.close()})},C.prototype.onAccept=function(i){var n=this;if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");var s=i.message,t=i.session;if(this.session)this.ackAndBye(i,t);else{if(this.isCanceled)return this.ackAndBye(i,t),void this.emit("bye",this.request);switch(s.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=m.Grammar.nameAddrHeaderParse(s.getHeader("P-Asserted-Identity"))),this.session=t,this.session.delegate={onAck:function(e){return n.onAck(e)},onBye:function(e){return n.receiveRequest(e)},onInfo:function(e){return n.receiveRequest(e)},onInvite:function(e){return n.receiveRequest(e)},onNotify:function(e){return n.receiveRequest(e)},onPrack:function(e){return n.receiveRequest(e)},onRefer:function(e){return n.receiveRequest(e)}},t.signalingState){case m.SignalingState.Initial:case m.SignalingState.HaveLocalOffer:this.ackAndBye(i,t,400,"Missing session description"),this.failed(s,v.C.causes.BAD_MEDIA_DESCRIPTION);break;case m.SignalingState.HaveRemoteOffer:var e=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});if(this.sessionDescriptionHandler=e,this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!e.hasDescription(s.getHeader("Content-Type")||"")){this.ackAndBye(i,t,400,"Missing session description"),this.failed(s,v.C.causes.BAD_MEDIA_DESCRIPTION);break}this.hasOffer=!0,e.setDescription(s.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return e.getDescription(n.sessionDescriptionHandlerOptions,n.modifiers)}).then(function(e){if(!n.isCanceled&&n.status!==S.SessionStatus.STATUS_TERMINATED){n.status=S.SessionStatus.STATUS_CONFIRMED,n.hasAnswer=!0;var t={contentDisposition:"session",contentType:e.contentType,content:e.body},r=i.ack({body:t});n.emit("ack",r.message),n.accepted(s)}}).catch(function(e){if(e.type!==S.TypeStrings.SessionDescriptionHandlerError)throw e;n.logger.warn("invalid description"),n.logger.warn(e.toString()),n.ackAndBye(i,t,488,"Invalid session description"),n.failed(s,v.C.causes.BAD_MEDIA_DESCRIPTION)});break;case m.SignalingState.Stable:var r;if(this.renderbody&&this.rendertype&&(r={body:{contentDisposition:"render",contentType:this.rendertype,content:this.renderbody}}),this.hasOffer&&!this.hasAnswer){if(!this.sessionDescriptionHandler)throw new Error("Session description handler undefined.");var o=t.answer;if(!o)throw new Error("Answer is undefined.");this.sessionDescriptionHandler.setDescription(o.content,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){n.hasAnswer=!0,n.status=S.SessionStatus.STATUS_CONFIRMED;var e=i.ack(r);n.emit("ack",e.message),n.accepted(s)}).catch(function(e){n.logger.error(e),n.ackAndBye(i,t,488,"Not Acceptable Here"),n.failed(s,v.C.causes.BAD_MEDIA_DESCRIPTION)})}else{if(this.sessionDescriptionHandler=this.earlyMediaSessionDescriptionHandlers.get(t.id),!this.sessionDescriptionHandler)throw new Error("Session description handler undefined.");this.earlyMediaSessionDescriptionHandlers.delete(t.id),this.hasOffer=!0,this.hasAnswer=!0,this.status=S.SessionStatus.STATUS_CONFIRMED;var a=i.ack();this.emit("ack",a.message),this.accepted(s)}break;case m.SignalingState.Closed:break;default:throw new Error("Unknown session signaling state.")}this.disposeEarlyMedia()}},C.prototype.onProgress=function(r){var i=this;if(!this.isCanceled){if(!this.outgoingInviteRequest)throw new Error("Outgoing INVITE request undefined.");if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");var n=r.message,e=r.session;if(this.status=S.SessionStatus.STATUS_1XX_RECEIVED,n.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=m.Grammar.nameAddrHeaderParse(n.getHeader("P-Asserted-Identity"))),!e)throw new Error("Session undefined.");var t=n.getHeader("require"),s=n.getHeader("rseq"),o=!!(t&&t.includes("100rel")&&s&&Number(s)),a=[];if(o&&a.push("RAck: "+n.getHeader("rseq")+" "+n.getHeader("cseq")),e.signalingState===m.SignalingState.Initial)return o&&(this.logger.warn("First reliable provisional response received MUST contain an offer when INVITE does not contain an offer."),r.prack({extraHeaders:a})),void this.emit("progress",n);if(e.signalingState===m.SignalingState.HaveLocalOffer)return o&&r.prack({extraHeaders:a}),void this.emit("progress",n);if(e.signalingState!==m.SignalingState.HaveRemoteOffer)return e.signalingState===m.SignalingState.Stable?(o&&r.prack({extraHeaders:a}),void this.emit("progress",n)):void 0;if(!o)return void this.logger.warn("Non-reliable provisional response MUST NOT contain an initial offer, discarding response.");var c=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});return this.emit("SessionDescriptionHandler-created",c),this.earlyMediaSessionDescriptionHandlers.set(e.id,c),void c.setDescription(n.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return c.getDescription(i.sessionDescriptionHandlerOptions,i.modifiers)}).then(function(e){var t={contentDisposition:"session",contentType:e.contentType,content:e.body};r.prack({extraHeaders:a,body:t}),i.status=S.SessionStatus.STATUS_EARLY_MEDIA,i.emit("progress",n)}).catch(function(e){i.status!==S.SessionStatus.STATUS_TERMINATED&&(i.failed(void 0,v.C.causes.WEBRTC_ERROR),i.terminated(void 0,v.C.causes.WEBRTC_ERROR))})}},C.prototype.onRedirect=function(e){this.disposeEarlyMedia();var t=e.message,r=t.statusCode,i=l.Utils.sipErrorCause(r||0);this.rejected(t,i),this.failed(t,i),this.terminated(t,i)},C.prototype.onReject=function(e){this.disposeEarlyMedia();var t=e.message,r=t.statusCode,i=l.Utils.sipErrorCause(r||0);this.rejected(t,i),this.failed(t,i),this.terminated(t,i)},C.prototype.onTrying=function(e){this.received100=!0,this.emit("progress",e.message)},C);function C(e,t,r,i){void 0===r&&(r={}),void 0===i&&(i=[]);var n=this;if(!e.configuration.sessionDescriptionHandlerFactory)throw e.logger.warn("Can't build ISC without SDH Factory"),new Error("ICC Constructor Failed");r.params=r.params||{};var s=r.anonymous||!1,o=l.Utils.newTag();r.params.fromTag=o;var a=e.contact.toString({anonymous:s,outbound:s?!e.contact.tempGruu:!e.contact.pubGruu}),c=(r.extraHeaders||[]).slice();if(s&&e.configuration.uri&&(r.params.fromDisplayName="Anonymous",r.params.fromUri="sip:anonymous@anonymous.invalid",c.push("P-Preferred-Identity: "+e.configuration.uri.toString()),c.push("Privacy: id")),c.push("Contact: "+a),c.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),e.configuration.rel100===v.C.supported.REQUIRED&&c.push("Require: 100rel"),e.configuration.replaces===v.C.supported.REQUIRED&&c.push("Require: replaces"),r.extraHeaders=c,n=E.call(this,e.configuration.sessionDescriptionHandlerFactory)||this,u.ClientContext.initializer(n,e,v.C.INVITE,t,r),n.earlyMediaSessionDescriptionHandlers=new Map,n.type=S.TypeStrings.InviteClientContext,n.passedOptions=r,n.sessionDescriptionHandlerOptions=r.sessionDescriptionHandlerOptions||{},n.modifiers=i,n.inviteWithoutSdp=r.inviteWithoutSdp||!1,n.anonymous=r.anonymous||!1,n.renderbody=r.renderbody||void 0,n.rendertype=r.rendertype||"text/plain",n.fromTag=o,n.contact=a,n.status!==S.SessionStatus.STATUS_NULL)throw new T.Exceptions.InvalidStateError(n.status);return n.isCanceled=!1,n.received100=!1,n.method=v.C.INVITE,n.logger=e.getLogger("sip.inviteclientcontext"),(e.applicants[n.toString()]=n).id=n.request.callId+n.fromTag,n.onInfo=r.onInfo,n.errorListener=n.onTransportError.bind(n),e.transport&&e.transport.on("transportError",n.errorListener),n}t.InviteClientContext=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(1),n=r(31),s=r(80),a=r(82),c=r(84),u=r(83),d=r(91),p=(o=n.EventEmitter,i.__extends(l,o),l.prototype.send=function(e){if(void 0===e&&(e={}),this.owner.status!==a.SessionStatus.STATUS_CONFIRMED&&this.owner.status!==a.SessionStatus.STATUS_WAITING_FOR_ACK)throw new c.Exceptions.InvalidStateError(this.owner.status);var t=e.extraHeaders?e.extraHeaders.slice():[],r={contentType:"application/dtmf-relay",body:"Signal= "+this.tone+"\r\nDuration= "+this.duration};if(this.owner.session){var i=this.owner.session.info(void 0,{extraHeaders:t,body:u.Utils.fromBodyObj(r)});this.owner.emit("dtmf",i.message,this)}},l.prototype.init_incoming=function(e){e.accept(),this.tone&&this.duration?this.owner.emit("dtmf",e.message,this):this.logger.warn("invalid INFO DTMF received, discarded")},l.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;switch(!0){case/^1[0-9]{2}$/.test(t.toString()):break;case/^2[0-9]{2}$/.test(t.toString()):this.emit("succeeded",{originator:"remote",response:e});break;default:var r=u.Utils.sipErrorCause(t);this.emit("failed",e,r)}},l.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},l.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},l.prototype.onDialogError=function(e){this.emit("failed",e,s.C.causes.DIALOG_ERROR),this.owner.onDialogError(e)},l);function l(e,t,r){void 0===r&&(r={});var i=o.call(this)||this;if(i.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},i.type=a.TypeStrings.DTMF,void 0===t)throw new TypeError("Not enough arguments");i.logger=e.ua.getLogger("sip.invitecontext.dtmf",e.id),i.owner=e;i.tone=d.DTMFValidator.validate(t,!1);var n=r.duration,s=r.interToneGap;if(n&&!u.Utils.isDecimal(n))throw new TypeError("Invalid tone duration: "+n);if(n=n?n<i.C.MIN_DURATION?(i.logger.warn("'duration' value is lower than the minimum allowed, setting it to "+i.C.MIN_DURATION+" milliseconds"),i.C.MIN_DURATION):n>i.C.MAX_DURATION?(i.logger.warn("'duration' value is greater than the maximum allowed, setting it to "+i.C.MAX_DURATION+" milliseconds"),i.C.MAX_DURATION):Math.abs(n):i.C.DEFAULT_DURATION,i.duration=n,s&&!u.Utils.isDecimal(s))throw new TypeError("Invalid interToneGap: "+s);return s=s?s<i.C.MIN_INTER_TONE_GAP?(i.logger.warn("'interToneGap' value is lower than the minimum allowed, setting it to "+i.C.MIN_INTER_TONE_GAP+" milliseconds"),i.C.MIN_INTER_TONE_GAP):Math.abs(s):i.C.DEFAULT_INTER_TONE_GAP,i.interToneGap=s,i}t.DTMF=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.validate=function(e,t){void 0===t&&(t=!0),"string"==typeof e?e=e.toUpperCase():"number"==typeof e?e=e.toString():n.generateInvalidToneError(e);var r=t?/^[0-9A-D#*,]+$/i:/^[0-9A-D#*]$/i;return e.match(r)||n.generateInvalidToneError(e),e},n.generateInvalidToneError=function(e){var t=e&&"boolean"!=typeof e?e.toString().toLowerCase():e;throw new TypeError("Invalid tone(s): "+t)},n);function n(){}t.DTMFValidator=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(1),n=r(31),u=r(80),s=r(2),d=r(59),a=r(82),c=r(83),p=(o=n.EventEmitter,i.__extends(l,o),l.prototype.dispose=function(){this.disposed||(this.retryAfterTimer&&(clearTimeout(this.retryAfterTimer),this.retryAfterTimer=void 0),this.context.dispose(),this.disposed=!0,delete this.ua.subscriptions[this.id])},l.prototype.on=function(e,t){return o.prototype.on.call(this,e,t)},l.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return o.prototype.emit.apply(this,i.__spreadArrays([e],t))},l.prototype.close=function(){if(!this.disposed)switch(this.dispose(),this.context.state){case s.SubscriptionState.Initial:case s.SubscriptionState.NotifyWait:this.onTerminated();break;case s.SubscriptionState.Pending:case s.SubscriptionState.Active:this.unsubscribe();break;case s.SubscriptionState.Terminated:this.onTerminated()}},l.prototype.refresh=function(){var t=this;switch(this.context.state){case s.SubscriptionState.Initial:case s.SubscriptionState.NotifyWait:case s.SubscriptionState.Pending:break;case s.SubscriptionState.Active:this.subscription&&(this.subscription.refresh().delegate={onAccept:function(e){return t.onAccepted(e)},onRedirect:function(e){return t.onFailed(e)},onReject:function(e){return t.onFailed(e)}});break;case s.SubscriptionState.Terminated:}},l.prototype.subscribe=function(){var t=this;switch(this.context.state){case s.SubscriptionState.Initial:this.context.subscribe().then(function(e){e.success?(e.success.subscription&&(t.subscription=e.success.subscription,t.subscription.delegate={onNotify:function(e){return t.onNotify(e)},onRefresh:function(e){return t.onRefresh(e)},onTerminated:function(){return t.close()}}),t.onNotify(e.success.request)):e.failure&&t.onFailed(e.failure.response)});break;case s.SubscriptionState.NotifyWait:case s.SubscriptionState.Pending:break;case s.SubscriptionState.Active:this.refresh();break;case s.SubscriptionState.Terminated:}return this},l.prototype.unsubscribe=function(){switch(this.dispose(),this.context.state){case s.SubscriptionState.Initial:case s.SubscriptionState.NotifyWait:break;case s.SubscriptionState.Pending:case s.SubscriptionState.Active:this.subscription&&this.subscription.unsubscribe();break;case s.SubscriptionState.Terminated:}this.onTerminated()},l.prototype.onAccepted=function(e){var t=e.message.statusCode?e.message.statusCode:0,r=c.Utils.getReasonPhrase(t);this.emit("accepted",e.message,r)},l.prototype.onFailed=function(e){if(this.close(),e){var t=e.message.statusCode?e.message.statusCode:0,r=c.Utils.getReasonPhrase(t);this.emit("failed",e.message,r),this.emit("rejected",e.message,r)}},l.prototype.onNotify=function(e){var t=this;if(e.accept(),this.emit("notify",{request:e.message}),!this.disposed){var r=e.message.parseHeader("Subscription-State");if(r&&r.state)switch(r.state){case"terminated":if(r.reason)switch(this.logger.log("Terminated subscription with reason "+r.reason),r.reason){case"deactivated":case"timeout":return this.initContext(),void this.subscribe();case"probation":case"giveup":return this.initContext(),void(r.params&&r.params["retry-after"]?this.retryAfterTimer=setTimeout(function(){return t.subscribe()},r.params["retry-after"]):this.subscribe())}this.close()}}},l.prototype.onRefresh=function(e){var t=this;e.delegate={onAccept:function(e){return t.onAccepted(e)}}},l.prototype.onTerminated=function(){this.emit("terminated")},l.prototype.initContext=function(){var t=this,e={extraHeaders:this.extraHeaders,body:this.body?c.Utils.fromBodyObj(this.body):void 0};return this.context=new h(this.ua.userAgentCore,this.uri,this.event,this.expires,e),this.context.delegate={onAccept:function(e){return t.onAccepted(e)}},this.context},l);function l(e,t,r,i){void 0===i&&(i={});var n=o.call(this)||this;n.data={},n.method=u.C.SUBSCRIBE,n.body=void 0,n.type=a.TypeStrings.Subscription,n.ua=e,n.logger=e.getLogger("sip.subscription"),i.body&&(n.body={body:i.body,contentType:i.contentType?i.contentType:"application/sdp"});var s=e.normalizeTarget(t);if(!s)throw new TypeError("Invalid target: "+t);if(n.uri=s,n.event=r,void 0===i.expires?n.expires=3600:"number"!=typeof i.expires?(e.logger.warn('Option "expires" must be a number. Using default of 3600.'),n.expires=3600):n.expires=i.expires,n.extraHeaders=(i.extraHeaders||[]).slice(),n.context=n.initContext(),n.disposed=!1,n.request=n.context.message,!n.request.from)throw new Error("From undefined.");if(!n.request.to)throw new Error("From undefined.");return n.localIdentity=n.request.from,n.remoteIdentity=n.request.to,n.id=n.request.callId+n.request.from.parameters.tag+n.event,n.ua.subscriptions[n.id]=n}t.Subscription=p;var h=(g.prototype.dispose=function(){this.subscription&&this.subscription.dispose(),this.request&&(this.request.waitNotifyStop(),this.request.dispose())},Object.defineProperty(g.prototype,"state",{get:function(){return this.subscription?this.subscription.subscriptionState:this.subscribed?s.SubscriptionState.NotifyWait:s.SubscriptionState.Initial},enumerable:!0,configurable:!0}),g.prototype.subscribe=function(){var r=this;return this.subscribed?Promise.reject(new Error("Not in initial state. Did you call subscribe more than once?")):(this.subscribed=!0,new Promise(function(t,e){if(!r.message)throw new Error("Message undefined.");r.request=r.core.subscribe(r.message,{onAccept:function(e){r.delegate&&r.delegate.onAccept&&r.delegate.onAccept(e)},onNotify:function(e){r.subscription=e.subscription,r.subscription&&(r.subscription.autoRefresh=!0),t({success:e})},onNotifyTimeout:function(){t({failure:{}})},onRedirect:function(e){t({failure:{response:e}})},onReject:function(e){t({failure:{response:e}})}})}))},g);function g(e,t,r,i,n,s){this.core=e,this.target=t,this.event=r,this.expires=i,this.subscribed=!1,this.logger=e.loggerFactory.getLogger("sip.subscription"),this.delegate=s;var o="Allow: "+d.AllowedMethods.toString(),a=(n&&n.extraHeaders||[]).slice();a.push(o),a.push("Event: "+this.event),a.push("Expires: "+this.expires),a.push("Contact: "+this.core.configuration.contact.toString());var c=n&&n.body;this.message=e.makeOutgoingRequestMessage(u.C.SUBSCRIBE,this.target,this.core.configuration.aor,this.target,{},a,c)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(31),o=(i=s.EventEmitter,n.__extends(a,i),Object.defineProperty(a.prototype,"protocol",{get:function(){return this.server&&this.server.scheme?this.server.scheme:"WSS"},enumerable:!0,configurable:!0}),a.prototype.connect=function(e){var t=this;return void 0===e&&(e={}),this.connectPromise(e).then(function(e){e.overrideEvent||t.emit("connected")})},a.prototype.send=function(e,t){var r=this;return void 0===t&&(t={}),this.sendPromise(e).then(function(e){e.overrideEvent||r.emit("messageSent",e.msg)})},a.prototype.disconnect=function(e){var t=this;return void 0===e&&(e={}),this.disconnectPromise(e).then(function(e){e.overrideEvent||t.emit("disconnected")})},a.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},a.prototype.waitForConnected=function(){var t=this;return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new Promise(function(e){t.afterConnected(e)})},a);function a(e,t){var r=i.call(this)||this;return r.logger=e,r}t.Transport=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i,n,o=r(1),a=r(31),c=r(79),l=r(80),h=r(2),u=r(82),d=r(84),p=r(85),g=r(86),f=r(88),v=r(87),m=r(89),S=r(92),T=r(83),y=r(95),E=r(110),b=(s=a.EventEmitter,o.__extends(C,s),C.prototype.register=function(e){return void 0===e&&(e={}),e.register&&(this.configuration.register=!0),this.registerContext.register(e),this},C.prototype.unregister=function(e){var t=this;return this.configuration.register=!1,this.transport.afterConnected(function(){t.registerContext.unregister(e)}),this},C.prototype.isRegistered=function(){return this.registerContext.registered},C.prototype.invite=function(e,t,r){var i=this,n=new m.InviteClientContext(this,e,t,r);return this.transport.afterConnected(function(){n.invite(),i.emit("inviteSent",n)}),n},C.prototype.subscribe=function(e,t,r){var i=new S.Subscription(this,e,t,r);return this.transport.afterConnected(function(){return i.subscribe()}),i},C.prototype.publish=function(e,t,r,i){var n=new p.PublishContext(this,e,t,i);return this.transport.afterConnected(function(){n.publish(r)}),n},C.prototype.message=function(e,t,r){if(void 0===r&&(r={}),void 0===t)throw new TypeError("Not enough arguments");return r.contentType=r.contentType||"text/plain",r.body=t,this.request(l.C.MESSAGE,e,r)},C.prototype.request=function(e,t,r){var i=new c.ClientContext(this,e,t,r);return this.transport.afterConnected(function(){return i.send()}),i},C.prototype.stop=function(){if(this.logger.log("user requested closure..."),this.status===u.UAStatus.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(var e in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.sessions[e]&&(this.logger.log("closing session "+e),this.sessions[e].terminate());for(var t in this.subscriptions)this.subscriptions[t]&&(this.logger.log("unsubscribe "+t),this.subscriptions[t].unsubscribe());for(var r in this.publishers)this.publishers[r]&&(this.logger.log("unpublish "+r),this.publishers[r].close());for(var i in this.applicants)this.applicants[i]&&this.applicants[i].close();if(this.status=u.UAStatus.STATUS_USER_CLOSED,this.transport.disconnect(),this.userAgentCore.reset(),this.configuration.autostop){var n=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"==typeof window||"function"!=typeof window.removeEventListener||n||window.removeEventListener("unload",this.unloadListener)}return this},C.prototype.start=function(){if(this.logger.log("user requested startup..."),this.status===u.UAStatus.STATUS_INIT?(this.status=u.UAStatus.STATUS_STARTING,this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()):this.status===u.UAStatus.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=u.UAStatus.STATUS_READY,this.transport.connect()):this.status===u.UAStatus.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===u.UAStatus.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect"),this.configuration.autostop){var e=!("undefined"==typeof chrome||!chrome.app||!chrome.app.runtime);"undefined"==typeof window||"function"!=typeof window.addEventListener||e||window.addEventListener("unload",this.unloadListener)}return this},C.prototype.normalizeTarget=function(e){return T.Utils.normalizeTarget(e,this.configuration.hostportParams)},C.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},C.prototype.getLoggerFactory=function(){return this.log},C.prototype.getSupportedResponseOptions=function(){var e=[];(this.contact.pubGruu||this.contact.tempGruu)&&e.push("gruu"),this.configuration.rel100===l.C.supported.SUPPORTED&&e.push("100rel"),this.configuration.replaces===l.C.supported.SUPPORTED&&e.push("replaces"),e.push("outbound"),e=e.concat(this.configuration.extraSupported||[]);var i=this.configuration.hackAllowUnregisteredOptionTags||!1,n={};return e=e.filter(function(e){var t=l.C.OPTION_TAGS[e],r=!n[e];return n[e]=!0,(t||i)&&r})},C.prototype.findSession=function(e){return this.sessions[e.callId+e.fromTag]||this.sessions[e.callId+e.toTag]||void 0},C.prototype.on=function(e,t){return s.prototype.on.call(this,e,t)},C.prototype.onTransportError=function(){this.status!==u.UAStatus.STATUS_USER_CLOSED&&(this.error&&this.error===C.C.NETWORK_ERROR||(this.status=u.UAStatus.STATUS_NOT_READY,this.error=C.C.NETWORK_ERROR))},C.prototype.setTransportListeners=function(){var t=this;this.transport.on("connected",function(){return t.onTransportConnected()}),this.transport.on("message",function(e){return t.onTransportReceiveMsg(e)}),this.transport.on("transportError",function(){return t.onTransportError()})},C.prototype.onTransportConnected=function(){var e=this;this.configuration.register&&Promise.resolve().then(function(){return e.registerContext.register()})},C.prototype.onTransportReceiveMsg=function(e){var i=this,n=h.Parser.parseMessage(e,this.getLogger("sip.parser"));if(n)if(this.status===u.UAStatus.STATUS_USER_CLOSED&&n instanceof h.IncomingRequestMessage)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else{var t=function(){for(var e=0,t=["from","to","call_id","cseq","via"];e<t.length;e++){var r=t[e];if(!n.hasHeader(r))return i.logger.warn("Missing mandatory header field : "+r+"."),!1}return!0};if(n instanceof h.IncomingRequestMessage){if(!t())return void this.logger.warn("Request missing mandatory header field. Dropping.");if(!n.toTag&&n.callId.substr(0,5)===this.configuration.sipjsId)return void this.userAgentCore.replyStateless(n,{statusCode:482});var r=T.Utils.str_utf8_length(n.body);if((s=n.getHeader("content-length"))&&r<Number(s))return void this.userAgentCore.replyStateless(n,{statusCode:400})}if(n instanceof h.IncomingResponseMessage){if(!t())return void this.logger.warn("Response missing mandatory header field. Dropping.");if(1<n.getHeaders("via").length)return void this.logger.warn("More than one Via header field present in the response. Dropping.");if(n.via.host!==this.configuration.viaHost||void 0!==n.via.port)return void this.logger.warn("Via sent-by in the response does not match UA Via host value. Dropping.");var s;if(r=T.Utils.str_utf8_length(n.body),(s=n.getHeader("content-length"))&&r<Number(s))return void this.logger.warn("Message body length is lower than the value in Content-Length header field. Dropping.")}if(n instanceof h.IncomingRequestMessage)this.userAgentCore.receiveIncomingRequestFromTransport(n);else{if(!(n instanceof h.IncomingResponseMessage))throw new Error("Invalid message type.");this.userAgentCore.receiveIncomingResponseFromTransport(n)}}else this.logger.warn("UA failed to parse incoming SIP message - discarding.")},C.prototype.checkAuthenticationFactory=function(e){if(e instanceof Function)return e.initialize||(e.initialize=function(){return Promise.resolve()}),e},C.prototype.loadConfig=function(e){var n=this,s={viaHost:T.Utils.createRandomToken(12)+".invalid",uri:new h.URI("sip","anonymous."+T.Utils.createRandomToken(6),"anonymous.invalid",void 0,void 0),custom:{},displayName:"",password:void 0,register:!0,registerOptions:{},transportConstructor:E.Transport,transportOptions:{},usePreloadedRoute:!1,userAgentString:l.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},extraSupported:[],contactName:T.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:l.C.supported.UNSUPPORTED,dtmfType:l.C.dtmfType.INFO,replaces:l.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:y.SessionDescriptionHandler.defaultFactory,authenticationFactory:this.checkAuthenticationFactory(function(e){return new h.DigestAuthentication(e.getLoggerFactory(),n.configuration.authorizationUser,n.configuration.password)}),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1,experimentalFeatures:!1},t=this.getConfigurationCheck();for(var r in t.mandatory){if(!e.hasOwnProperty(r))throw new d.Exceptions.ConfigurationError(r);var i=e[r];if(void 0===(o=t.mandatory[r](i)))throw new d.Exceptions.ConfigurationError(r,i);s[r]=o}for(var r in t.optional)if(e.hasOwnProperty(r)){var o;if((i=e[r])instanceof Array&&0===i.length||null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(o=t.optional[r](i)))throw new d.Exceptions.ConfigurationError(r,i);s[r]=o}0===s.displayName&&(s.displayName="0"),s.sipjsId=T.Utils.createRandomToken(5);var a=s.uri.clone();if(a.user=void 0,s.hostportParams=a.toRaw().replace(/^sip:/i,""),s.authorizationUser||(s.authorizationUser=s.uri.user),s.noAnswerTimeout=1e3*s.noAnswerTimeout,s.hackIpInContact)if("boolean"==typeof s.hackIpInContact){var c=Math.floor(254*Math.random()+1);s.viaHost="192.0.2."+c}else"string"==typeof s.hackIpInContact&&(s.viaHost=s.hackIpInContact);s.hackWssInTransport&&(s.contactTransport="wss"),this.contact={pubGruu:void 0,tempGruu:void 0,uri:new h.URI("sip",s.contactName,s.viaHost,void 0,{transport:s.contactTransport}),toString:function(e){void 0===e&&(e={});var t=e.anonymous||!1,r=e.outbound||!1,i="<";return i+=t?(n.contact.tempGruu||"sip:anonymous@anonymous.invalid;transport="+s.contactTransport).toString():(n.contact.pubGruu||n.contact.uri).toString(),r&&(i+=";ob"),i+=">"}};var u={};for(var r in s)s.hasOwnProperty(r)&&(u[r]=s[r]);for(var r in Object.assign(this.configuration,u),this.logger.log("configuration parameters after validation:"),s)if(s.hasOwnProperty(r))switch(r){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("· "+r+": "+s[r]);break;case"password":this.logger.log("· "+r+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+r+": "+s[r].name);break;default:this.logger.log("· "+r+": "+JSON.stringify(s[r]))}},C.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(e){/^sip:/i.test(e)||(e=l.C.SIP+":"+e);var t=h.Grammar.URIParse(e);return t&&t.user?t:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(e){return-1===h.Grammar.parse('"'+e+'"',"quoted_string")?void 0:e},displayName:function(e){return-1===h.Grammar.parse('"'+e+'"',"displayName")?void 0:e},dtmfType:function(e){switch(e){case l.C.dtmfType.RTP:return l.C.dtmfType.RTP;case l.C.dtmfType.INFO:default:return l.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(e){return"boolean"==typeof e||"string"==typeof e&&-1!==h.Grammar.parse(e,"host")?e:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},extraSupported:function(e){if(e instanceof Array){for(var t=0,r=e;t<r.length;t++)if("string"!=typeof r[t])return;return e}},forceRport:function(e){if("boolean"==typeof e)return e},noAnswerTimeout:function(e){if(T.Utils.isDecimal(e)){var t=Number(e);if(0<t)return t}},password:function(e){return String(e)},rel100:function(e){return e===l.C.supported.REQUIRED?l.C.supported.REQUIRED:e===l.C.supported.SUPPORTED?l.C.supported.SUPPORTED:l.C.supported.UNSUPPORTED},replaces:function(e){return e===l.C.supported.REQUIRED?l.C.supported.REQUIRED:e===l.C.supported.SUPPORTED?l.C.supported.SUPPORTED:l.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerOptions:function(e){if("object"==typeof e)return e},usePreloadedRoute:function(e){if("boolean"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:this.checkAuthenticationFactory,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e},experimentalFeatures:function(e){if("boolean"==typeof e)return e}}}},C.C={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10},C);function C(e){var o=s.call(this)||this;if(o.unloadListener=function(){o.stop()},o.type=u.TypeStrings.UA,o.log=new h.LoggerFactory,o.logger=o.getLogger("sip.ua"),o.configuration={},o.applicants={},o.data={},o.sessions={},o.subscriptions={},o.publishers={},o.status=u.UAStatus.STATUS_INIT,void 0===e?e={}:("string"==typeof e||e instanceof String)&&(e={uri:e}),e.log&&(o.log.builtinEnabled=e.log.builtinEnabled,e.log.hasOwnProperty("connector")&&(o.log.connector=e.log.connector),e.log.hasOwnProperty("level"))){var t=e.log.level,r=void 0;if("string"==typeof t)switch(t){case"error":r=h.Levels.error;break;case"warn":r=h.Levels.warn;break;case"log":r=h.Levels.log;break;case"debug":r=h.Levels.debug}else switch(t){case 0:r=h.Levels.error;break;case 1:r=h.Levels.warn;break;case 2:r=h.Levels.log;break;case 3:r=h.Levels.debug}void 0===r?o.logger.error('Invalid "level" parameter value: '+JSON.stringify(t)):o.log.level=r}o.logger.warn("The UA class has been deprecated and will no longer be available starting with SIP.js release 0.16.0. The UA has been replaced by the UserAgent class. Please update accordingly.");try{o.loadConfig(e)}catch(e){throw o.status=u.UAStatus.STATUS_NOT_READY,o.error=C.C.CONFIGURATION_ERROR,e}if(!o.configuration.transportConstructor)throw new h.TransportError("Transport constructor not set");o.transport=new o.configuration.transportConstructor(o.getLogger("sip.transport"),o.configuration.transportOptions);var i=_(o),n={onInvite:function(e){e.trying(),e.delegate={onCancel:function(e){t.onCancel(e)},onTransportError:function(e){t.onTransportError()}};var t=new m.InviteServerContext(o,e);!function(e,t){if(o.configuration.replaces!==l.C.supported.UNSUPPORTED){var r=t.parseHeader("replaces");if(r){var i=o.sessions[r.call_id+r.replaces_from_tag]||o.sessions[r.call_id+r.replaces_to_tag]||void 0;if(!i)return o.userAgentCore.replyStateless(t,{statusCode:481});if(i.status===u.SessionStatus.STATUS_TERMINATED)return o.userAgentCore.replyStateless(t,{statusCode:603});var n=r.call_id+r.replaces_to_tag+r.replaces_from_tag,s=o.userAgentCore.dialogs.get(n);if(!s)return o.userAgentCore.replyStateless(t,{statusCode:481});if(!s.early&&r.early_only)return o.userAgentCore.replyStateless(t,{statusCode:486});e.replacee=i}}}(t,e.message),t.autoSendAnInitialProvisionalResponse&&t.progress(),o.emit("invite",t)},onMessage:function(e){var t=new v.ServerContext(o,e);t.body=e.message.body,t.contentType=e.message.getHeader("Content-Type")||"text/plain",e.accept(),o.emit("message",t)},onNotify:function(e){o.configuration.allowLegacyNotifications&&0<o.listeners("notify").length?(e.accept(),o.emit("notify",{request:e.message})):e.reject({statusCode:481})},onRefer:function(e){o.logger.log("Received an out of dialog refer"),o.configuration.allowOutOfDialogRefers||e.reject({statusCode:405}),o.logger.log("Allow out of dialog refers is enabled on the UA");var t=new g.ReferServerContext(o,e);o.listeners("outOfDialogReferRequested").length?o.emit("outOfDialogReferRequested",t):(o.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),t.accept({followRefer:!0}))},onSubscribe:function(e){o.emit("subscribe",e)}};return o.userAgentCore=new h.UserAgentCore(i,n),o.registerContext=new f.RegisterContext(o,e.registerOptions),o.registerContext.on("failed",o.emit.bind(o,"registrationFailed")),o.registerContext.on("registered",o.emit.bind(o,"registered")),o.registerContext.on("unregistered",o.emit.bind(o,"unregistered")),o.configuration.autostart&&o.start(),o}function _(e){if(!(e.configuration.uri instanceof h.URI))throw new Error("Configuration URI not instance of URI.");var t=e.configuration.uri,r=e.contact,i=e.configuration.displayName?e.configuration.displayName:"",n=!!e.configuration.hackViaTcp,s=e.configuration.usePreloadedRoute&&e.transport.server&&e.transport.server.sipUri?[e.transport.server.sipUri]:[],o=e.configuration.sipjsId||T.Utils.createRandomToken(5),a=[];a.push("outbound"),e.configuration.rel100===l.C.supported.SUPPORTED&&a.push("100rel"),e.configuration.replaces===l.C.supported.SUPPORTED&&a.push("replaces"),e.configuration.extraSupported&&a.push.apply(a,e.configuration.extraSupported),e.configuration.hackAllowUnregisteredOptionTags||(a=a.filter(function(e){return l.C.OPTION_TAGS[e]})),a=Array.from(new Set(a));var c=e.getSupportedResponseOptions(),u=e.configuration.userAgentString||"sipjs";if(!e.configuration.viaHost)throw new Error("Configuration via host undefined");var d=!!e.configuration.forceRport,p=e.configuration.viaHost;return{aor:t,contact:r,displayName:i,hackViaTcp:n,loggerFactory:e.getLoggerFactory(),routeSet:s,sipjsId:o,supportedOptionTags:a,supportedOptionTagsResponse:c,userAgentHeaderFieldValue:u,viaForceRport:d,viaHost:p,authenticationFactory:function(){if(e.configuration.authenticationFactory)return e.configuration.authenticationFactory(e)},transportAccessor:function(){return e.transport}}}t.UA=b,i=b=t.UA||(t.UA={}),(n=i.DtmfType||(i.DtmfType={})).RTP="rtp",n.INFO="info",t.UA=b,t.makeUserAgentCoreConfigurationFromUA=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(1),s=r(31),o=r(96),a=r(82),c=r(84),u=r(83),d=i.__importStar(r(108)),p=r(109),l=(n=s.EventEmitter,i.__extends(h,n),h.defaultFactory=function(e,t){return new h(e instanceof o.Session?e.userAgent.getLogger("sip.sessionDescriptionHandler",e.id):e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),new p.SessionDescriptionHandlerObserver(e,t),t)},h.prototype.close=function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.resetIceGatheringComplete(),this.peerConnection.close())},h.prototype.getDescription=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]),e.peerConnectionOptions&&this.initPeerConnection(e.peerConnectionOptions);var i=Object.assign({},this.constraints,e.constraints);return i=this.checkAndDefaultConstraints(i),JSON.stringify(i)!==JSON.stringify(this.constraints)&&(this.constraints=i,this.shouldAcquireMedia=!0),Array.isArray(t)||(t=[t]),t=t.concat(this.modifiers),Promise.resolve().then(function(){if(r.shouldAcquireMedia)return r.acquire(r.constraints).then(function(){r.shouldAcquireMedia=!1})}).then(function(){return r.createOfferOrAnswer(e.RTCOfferOptions,t)}).then(function(e){if(void 0===e.sdp)throw new c.Exceptions.SessionDescriptionHandlerError("getDescription",void 0,"SDP undefined");return r.emit("getDescription",e),{body:e.sdp,contentType:r.CONTENT_TYPE}})},h.prototype.hasDescription=function(e){return e===this.CONTENT_TYPE},h.prototype.holdModifier=function(e){return e.sdp&&(/a=(sendrecv|sendonly|recvonly|inactive)/.test(e.sdp)?(e.sdp=e.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):e.sdp=e.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n")),Promise.resolve(e)},h.prototype.setDescription=function(r,i,n){var s=this;void 0===i&&(i={}),void 0===n&&(n=[]),i.peerConnectionOptions&&this.initPeerConnection(i.peerConnectionOptions),Array.isArray(n)||(n=[n]),n=n.concat(this.modifiers);var e={type:this.hasOffer("local")?"answer":"offer",sdp:r};return Promise.resolve().then(function(){if(s.shouldAcquireMedia&&s.options.alwaysAcquireMediaFirst)return s.acquire(s.constraints).then(function(){s.shouldAcquireMedia=!1})}).then(function(){return u.Utils.reducePromises(n,e)}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("setDescription",e,"The modifiers did not resolve successfully");throw s.logger.error(t.message),s.emit("peerConnection-setRemoteDescriptionFailed",t),t}).then(function(e){return s.emit("setDescription",e),s.peerConnection.setRemoteDescription(e)}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;if(/^m=video.+$/gm.test(r)&&!i.disableAudioFallback)return i.disableAudioFallback=!0,s.setDescription(r,i,[d.stripVideo].concat(n));var t=new c.Exceptions.SessionDescriptionHandlerError("setDescription",e);throw t.error&&s.logger.error(t.error),s.emit("peerConnection-setRemoteDescriptionFailed",t),t}).then(function(){s.peerConnection.getReceivers?s.emit("setRemoteDescription",s.peerConnection.getReceivers()):s.emit("setRemoteDescription",s.peerConnection.getRemoteStreams()),s.emit("confirmed",s)})},h.prototype.sendDtmf=function(e,t){if(void 0===t&&(t={}),!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var r=this.peerConnection.getSenders();0<r.length&&(this.dtmfSender=r[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var i=this.peerConnection.getLocalStreams();if(0<i.length){var n=i[0].getAudioTracks();0<n.length&&(this.dtmfSender=this.peerConnection.createDTMFSender(n[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0},h.prototype.getDirection=function(){return this.direction},h.prototype.on=function(e,t){return n.prototype.on.call(this,e,t)},h.prototype.getMediaStream=function(e){return navigator.mediaDevices.getUserMedia(e)},h.prototype.createOfferOrAnswer=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]);var i=this.hasOffer("remote")?"createAnswer":"createOffer",n=this.peerConnection;return this.logger.log(i),(this.hasOffer("remote")?n.createAnswer:n.createOffer).apply(n,e).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-"+i+"Failed");throw r.emit("peerConnection-"+i+"Failed",t),t}).then(function(e){return u.Utils.reducePromises(t,r.createRTCSessionDescriptionInit(e))}).then(function(e){return r.resetIceGatheringComplete(),r.logger.log("Setting local sdp."),r.logger.log("sdp is "+e.sdp||!1),n.setLocalDescription(e)}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-SetLocalDescriptionFailed");throw r.emit("peerConnection-SetLocalDescriptionFailed",t),t}).then(function(){return r.waitForIceGatheringComplete()}).then(function(){if(!r.peerConnection.localDescription)throw new c.Exceptions.SessionDescriptionHandlerError("Missing local description");var e=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return u.Utils.reducePromises(t,e)}).then(function(e){return r.setDirection(e.sdp||""),e}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e);throw r.logger.error(t.toString()),t})},h.prototype.createRTCSessionDescriptionInit=function(e){return{type:e.type,sdp:e.sdp}},h.prototype.addDefaultIceCheckingTimeout=function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e},h.prototype.addDefaultIceServers=function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e},h.prototype.checkAndDefaultConstraints=function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e},h.prototype.hasBrowserTrackSupport=function(){return Boolean(this.peerConnection.addTrack)},h.prototype.hasBrowserGetSenderSupport=function(){return Boolean(this.peerConnection.getSenders)},h.prototype.initPeerConnection=function(e){var t=this;void 0===e&&(e={}),(e=this.addDefaultIceCheckingTimeout(e)).rtcConfiguration=e.rtcConfiguration||{},e.rtcConfiguration=this.addDefaultIceServers(e.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new RTCPeerConnection(e.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",function(e){t.logger.log("track added"),t.observer.trackAdded(),t.emit("addTrack",e)}):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){t.logger.log("stream added"),t.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){t.emit("iceCandidate",e),e.candidate?t.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(t.logger.log("ICE candidate gathering complete"),t.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(t.logger.log("RTCIceGatheringState changed: "+t.peerConnection.iceGatheringState),t.peerConnection.iceGatheringState){case"gathering":t.emit("iceGathering",t),!t.iceGatheringTimer&&e.iceCheckingTimeout&&(t.iceGatheringTimeout=!1,t.iceGatheringTimer=setTimeout(function(){t.logger.log("RTCIceChecking Timeout Triggered after "+e.iceCheckingTimeout+" milliseconds"),t.iceGatheringTimeout=!0,t.triggerIceGatheringComplete()},e.iceCheckingTimeout));break;case"complete":t.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(t.peerConnection.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void t.logger.warn("Unknown iceConnection state: "+t.peerConnection.iceConnectionState)}t.logger.log("ICE Connection State changed to "+e),t.emit(e,t)}},h.prototype.acquire=function(e){var i=this;return e=this.checkAndDefaultConstraints(e),new Promise(function(t,r){i.logger.log("acquiring local media"),i.emit("userMediaRequest",e),e.audio||e.video?i.getMediaStream(e).then(function(e){i.observer.trackAdded(),i.emit("userMedia",e),t(e)}).catch(function(e){i.emit("userMediaFailed",e),r(e)}):t([])}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("acquire",e,"unable to acquire streams");throw i.logger.error(t.message),t.error&&i.logger.error(t.error),t}).then(function(e){return i.logger.log("acquired local media streams"),i.peerConnection.removeTrack&&i.peerConnection.getSenders().forEach(function(e){i.peerConnection.removeTrack(e)}),e}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("acquire",e,"error removing streams");throw i.logger.error(t.message),t.error&&i.logger.error(t.error),t}).then(function(e){return[].concat(e).forEach(function(t){i.peerConnection.addTrack?t.getTracks().forEach(function(e){i.peerConnection.addTrack(e,t)}):i.peerConnection.addStream(t)}),Promise.resolve()}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new c.Exceptions.SessionDescriptionHandlerError("acquire",e,"error adding stream");throw i.logger.error(t.message),t.error&&i.logger.error(t.error),t})},h.prototype.hasOffer=function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t},h.prototype.isIceGatheringComplete=function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout},h.prototype.resetIceGatheringComplete=function(){this.iceGatheringTimeout=!1,this.logger.log("resetIceGatheringComplete"),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=void 0)},h.prototype.setDirection=function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var r=t[1];switch(r){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=r;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()},h.prototype.triggerIceGatheringComplete=function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=void 0))},h.prototype.waitForIceGatheringComplete=function(){return this.logger.log("waitForIceGatheringComplete"),this.isIceGatheringComplete()?(this.logger.log("ICE is already complete. Return resolved."),Promise.resolve()):(this.iceGatheringDeferred||(this.iceGatheringDeferred=u.Utils.defer()),this.logger.log("ICE is not complete. Returning promise"),this.iceGatheringDeferred?this.iceGatheringDeferred.promise:Promise.resolve())},h);function h(e,t,r){var i=n.call(this)||this;return i.type=a.TypeStrings.SessionDescriptionHandler,i.options=r||{},i.logger=e,i.observer=t,i.dtmfSender=void 0,i.shouldAcquireMedia=!0,i.CONTENT_TYPE="application/sdp",i.C={DIRECTION:{NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"}},i.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(i.options)),i.direction=i.C.DIRECTION.NULL,i.modifiers=i.options.modifiers||[],Array.isArray(i.modifiers)||(i.modifiers=[i.modifiers]),i.iceGatheringTimeout=!1,i.initPeerConnection(i.options.peerConnectionOptions),i.constraints=i.checkAndDefaultConstraints(i.options.constraints),i}t.SessionDescriptionHandler=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(31),a=r(2),n=r(16),s=r(59),o=r(97),c=r(98),u=r(104),d=r(105),p=r(106),l=r(107),h=(g.prototype.dispose=function(){var r=this;switch(this.logger.log("Session "+this.id+" in state "+this._state+" is being disposed"),delete this.userAgent._sessions[this.id],this._sessionDescriptionHandler&&this._sessionDescriptionHandler.close(),this.state){case l.SessionState.Initial:case l.SessionState.Establishing:break;case l.SessionState.Established:return new Promise(function(e,t){r._bye({onAccept:function(){return e()},onRedirect:function(){return e()},onReject:function(){return e()}})});case l.SessionState.Terminating:case l.SessionState.Terminated:break;default:throw new Error("Unknown state.")}return Promise.resolve()},Object.defineProperty(g.prototype,"assertedIdentity",{get:function(){return this._assertedIdentity},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"dialog",{get:function(){return this._dialog},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"replacee",{get:function(){return this._replacee},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"sessionDescriptionHandler",{get:function(){return this._sessionDescriptionHandler},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"sessionDescriptionHandlerFactory",{get:function(){return this.userAgent.configuration.sessionDescriptionHandlerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"stateChange",{get:function(){return o._makeEmitter(this._stateEventEmitter)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"userAgent",{get:function(){return this._userAgent},enumerable:!0,configurable:!0}),g.prototype.invite=function(i){var n=this;if(void 0===i&&(i={}),this.logger.log("Session.invite"),this.state!==l.SessionState.Established)return Promise.reject(new Error("Invalid session state "+this.state));if(this.pendingReinvite)return Promise.reject(new c.RequestPendingError("Reinvite in progress. Please wait until complete, then try again."));this.pendingReinvite=!0;var t={onAccept:function(t){var e=a.getBody(t.message);if(!e)return n.logger.error("Received 2xx response to re-INVITE without a session description"),n.ackAndBye(t,400,"Missing session description"),n.stateTransition(l.SessionState.Terminated),void(n.pendingReinvite=!1);if(i.withoutSdp){var r={sessionDescriptionHandlerOptions:i.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:i.sessionDescriptionHandlerModifiers};n.setOfferAndGetAnswer(e,r).then(function(e){t.ack({body:e})}).catch(function(e){n.logger.error("Failed to handle offer in 2xx response to re-INVITE"),n.logger.error(e.message),n.state===l.SessionState.Terminated?t.ack():(n.ackAndBye(t,488,"Bad Media Description"),n.stateTransition(l.SessionState.Terminated))}).then(function(){n.pendingReinvite=!1,i.requestDelegate&&i.requestDelegate.onAccept&&i.requestDelegate.onAccept(t)})}else r={sessionDescriptionHandlerOptions:n._sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:n._sessionDescriptionHandlerModifiers},n.setAnswer(e,r).then(function(){t.ack()}).catch(function(e){n.logger.error("Failed to handle answer in 2xx response to re-INVITE"),n.logger.error(e.message),n.state!==l.SessionState.Terminated?(n.ackAndBye(t,488,"Bad Media Description"),n.stateTransition(l.SessionState.Terminated)):t.ack()}).then(function(){n.pendingReinvite=!1,i.requestDelegate&&i.requestDelegate.onAccept&&i.requestDelegate.onAccept(t)})},onProgress:function(e){},onRedirect:function(e){},onReject:function(e){n.logger.warn("Received a non-2xx response to re-INVITE"),n.pendingReinvite=!1,i.withoutSdp?i.requestDelegate&&i.requestDelegate.onReject&&i.requestDelegate.onReject(e):n.rollbackOffer().catch(function(e){if(n.logger.error("Failed to rollback offer on non-2xx response to re-INVITE"),n.logger.error(e.message),n.state!==l.SessionState.Terminated){if(!n.dialog)throw new Error("Dialog undefined.");var t=[];t.push("Reason: "+n.getReasonHeaderValue(500,"Internal Server Error")),n.dialog.bye(void 0,{extraHeaders:t}),n.stateTransition(l.SessionState.Terminated)}}).then(function(){i.requestDelegate&&i.requestDelegate.onReject&&i.requestDelegate.onReject(e)})},onTrying:function(e){}},r=i.requestOptions||{};if(r.extraHeaders=(r.extraHeaders||[]).slice(),r.extraHeaders.push("Allow: "+s.AllowedMethods.toString()),r.extraHeaders.push("Contact: "+this._contact),i.withoutSdp){if(!this.dialog)throw this.pendingReinvite=!1,new Error("Dialog undefined.");return Promise.resolve(this.dialog.invite(t,r))}var e={sessionDescriptionHandlerOptions:i.sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:i.sessionDescriptionHandlerModifiers};return this.getOffer(e).then(function(e){if(!n.dialog)throw n.pendingReinvite=!1,new Error("Dialog undefined.");return r.body=e,n.dialog.invite(t,r)}).catch(function(e){throw n.logger.error(e.message),n.logger.error("Failed to send re-INVITE"),n.pendingReinvite=!1,e})},g.prototype.refer=function(e,t,r){return this.dialog?(this._referrer=e,Promise.resolve(this.dialog.refer(t,r))):Promise.reject(new Error("Session dialog undefined."))},g.prototype._bye=function(r,i){var n=this;if(!this.dialog)return Promise.reject(new Error("Session dialog undefined."));var s=this.dialog;switch(s.sessionState){case a.SessionState.Initial:case a.SessionState.Early:throw new Error("Invalid dialog state "+s.sessionState);case a.SessionState.AckWait:return this.stateTransition(l.SessionState.Terminating),new Promise(function(t,e){s.delegate={onAck:function(){var e=s.bye(r,i);n.stateTransition(l.SessionState.Terminated),t(e)},onAckTimeout:function(){var e=s.bye(r,i);n.stateTransition(l.SessionState.Terminated),t(e)}}});case a.SessionState.Confirmed:var e=s.bye(r,i);return this.stateTransition(l.SessionState.Terminated),Promise.resolve(e);case a.SessionState.Terminated:throw new Error("Invalid dialog state "+s.sessionState);default:throw new Error("Unrecognized state.")}},g.prototype._info=function(e,t){return this.dialog?Promise.resolve(this.dialog.info(e,t)):Promise.reject(new Error("Session dialog undefined."))},g.prototype.ackAndBye=function(e,t,r){e.ack();var i=[];t&&i.push("Reason: "+this.getReasonHeaderValue(t,r)),e.session.bye(void 0,{extraHeaders:i})},g.prototype.onAckRequest=function(e){var r=this;if(this.logger.log("Session.onAckRequest"),this.state===l.SessionState.Established||this.state===l.SessionState.Terminating){var i=this.dialog;if(!i)throw new Error("Dialog undefined.");switch(i.signalingState){case a.SignalingState.Initial:this.logger.error("Invalid signaling state "+i.signalingState+".");var t=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")];return i.bye(void 0,{extraHeaders:t}),void this.stateTransition(l.SessionState.Terminated);case a.SignalingState.Stable:var n=a.getBody(e.message);if(!n)return;if("render"===n.contentDisposition)return this._renderbody=n.content,void(this._rendertype=n.contentType);if("session"!==n.contentDisposition)return;var s={sessionDescriptionHandlerOptions:this._sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this._sessionDescriptionHandlerModifiers};return void this.setAnswer(n,s).catch(function(e){r.logger.error(e.message);var t=["Reason: "+r.getReasonHeaderValue(488,"Bad Media Description")];i.bye(void 0,{extraHeaders:t}),r.stateTransition(l.SessionState.Terminated)});case a.SignalingState.HaveLocalOffer:case a.SignalingState.HaveRemoteOffer:return this.logger.error("Invalid signaling state "+i.signalingState+"."),t=["Reason: "+this.getReasonHeaderValue(488,"Bad Media Description")],i.bye(void 0,{extraHeaders:t}),void this.stateTransition(l.SessionState.Terminated);case a.SignalingState.Closed:default:throw new Error("Invalid signaling state "+i.signalingState+".")}}else this.logger.error("ACK received while in state "+this.state+", dropping request")},g.prototype.onByeRequest=function(e){this.logger.log("Session.onByeRequest"),this.state===l.SessionState.Established?(e.accept(),this.stateTransition(l.SessionState.Terminated)):this.logger.error("BYE received while in state "+this.state+", dropping request")},g.prototype.onInfoRequest=function(e){if(this.logger.log("Session.onInfoRequest"),this.state===l.SessionState.Established)if(this.delegate&&this.delegate.onInfo){var t=new u.Info(e);this.delegate.onInfo(t)}else e.accept();else this.logger.error("INFO received while in state "+this.state+", dropping request")},g.prototype.onInviteRequest=function(r){var i=this;if(this.logger.log("Session.onInviteRequest"),this.state===l.SessionState.Established){var n=["Contact: "+this._contact];if(r.message.hasHeader("P-Asserted-Identity")){var e=r.message.getHeader("P-Asserted-Identity");if(!e)throw new Error("Header undefined.");this._assertedIdentity=a.Grammar.nameAddrHeaderParse(e)}var t={sessionDescriptionHandlerOptions:this._sessionDescriptionHandlerOptions,sessionDescriptionHandlerModifiers:this._sessionDescriptionHandlerModifiers};this.generateResponseOfferAnswerInDialog(t).then(function(e){var t=r.accept({statusCode:200,extraHeaders:n,body:e});i.delegate&&i.delegate.onInvite&&i.delegate.onInvite(r.message,t.message,200)}).catch(function(e){if(i.logger.error(e.message),i.logger.error("Failed to handle to re-INVITE request"),!i.dialog)throw new Error("Dialog undefined.");if(i.logger.error(i.dialog.signalingState),i.dialog.signalingState!==a.SignalingState.Stable)i.rollbackOffer().then(function(){var e=r.reject({statusCode:488});i.delegate&&i.delegate.onInvite&&i.delegate.onInvite(r.message,e.message,488)}).catch(function(e){i.logger.error(e.message),i.logger.error("Failed to rollback offer on re-INVITE request");var t=r.reject({statusCode:488});if(i.state!==l.SessionState.Terminated){if(!i.dialog)throw new Error("Dialog undefined.");[].push("Reason: "+i.getReasonHeaderValue(500,"Internal Server Error")),i.dialog.bye(void 0,{extraHeaders:n}),i.stateTransition(l.SessionState.Terminated)}i.delegate&&i.delegate.onInvite&&i.delegate.onInvite(r.message,t.message,488)});else{var t=r.reject({statusCode:488});i.delegate&&i.delegate.onInvite&&i.delegate.onInvite(r.message,t.message,488)}})}else this.logger.error("INVITE received while in state "+this.state+", dropping request")},g.prototype.onNotifyRequest=function(e){if(this.logger.log("Session.onNotifyRequest"),this.state===l.SessionState.Established)if(this._referrer&&this._referrer.delegate&&this._referrer.delegate.onNotify){var t=new d.Notification(e);this._referrer.delegate.onNotify(t)}else this.delegate&&this.delegate.onNotify?(t=new d.Notification(e),this.delegate.onNotify(t)):e.accept();else this.logger.error("NOTIFY received while in state "+this.state+", dropping request")},g.prototype.onPrackRequest=function(e){if(this.logger.log("Session.onPrackRequest"),this.state===l.SessionState.Established)throw new Error("Unimplemented.");this.logger.error("PRACK received while in state "+this.state+", dropping request")},g.prototype.onReferRequest=function(e){var t=this;if(this.logger.log("Session.onReferRequest"),this.state===l.SessionState.Established){if(!e.message.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting."),void e.reject();var r=new p.Referral(e,this);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(r):(this.logger.log("No delegate available to handle REFER, automatically accepting and following."),r.accept().then(function(){return r.makeInviter(t._referralInviterOptions).invite()}).catch(function(e){t.logger.error(e.message)}))}else this.logger.error("REFER received while in state "+this.state+", dropping request")},g.prototype.generateResponseOfferAnswer=function(e,t){if(this.dialog)return this.generateResponseOfferAnswerInDialog(t);var r=a.getBody(e.message);return r&&"session"===r.contentDisposition?this.setOfferAndGetAnswer(r,t):this.getOffer(t)},g.prototype.generateResponseOfferAnswerInDialog=function(e){if(!this.dialog)throw new Error("Dialog undefined.");switch(this.dialog.signalingState){case a.SignalingState.Initial:return this.getOffer(e);case a.SignalingState.HaveLocalOffer:return Promise.resolve(void 0);case a.SignalingState.HaveRemoteOffer:if(!this.dialog.offer)throw new Error("Session offer undefined in signaling state "+this.dialog.signalingState+".");return this.setOfferAndGetAnswer(this.dialog.offer,e);case a.SignalingState.Stable:return this.state!==l.SessionState.Established?Promise.resolve(void 0):this.getOffer(e);case a.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.dialog.signalingState+".")}},g.prototype.getOffer=function(e){var r=this,t=this.setupSessionDescriptionHandler(),i=e.sessionDescriptionHandlerOptions,n=e.sessionDescriptionHandlerModifiers;try{return t.getDescription(i,n).then(function(e){return a.fromBodyLegacy(e)}).catch(function(e){r.logger.error("Session.getOffer: SDH getDescription rejected...");var t=e instanceof Error?e:new Error(e);throw r.logger.error(t.message),t})}catch(e){this.logger.error("Session.getOffer: SDH getDescription threw...");var s=e instanceof Error?e:new Error(e);return this.logger.error(s.message),Promise.reject(s)}},g.prototype.rollbackOffer=function(){var r=this,e=this.setupSessionDescriptionHandler();if(!e.rollbackDescription)return Promise.resolve();try{return e.rollbackDescription().catch(function(e){r.logger.error("Session.rollbackOffer: SDH rollbackDescription rejected...");var t=e instanceof Error?e:new Error(e);throw r.logger.error(t.message),t})}catch(e){this.logger.error("Session.rollbackOffer: SDH rollbackDescription threw...");var t=e instanceof Error?e:new Error(e);return this.logger.error(t.message),Promise.reject(t)}},g.prototype.setAnswer=function(e,t){var r=this,i=this.setupSessionDescriptionHandler(),n=t.sessionDescriptionHandlerOptions,s=t.sessionDescriptionHandlerModifiers;try{if(!i.hasDescription(e.contentType))return Promise.reject(new c.ContentTypeUnsupportedError)}catch(e){this.logger.error("Session.setAnswer: SDH hasDescription threw...");var o=e instanceof Error?e:new Error(e);return this.logger.error(o.message),Promise.reject(o)}try{return i.setDescription(e.content,n,s).catch(function(e){r.logger.error("Session.setAnswer: SDH setDescription rejected...");var t=e instanceof Error?e:new Error(e);throw r.logger.error(t.message),t})}catch(e){return this.logger.error("Session.setAnswer: SDH setDescription threw..."),o=e instanceof Error?e:new Error(e),this.logger.error(o.message),Promise.reject(o)}},g.prototype.setOfferAndGetAnswer=function(e,t){var r=this,i=this.setupSessionDescriptionHandler(),n=t.sessionDescriptionHandlerOptions,s=t.sessionDescriptionHandlerModifiers;try{if(!i.hasDescription(e.contentType))return Promise.reject(new c.ContentTypeUnsupportedError)}catch(e){this.logger.error("Session.setOfferAndGetAnswer: SDH hasDescription threw...");var o=e instanceof Error?e:new Error(e);return this.logger.error(o.message),Promise.reject(o)}try{return i.setDescription(e.content,n,s).then(function(){return i.getDescription(n,s)}).then(function(e){return a.fromBodyLegacy(e)}).catch(function(e){r.logger.error("Session.setOfferAndGetAnswer: SDH setDescription or getDescription rejected...");var t=e instanceof Error?e:new Error(e);throw r.logger.error(t.message),t})}catch(e){return this.logger.error("Session.setOfferAndGetAnswer: SDH setDescription or getDescription threw..."),o=e instanceof Error?e:new Error(e),this.logger.error(o.message),Promise.reject(o)}},g.prototype.setSessionDescriptionHandler=function(e){if(this._sessionDescriptionHandler)throw new Error("Session description handler defined.");this._sessionDescriptionHandler=e},g.prototype.setupSessionDescriptionHandler=function(){return this._sessionDescriptionHandler||(this._sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.userAgent.configuration.sessionDescriptionHandlerFactoryOptions)),this._sessionDescriptionHandler},g.prototype.stateTransition=function(e){function t(){throw new Error("Invalid state transition from "+r._state+" to "+e)}var r=this;switch(this._state){case l.SessionState.Initial:e!==l.SessionState.Establishing&&e!==l.SessionState.Established&&e!==l.SessionState.Terminating&&e!==l.SessionState.Terminated&&t();break;case l.SessionState.Establishing:e!==l.SessionState.Established&&e!==l.SessionState.Terminating&&e!==l.SessionState.Terminated&&t();break;case l.SessionState.Established:e!==l.SessionState.Terminating&&e!==l.SessionState.Terminated&&t();break;case l.SessionState.Terminating:e!==l.SessionState.Terminated&&t();break;case l.SessionState.Terminated:t();break;default:throw new Error("Unrecognized state.")}this._state=e,this.logger.log("Session "+this.id+" transitioned to state "+this._state),this._stateEventEmitter.emit("event",this._state),e===l.SessionState.Terminated&&this.dispose()},g.prototype.getReasonHeaderValue=function(e,t){var r=e,i=n.getReasonPhrase(e);return!i&&t&&(i=t),"SIP;cause="+r+';text="'+i+'"'},g);function g(e,t){void 0===t&&(t={}),this.pendingReinvite=!1,this._state=l.SessionState.Initial,this._stateEventEmitter=new i.EventEmitter,this.delegate=t.delegate,this._userAgent=e}t.Session=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._makeEmitter=function(r,i){return void 0===i&&(i="event"),{addListener:function(e,t){void 0===t&&(t={}),t.once?r.once(i,e):r.addListener(i,e)},removeListener:function(e){r.removeListener(i,e)},on:function(e){r.on(i,e)},off:function(e){r.removeListener(i,e)},once:function(e){r.once(i,e)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);i.__exportStar(r(99),t),i.__exportStar(r(100),t),i.__exportStar(r(101),t),i.__exportStar(r(102),t),i.__exportStar(r(103),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(2),o=(i=s.Exception,n.__extends(a,i),a);function a(e){return i.call(this,e||"Unsupported content type.")||this}t.ContentTypeUnsupportedError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(2),o=(i=s.Exception,n.__extends(a,i),a);function a(e){return i.call(this,e||"Request pending.")||this}t.RequestPendingError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(2),o=(i=s.Exception,n.__extends(a,i),a);function a(e){return i.call(this,e||"Unspecified session description handler error.")||this}t.SessionDescriptionHandlerError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(2),o=(i=s.Exception,n.__extends(a,i),a);function a(){return i.call(this,"The session has terminated.")||this}t.SessionTerminatedError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(1),s=r(2),o=(i=s.Exception,n.__extends(a,i),a);function a(e){return i.call(this,e||"An error occurred during state transition.")||this}t.StateTransitionError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"request",{get:function(){return this.incomingInfoRequest.message},enumerable:!0,configurable:!0}),n.prototype.accept=function(e){return this.incomingInfoRequest.accept(e),Promise.resolve()},n.prototype.reject=function(e){return this.incomingInfoRequest.reject(e),Promise.resolve()},n);function n(e){this.incomingInfoRequest=e}t.Info=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"request",{get:function(){return this.incomingNotifyRequest.message},enumerable:!0,configurable:!0}),n.prototype.accept=function(e){return this.incomingNotifyRequest.accept(e),Promise.resolve()},n.prototype.reject=function(e){return this.incomingNotifyRequest.reject(e),Promise.resolve()},n);function n(e){this.incomingNotifyRequest=e}t.Notification=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),n=(Object.defineProperty(s.prototype,"referTo",{get:function(){var e=this.incomingReferRequest.message.parseHeader("refer-to");if(!(e instanceof i.NameAddrHeader))throw new Error("Failed to parse Refer-To header.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"referredBy",{get:function(){return this.incomingReferRequest.message.getHeader("referred-by")},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"replaces",{get:function(){return this.referTo.uri.getHeader("replaces")},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"request",{get:function(){return this.incomingReferRequest.message},enumerable:!0,configurable:!0}),s.prototype.accept=function(e){return void 0===e&&(e={statusCode:202}),this.incomingReferRequest.accept(e),Promise.resolve()},s.prototype.reject=function(e){return this.incomingReferRequest.reject(e),Promise.resolve()},s.prototype.makeInviter=function(e){if(this.inviter)return this.inviter;var t=this.referTo.uri.clone();t.clearHeaders();var r=((e=e||{}).extraHeaders||[]).slice(),i=this.replaces;i&&r.push("Replaces: "+decodeURIComponent(i));var n=this.referredBy;return n&&r.push("Referred-By: "+n),e.extraHeaders=r,this.inviter=this.session.userAgent._makeInviter(t,e),this.inviter._referred=this.session,this.session._referral=this.inviter,this.inviter},s);function s(e,t){this.incomingReferRequest=e,this.session=t}t.Referral=n},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.SessionState||(t.SessionState={})).Initial="Initial",i.Establishing="Establishing",i.Established="Established",i.Terminating="Terminating",i.Terminated="Terminated"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(e,t){for(var r,i=[],n=e.split(/\r\n/),s=0;s<n.length;){var o=n[s];if(/^m=(?:audio|video)/.test(o))r={index:s,stripped:[]},i.push(r);else if(r){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){n.splice(s,1),r.stripped.push(a[1]);continue}}s++}for(var c=0,u=i;c<u.length;c++){for(var d=u[c],p=n[d.index].split(" "),l=3;l<p.length;)-1===d.stripped.indexOf(p[l])?l++:p.splice(l,1);n[d.index]=p.join(" ")}return n.join("\r\n")}t.stripTcpCandidates=function(e){return e.sdp=(e.sdp||"").replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),Promise.resolve(e)},t.stripTelephoneEvent=function(e){return e.sdp=i(e.sdp||"","telephone-event"),Promise.resolve(e)},t.cleanJitsiSdpImageattr=function(e){return e.sdp=(e.sdp||"").replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),Promise.resolve(e)},t.stripG722=function(e){return e.sdp=i(e.sdp||"","G722"),Promise.resolve(e)},t.stripRtpPayload=function(t){return function(e){return e.sdp=i(e.sdp||"",t),Promise.resolve(e)}},t.stripVideo=function(e){return e.sdp=function(e,r){var t=new RegExp("m="+r+".*$","gm"),i=new RegExp("^a=group:.*$","gm");if(t.test(e)){var n,s=(e=e.split(/^m=/gm).filter(function(e){if(e.substr(0,r.length)!==r)return!0;if(n=e.match(/^a=mid:.*$/gm)){var t=n[0].match(/:.+$/g);t&&(n=t[0].substr(1))}return!1}).join("m=")).match(i);if(s&&1===s.length){var o=s[0],a=new RegExp(" *"+n+"[^ ]*","g");o=o.replace(a,""),e=e.split(i).join(o)}}return e}(e.sdp||"","video"),Promise.resolve(e)},t.addMidLines=function(e){var t=e.sdp||"";if(-1===t.search(/^a=mid.*$/gm)){var r=t.match(/^m=.*$/gm),i=t.split(/^m=.*$/gm);r&&r.forEach(function(e,t){r[t]=e+"\na=mid:"+t}),i.forEach(function(e,t){r&&r[t]&&(i[t]=e+r[t])}),t=i.join(""),e.sdp=t}return Promise.resolve(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(96),n=r(82),s=(o.prototype.trackAdded=function(){this.session instanceof i.Session||this.session.emit("trackAdded")},o.prototype.directionChanged=function(){this.session instanceof i.Session||this.session.emit("directionChanged")},o);function o(e,t){this.type=n.TypeStrings.SessionDescriptionHandlerObserver,this.session=e,this.options=t}t.SessionDescriptionHandlerObserver=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i,s=r(1),o=r(2),a=r(82),c=r(84),u=r(93),d=r(83);(i=n=t.TransportStatus||(t.TransportStatus={}))[i.STATUS_CONNECTING=0]="STATUS_CONNECTING",i[i.STATUS_OPEN=1]="STATUS_OPEN",i[i.STATUS_CLOSING=2]="STATUS_CLOSING",i[i.STATUS_CLOSED=3]="STATUS_CLOSED";var p,l=(p=u.Transport,s.__extends(h,p),h.prototype.isConnected=function(){return this.status===n.STATUS_OPEN},h.prototype.sendPromise=function(e,t){if(void 0===t&&(t={}),void 0===this.ws)return this.onError("unable to send message - WebSocket undefined"),Promise.reject(new Error("WebSocket undefined."));if(!this.statusAssert(n.STATUS_OPEN,t.force))return this.onError("unable to send message - WebSocket not open"),Promise.reject(new Error("WebSocket not open."));!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+e+"\n");try{this.ws.send(e)}catch(e){return e instanceof e&&Promise.reject(e),Promise.reject(new Error("Failed to send message."))}return Promise.resolve({msg:e})},h.prototype.disconnectPromise=function(r){var i=this;return void 0===r&&(r={}),this.disconnectionPromise?this.disconnectionPromise:(r.code=r.code||1e3,this.statusTransition(n.STATUS_CLOSING,r.force)?(this.emit("disconnecting"),this.disconnectionPromise=new Promise(function(e,t){i.disconnectDeferredResolve=e,i.reconnectTimer&&(clearTimeout(i.reconnectTimer),i.reconnectTimer=void 0),i.ws?(i.stopSendingKeepAlives(),i.logger.log("closing WebSocket "+i.server.wsUri),i.ws.close(r.code,r.reason)):t("Attempted to disconnect but the websocket doesn't exist")}),this.disconnectionPromise):this.status===n.STATUS_CLOSED?Promise.resolve({overrideEvent:!0}):this.connectionPromise?this.connectionPromise.then(function(){return Promise.reject("The websocket did not disconnect")}).catch(function(){return Promise.resolve({overrideEvent:!0})}):Promise.reject("The websocket did not disconnect"))},h.prototype.connectPromise=function(r){var i=this;return void 0===r&&(r={}),this.status!==n.STATUS_CLOSING||r.force?(this.connectionPromise||(this.server=this.server||this.getNextWsServer(r.force),this.connectionPromise=new Promise(function(e,t){if((i.status===n.STATUS_OPEN||i.status===n.STATUS_CLOSING)&&!r.force)return i.logger.warn("WebSocket "+i.server.wsUri+" is already connected"),void t("Failed status check - attempted to open a connection but already open/closing");i.connectDeferredResolve=e,i.connectDeferredReject=t,i.status=n.STATUS_CONNECTING,i.emit("connecting"),i.logger.log("connecting to WebSocket "+i.server.wsUri),i.disposeWs();try{i.ws=new WebSocket(i.server.wsUri,"sip")}catch(e){return i.ws=void 0,i.statusTransition(n.STATUS_CLOSED,!0),i.onError("error connecting to WebSocket "+i.server.wsUri+":"+e),t("Failed to create a websocket"),i.connectDeferredResolve=void 0,void(i.connectDeferredReject=void 0)}if(!i.ws)return t("Unexpected instance websocket not set"),i.connectDeferredResolve=void 0,void(i.connectDeferredReject=void 0);i.connectionTimeout=setTimeout(function(){i.statusTransition(n.STATUS_CLOSED),i.logger.warn("took too long to connect - exceeded time set in configuration.connectionTimeout: "+i.configuration.connectionTimeout+"s"),i.emit("disconnected",{code:1e3}),i.connectionPromise=void 0,t("Connection timeout"),i.connectDeferredResolve=void 0,i.connectDeferredReject=void 0;var e=i.ws;i.disposeWs(),e&&e.close(1e3)},1e3*i.configuration.connectionTimeout),i.boundOnOpen=i.onOpen.bind(i),i.boundOnMessage=i.onMessage.bind(i),i.boundOnClose=i.onClose.bind(i),i.boundOnError=i.onWebsocketError.bind(i),i.ws.addEventListener("open",i.boundOnOpen),i.ws.addEventListener("message",i.boundOnMessage),i.ws.addEventListener("close",i.boundOnClose),i.ws.addEventListener("error",i.boundOnError)})),this.connectionPromise):Promise.reject("WebSocket "+this.server.wsUri+" is closing")},h.prototype.onMessage=function(e){var t,r=e.data;if(/^(\r\n)+$/.test(r))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(r){if("string"!=typeof r){try{t=String.fromCharCode.apply(null,new Uint8Array(r))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}console.log(r),!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+r+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+r+"\n"),t=r;this.emit("message",t)}else this.logger.warn("received empty message, message discarded")},h.prototype.onOpen=function(){if(this.status===n.STATUS_CLOSED){var e=this.ws;return this.disposeWs(),void(e&&e.close(1e3))}this.statusTransition(n.STATUS_OPEN,!0),this.emit("connected"),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0),this.logger.log("WebSocket "+this.server.wsUri+" connected"),void 0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.reconnectionAttempts=0,this.disconnectionPromise=void 0,this.disconnectDeferredResolve=void 0,this.startSendingKeepAlives(),this.connectDeferredResolve?(this.connectDeferredResolve({overrideEvent:!0}),this.connectDeferredResolve=void 0,this.connectDeferredReject=void 0):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")},h.prototype.onClose=function(e){if(this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.status!==n.STATUS_CLOSING&&(this.logger.warn("WebSocket closed without SIP.js requesting it"),this.emit("transportError")),this.stopSendingKeepAlives(),this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.connectDeferredReject&&this.connectDeferredReject("Websocket Closed"),this.connectionTimeout=void 0,this.connectionPromise=void 0,this.connectDeferredResolve=void 0,this.connectDeferredReject=void 0,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(n.STATUS_CLOSED),void(this.disconnectDeferredResolve=void 0);this.statusTransition(n.STATUS_CLOSED,!0),this.emit("disconnected",{code:e.code,reason:e.reason}),this.disposeWs(),this.reconnect()},h.prototype.disposeWs=function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.ws=void 0)},h.prototype.onError=function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")},h.prototype.onWebsocketError=function(){this.onError("The Websocket had an error")},h.prototype.reconnect=function(){var e=this;if(0<this.reconnectionAttempts&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("attempted to get next ws server but there are no available ws servers left"),this.logger.warn("no available ws servers left - going to closed state"),this.statusTransition(n.STATUS_CLOSED,!0),this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.wsUri),this.logger.log("transport "+this.server.wsUri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.noAvailableServers()||(this.server=this.getNextWsServer()),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.wsUri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=setTimeout(function(){e.connect(),e.reconnectTimer=void 0},1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))},h.prototype.resetServerErrorStatus=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++)t[e].isError=!1},h.prototype.getNextWsServer=function(e){if(void 0===e&&(e=!1),this.noAvailableServers())throw this.logger.warn("attempted to get next ws server but there are no available ws servers left"),new Error("Attempted to get next ws server, but there are no available ws servers left.");for(var t=[],r=0,i=this.configuration.wsServers;r<i.length;r++){var n=i[r];n.isError&&!e||(0===t.length?t.push(n):n.weight>t[0].weight?t=[n]:n.weight===t[0].weight&&t.push(n))}return t[Math.floor(Math.random()*t.length)]},h.prototype.noAvailableServers=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++)if(!t[e].isError)return!1;return!0},h.prototype.sendKeepAlive=function(){var e=this;if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=setTimeout(function(){e.emit("keepAliveDebounceTimeout"),e.clearKeepAliveTimeout()},1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")},h.prototype.clearKeepAliveTimeout=function(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0},h.prototype.startSendingKeepAlives=function(){var e,t,r=this;this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval(function(){r.sendKeepAlive(),r.startSendingKeepAlives()},(e=this.configuration.keepAliveInterval,t=.8*e,1e3*(Math.random()*(e-t)+t))))},h.prototype.stopSendingKeepAlives=function(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0},h.prototype.statusAssert=function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(n)[this.status]+" as "+Object.keys(n)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(n)[e]+" but is currently "+Object.keys(n)[this.status]),!1))},h.prototype.statusTransition=function(e,t){return void 0===t&&(t=!1),this.logger.log("Attempting to transition status from "+Object.keys(n)[this.status]+" to "+Object.keys(n)[e]),e===n.STATUS_CONNECTING&&this.statusAssert(n.STATUS_CLOSED,t)||e===n.STATUS_OPEN&&this.statusAssert(n.STATUS_CONNECTING,t)||e===n.STATUS_CLOSING&&this.statusAssert(n.STATUS_OPEN,t)||e===n.STATUS_CLOSED?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)},h.prototype.loadConfig=function(e){var t={wsServers:[{scheme:"WSS",sipUri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,wsUri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1},r=this.getConfigurationCheck();for(var i in r.mandatory){if(!e.hasOwnProperty(i))throw new c.Exceptions.ConfigurationError(i);var n=e[i];if(void 0===(s=r.mandatory[i](n)))throw new c.Exceptions.ConfigurationError(i,n);t[i]=s}for(var i in r.optional)if(e.hasOwnProperty(i)){var s;if((n=e[i])instanceof Array&&0===n.length||null===n||""===n||void 0===n||"number"==typeof n&&isNaN(n))continue;if(void 0===(s=r.optional[i](n)))throw new c.Exceptions.ConfigurationError(i,n);t[i]=s}var o={};for(var i in t)t.hasOwnProperty(i)&&(o[i]={value:t[i]});var a=Object.defineProperties({},o);for(var i in this.logger.log("configuration parameters after validation:"),t)t.hasOwnProperty(i)&&this.logger.log("· "+i+": "+JSON.stringify(t[i]));return a},h.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{wsServers:function(e){if("string"==typeof e)e=[{wsUri:e}];else{if(!(e instanceof Array))return;for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]={wsUri:e[t]})}if(0===e.length)return!1;for(var r=0,i=e;r<i.length;r++){var n=i[r];if(!n.wsUri)return;if(n.weight&&!Number(n.weight))return;var s=o.Grammar.parse(n.wsUri,"absoluteURI");if(-1===s)return;if(["wss","ws","udp"].indexOf(s.scheme)<0)return;n.sipUri="<sip:"+s.host+(s.port?":"+s.port:"")+";transport="+s.scheme.replace(/^wss$/i,"ws")+";lr>",n.weight||(n.weight=0),n.isError=!1,n.scheme=s.scheme.toUpperCase()}return e},keepAliveInterval:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<t)return t}},keepAliveDebounce:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<t)return t}},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<t)return t}},maxReconnectionAttempts:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<=t)return t}},reconnectionTimeout:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(0<t)return t}}}}},h.C=n,h);function h(e,t){void 0===t&&(t={});var r=p.call(this,e)||this;return r.type=a.TypeStrings.Transport,r.reconnectionAttempts=0,r.status=n.STATUS_CONNECTING,r.configuration=r.loadConfig(t),r.server=r.configuration.wsServers[0],r}t.Transport=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1).__importStar(r(108));t.Modifiers=i;var n=r(112);t.Simple=n.Simple;var s=r(95);t.SessionDescriptionHandler=s.SessionDescriptionHandler;var o=r(110);t.Transport=o.Transport},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i,n=r(1),s=r(31),a=r(94),c=n.__importStar(r(108));(i=o=t.SimpleStatus||(t.SimpleStatus={}))[i.STATUS_NULL=0]="STATUS_NULL",i[i.STATUS_NEW=1]="STATUS_NEW",i[i.STATUS_CONNECTING=2]="STATUS_CONNECTING",i[i.STATUS_CONNECTED=3]="STATUS_CONNECTED",i[i.STATUS_COMPLETED=4]="STATUS_COMPLETED";var u,d=(u=s.EventEmitter,n.__extends(p,u),p.prototype.wsModifier=function(e){return"offer"==e.type?(e.sdp=e.sdp.replace("a=group:BUNDLE 0 1","a=group:BUNDLE audio video"),e.sdp=e.sdp.replace("a=mid:0","a=mid:audio"),e.sdp=e.sdp.replace("a=mid:1","a=mid:video")):e.sdp=e.sdp.replace("profile-level-id=4d 032","profile-level-id=4d0032"),Promise.resolve(e)},p.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===o.STATUS_NULL||this.state===o.STATUS_COMPLETED){this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0);var t=[this.wsModifier,SIP.Web.Modifiers.stripTelephoneEvent];return this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}},t),this.setupSession(),this.session}this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},p.prototype.answer=function(){if(this.state===o.STATUS_NEW||this.state===o.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}},answerModifier);this.logger.warn("No call to answer")},p.prototype.reject=function(){if(this.state===o.STATUS_NEW||this.state===o.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},p.prototype.hangup=function(){if(this.state===o.STATUS_CONNECTED||this.state===o.STATUS_CONNECTING||this.state===o.STATUS_NEW)return this.state!==o.STATUS_CONNECTED?this.session.cancel():this.session?this.session.bye():void 0;this.logger.warn("No active call to hang up on")},p.prototype.hold=function(){if(this.state===o.STATUS_CONNECTED&&this.session&&!this.session.localHold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},p.prototype.unhold=function(){if(this.state===o.STATUS_CONNECTED&&this.session&&this.session.localHold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},p.prototype.mute=function(){this.state===o.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},p.prototype.unmute=function(){this.state===o.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},p.prototype.sendDTMF=function(e){this.state===o.STATUS_CONNECTED&&this.session?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},p.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},p.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},p.prototype.setupRemoteMedia=function(){var e=this;if(this.session){var r,t=this.session.sessionDescriptionHandler.peerConnection;t.getReceivers?(r=new MediaStream,t.getReceivers().forEach(function(e){var t=e.track;t&&r.addTrack(t)})):r=t.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=r,this.options.media.remote.video.play().catch(function(){e.logger.log("play was rejected")})):this.audio&&(this.options.media.remote.audio.srcObject=r,this.options.media.remote.audio.play().catch(function(){e.logger.log("play was rejected")}))}else this.logger.warn("No session to set remote media on")},p.prototype.setupLocalMedia=function(){if(this.session){if(this.video&&this.options.media.local&&this.options.media.local.video){var r,e=this.session.sessionDescriptionHandler.peerConnection;e.getSenders?(r=new MediaStream,e.getSenders().forEach(function(e){var t=e.track;t&&"video"===t.kind&&r.addTrack(t)})):r=e.getLocalStreams()[0],this.options.media.local.video.srcObject=r,this.options.media.local.video.volume=0,this.options.media.local.video.play()}}else this.logger.warn("No session to set local media on")},p.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},p.prototype.setupSession=function(){var e=this;this.session?(this.state=o.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",function(){return e.onProgress()}),this.session.on("accepted",function(){return e.onAccepted()}),this.session.on("rejected",function(){return e.onEnded()}),this.session.on("failed",function(){return e.onFailed()}),this.session.on("terminated",function(){return e.onEnded()})):this.logger.warn("No session to set up")},p.prototype.destroyMedia=function(){this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.close()},p.prototype.toggleMute=function(t){if(this.session){var e=this.session.sessionDescriptionHandler.peerConnection;e.getSenders?e.getSenders().forEach(function(e){e.track&&(e.track.enabled=!t)}):e.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!t}),e.getVideoTracks().forEach(function(e){e.enabled=!t})})}else this.logger.warn("No session to toggle mute")},p.prototype.onAccepted=function(){var r=this;this.session?(this.state=o.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler&&(this.session.sessionDescriptionHandler.on("addTrack",function(){r.logger.log("A track has been added, triggering new remoteMedia setup"),r.setupRemoteMedia()}),this.session.sessionDescriptionHandler.on("addStream",function(){r.logger.log("A stream has been added, trigger new remoteMedia setup"),r.setupRemoteMedia()})),this.session.on("dtmf",function(e,t){r.emit("dtmf",t.tone)}),this.session.on("bye",function(){return r.onEnded()})):this.logger.warn("No session for accepting")},p.prototype.onProgress=function(){this.state=o.STATUS_CONNECTING,this.emit("connecting",this.session)},p.prototype.onFailed=function(){this.onEnded()},p.prototype.onEnded=function(){this.state=o.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},p.C=o,p);function p(e){var t=u.call(this)||this;if(e.media.remote.video?t.video=!0:t.video=!1,e.media.remote.audio?t.audio=!0:t.audio=!1,!t.audio&&!t.video)throw new Error("At least one remote audio or video element is required for Simple.");t.options=e;var r=navigator.userAgent.toLowerCase(),i=!1,n=!1;-1<r.indexOf("safari")&&r.indexOf("chrome")<0?i=!0:-1<r.indexOf("firefox")&&r.indexOf("chrome")<0&&(n=!0);var s={};return i&&(s.modifiers=[c.stripG722]),n&&(s.alwaysAcquireMediaFirst=!0),t.options.ua.uri?t.anonymous=!1:t.anonymous=!0,t.ua=new a.UA({uri:t.options.ua.uri,authorizationUser:t.options.ua.authorizationUser,password:t.options.ua.password,displayName:t.options.ua.displayName,userAgentString:t.options.ua.userAgentString,register:!0,contactName:t.options.ua.authorizationUser,sessionDescriptionHandlerFactoryOptions:s,transportOptions:{traceSip:t.options.ua.traceSip,wsServers:t.options.ua.wsServers}}),t.state=o.STATUS_NULL,t.logger=t.ua.getLogger("sip.simple"),t.ua.on("registered",function(){t.emit("registered",t.ua)}),t.ua.on("unregistered",function(){t.emit("unregistered",t.ua)}),t.ua.on("registrationFailed",function(){t.emit("unregistered",t.ua)}),t.ua.on("invite",function(e){if(t.state!==o.STATUS_NULL&&t.state!==o.STATUS_COMPLETED)return t.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();t.session=e,t.setupSession(),t.emit("ringing",t.session)}),t.ua.on("message",function(e){t.emit("message",e)}),t}t.Simple=d}],n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0);function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,i});